@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-7c73d931940e62a43f94464a78bde424> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/th>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eu>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en-gb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/vec>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/hy>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/id>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/be-tarask>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/tr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ro>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/he>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/zh>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pt-br>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/si>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eo>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/da>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ar>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ko>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ms>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/sv>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lt>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/nl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ca>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/uk>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/it>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ja>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/es>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/cs>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ru>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/de>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/fr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d851383-wikidata_prefixes, _:genid-4e694113159d4e3db4a1a913894a81d851383-E2C3555FE5F49918BCE865F0D0883B55,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-77143FC5555A4FE1BD66C13A5C9F04B1, _:genid-4e694113159d4e3db4a1a913894a81d851383-885B8B564DB2A06729F4FDA5E6703DD7,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-435AD9B5B366CB2FF9547364E038BE6C, _:genid-4e694113159d4e3db4a1a913894a81d851383-4DC9985FE5B5B8B4E698852920ED13AD,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-428A59A83DF5A47B916E27B5F3256E33, _:genid-4e694113159d4e3db4a1a913894a81d851383-06A700008465E35CBB3FFAF60C2FF6D3,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-FD35EBB2E7D07595DC6BF6FF1B2CEB0D, _:genid-4e694113159d4e3db4a1a913894a81d851383-13C0A1A0FF5AFD0FBBEFCD64A1DCA644,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-EAE44B9FD5A026358A76E41D7090F599, _:genid-4e694113159d4e3db4a1a913894a81d851383-7A6E13E2A0B949371C50304781364044,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-55354826FFDF384CD262D40EED804DDF, _:genid-4e694113159d4e3db4a1a913894a81d851383-A02FBA839F82B89994F21ED4B90D8DCE,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-92FDAB080A213EBABA073C1D9913B80C, _:genid-4e694113159d4e3db4a1a913894a81d851383-B7D713482356BFB9E0F61107496E90F7,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-D296F38654B067E7B431139B69C8C205, _:genid-4e694113159d4e3db4a1a913894a81d851383-B15591BEF8321953954CC2DBD3A47517,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-6F0323C9A2602C7487DED1387FC50A0F, _:genid-4e694113159d4e3db4a1a913894a81d851383-182C89D16674C4FF99B21340B63AED3A,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-BAFE60F437FC9D9AEA1E722479608991, _:genid-4e694113159d4e3db4a1a913894a81d851383-3B9AFE683ACDA7F3A026248083CFA0B5,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-57D56C7F60131566172F47D7BE20C811, _:genid-4e694113159d4e3db4a1a913894a81d851383-60D9D08111463564ACDAC127E8B7C503,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-98066DA7F136E5BB5E8077126B34DABB, _:genid-4e694113159d4e3db4a1a913894a81d851383-DB170E491BE75D70DF2DCB160F5777B2,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-0A010B5C32A553430F3B17FE9E05E25A, _:genid-4e694113159d4e3db4a1a913894a81d851383-52CB0CEDB1D4F335806CBAD846D8756A,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-F766A7E999BF669AD966F94D3BA16BD5, _:genid-4e694113159d4e3db4a1a913894a81d851383-72D870A0BEE7C6D860E652A8C07374EC,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-38CE16F89CFE278CD4CC0196CBBF93DC, _:genid-4e694113159d4e3db4a1a913894a81d851383-2BACDC15192D7F209B0A6EB09F7A1300,
    _:genid-4e694113159d4e3db4a1a913894a81d851383-F48B7632ED7C08E9967D52FE9BCC0390, _:genid-4e694113159d4e3db4a1a913894a81d851383-0F31C926CEC70D7C4393973F4F48E851;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX ps: <http://www.wikidata.org/prop/statement/>
PREFIX pq: <http://www.wikidata.org/prop/qualifier/>
PREFIX p: <http://www.wikidata.org/prop/>
# All Law & Order episodes on Wikidata.
# According to enwp, “[a] total of 456 original episodes… aired before cancellation” (https://en.wikipedia.org/wiki/List_of_Law_%26_Order_episodes).
# As of this writing, the query returns 451 results, so some episodes are missing (either without item or lacking the necessary statements to match this query).

SELECT (SAMPLE(?seasonNumber) AS ?seasonNumber) (SAMPLE(?episodeNumber) AS ?episodeNumber) (SAMPLE(?title) AS ?title) (MIN(?pubDate) AS ?pubDate) ?episode
{
  # All episodes should be instance of episode with series Law & Order.
  ?episode wdt:P31 wd:Q21191270;
           wdt:P179 wd:Q321423.
  # Many of them also have the season as series, so we can get episode and season number from qualifiers there.
  OPTIONAL {
    ?episode p:P179 [
      # the season also has series Law & Order
      ps:P179/p:P179 [
        ps:P179 wd:Q321423;
                pq:P1545 ?seasonNumber
      ] ;
      pq:P1545 ?episodeNumber
    ]
  }
  OPTIONAL { ?episode wdt:P1476 ?title. }
  OPTIONAL { ?episode wdt:P577 ?pubDate. }
}
GROUP BY ?episode # make sure we return each episode only once – a few have multiple publication dates, for example
ORDER BY IF(BOUND(?seasonNumber), xsd:integer(?seasonNumber), 1000) xsd:integer(?episodeNumber) ?title""" .
