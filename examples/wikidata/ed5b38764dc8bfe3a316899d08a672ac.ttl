@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-ed5b38764dc8bfe3a316899d08a672ac> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/th>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eu>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en-gb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/vec>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/hy>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/id>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/be-tarask>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/tr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ro>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/he>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/zh>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pt-br>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/si>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eo>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/da>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ar>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ko>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ms>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/sv>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lt>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/nl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ca>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/uk>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/it>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ja>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/es>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/cs>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ru>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/de>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/fr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d81319-wikidata_prefixes, _:genid-4e694113159d4e3db4a1a913894a81d81319-40B4382E5D5500C219FCDA7E7122446D,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-F8D9F4CF4BA069D223940616D339DC98, _:genid-4e694113159d4e3db4a1a913894a81d81319-477F89B0EDE28A6A466C81EE89AEDBED,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-63CAD1F7D9563C78E25F7B377E546EB3, _:genid-4e694113159d4e3db4a1a913894a81d81319-B302188E548AAF9A914167DF1B1A3B63,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-8E995EA98AE9F119187E9EE0BD4619C5, _:genid-4e694113159d4e3db4a1a913894a81d81319-0D4577D986555F3F9CF77687CF630513,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-01E8CD610FB9AF34F5E89568459A73F6, _:genid-4e694113159d4e3db4a1a913894a81d81319-408F736446F8D2E9C8E206E58E2006B4,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-94517F0713D2C0377688B907BDA73227, _:genid-4e694113159d4e3db4a1a913894a81d81319-B35B36DCDCD86351C9AC3D4DB40A73B0,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-E5C8C1362755151C54B996B4FB5B7B86, _:genid-4e694113159d4e3db4a1a913894a81d81319-C73673D6399303D0ABAD01E8237B2C9C,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-430D7DDDD1F63AD1927C7178784EAD7A, _:genid-4e694113159d4e3db4a1a913894a81d81319-1FA1E7BD75BB17E8EC1BE6E8D9DBBE43,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-6A531ABE4972B818A0237FC99918838C, _:genid-4e694113159d4e3db4a1a913894a81d81319-8F36DDCE83D38CDB7D18D965E2896DF6,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-2B09278D99175976D1E719C0E6FDE146, _:genid-4e694113159d4e3db4a1a913894a81d81319-E2B1F02C215104A8DAB7C1A9A17C3A60,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-7DA7632D727EC943262102C3F02F407F, _:genid-4e694113159d4e3db4a1a913894a81d81319-4B7102993D3401BE6243159FAEE04092,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-9C37554EEB7903E783868686241277F2, _:genid-4e694113159d4e3db4a1a913894a81d81319-878D9C444BFB9AFDA0C5A356D92E0C8A,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-FA474EFF484F4CE6EBB56F82029EBBDD, _:genid-4e694113159d4e3db4a1a913894a81d81319-2287B3FF845428F844CB95CFB2E429C4,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-DE0E6A7CCE8565DB32D084B9BD0F5BD9, _:genid-4e694113159d4e3db4a1a913894a81d81319-47181C469080AABA36EAB97159BD7C80,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-5253285481F1FC5C665714A239594F18, _:genid-4e694113159d4e3db4a1a913894a81d81319-FDAFDC0327C165A2B780ECABA922157E,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-8732A3EEC8E09AC58919B2A4D6824DD5, _:genid-4e694113159d4e3db4a1a913894a81d81319-35AB1E4728B9A4D2AA2541136D2706A6,
    _:genid-4e694113159d4e3db4a1a913894a81d81319-2B751352E85BFA0ABA98F509B4EA7029, _:genid-4e694113159d4e3db4a1a913894a81d81319-9F56885BAA7085C8D7651B34B2650DA8;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX bd: <http://www.bigdata.com/rdf#>
#defaultView:BarChart
PREFIX var_muntype: <http://www.wikidata.org/entity/Q15284>
PREFIX var_area: <http://www.wikidata.org/entity/Q6308>
SELECT ?from ?to ?distGrp WHERE {
  {
    SELECT ?from ?to ?distNum ?mun ?mun2 WHERE {
      { SELECT ?mun (SAMPLE(?loc) AS ?loc)
        WHERE { ?mun wdt:P31/wdt:P279* var_muntype:;
                     wdt:P131 var_area:;
                     wdt:P625 ?loc. }
        GROUP BY ?mun
      }
      OPTIONAL {
        { SELECT (?mun AS ?mun2) (SAMPLE(?loc) AS ?loc2)
          WHERE { ?mun wdt:P31/wdt:P279* var_muntype:;
                       wdt:P131 var_area:;
                       wdt:P625 ?loc. }
          GROUP BY ?mun
        }
      }
      BIND(geof:distance(?loc, ?loc2) AS ?distNum).

      SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],mul,en\".
        ?mun rdfs:label ?from.
        ?mun2 rdfs:label ?to.
      }
    }
  }
  FILTER(CONCAT(?from,STR(?mun)) <= CONCAT(?to,STR(?mun2))).
  #BIND(IF(STR(?from) < STR(?to),CONCAT(?from,\" <--> \",?to),
  # CONCAT(?to,\" <--> \",?from)) AS ?distLabel).

  BIND(COALESCE(
    IF(?distNum >= 40, \"40 - .. km\", 1/0),
    IF(?distNum >= 30, \"30 - 40 km\", 1/0),
    IF(?distNum >= 20, \"20 - 30 km\", 1/0),
    IF(?distNum >= 10, \"10 - 20 km\", 1/0),
    IF(?distNum >= 5, \"05 - 10 km\", 1/0),
    IF(?distNum >= 1, \"01 - 05 km\", \"00 - 01 km\")) AS ?distGrp).
}
ORDER BY ?from ?distGrp""" .
