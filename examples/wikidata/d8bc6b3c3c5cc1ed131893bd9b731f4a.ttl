@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-d8bc6b3c3c5cc1ed131893bd9b731f4a> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/th>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eu>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en-gb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/vec>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/hy>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/id>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/be-tarask>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/tr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ro>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/he>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/zh>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pt-br>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/si>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eo>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/da>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ar>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ko>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ms>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/sv>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lt>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/nl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ca>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/uk>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/it>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ja>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/es>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/cs>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ru>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/de>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/fr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d85879-wikidata_prefixes, _:genid-4e694113159d4e3db4a1a913894a81d85879-47A246288C1390DF5D637FE34D3D99F1,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-B31E1E21AC61C26C523C7CF77B952D40, _:genid-4e694113159d4e3db4a1a913894a81d85879-EA4B5188B727472EF1AB5497F9ECC9FE,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-58DAB9DDE55FC94731A81DEBA2DD9C9D, _:genid-4e694113159d4e3db4a1a913894a81d85879-659F9678310DA0D49036E9F11F9EF955,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-53C57E0D229CBE888E433B08F1C1BF81, _:genid-4e694113159d4e3db4a1a913894a81d85879-95B04F0A5DBB4E525CD403B9096126B6,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-EB8878D28DA1D3A10B76FD4387DA2C55, _:genid-4e694113159d4e3db4a1a913894a81d85879-73A41E90E376FA830DBC86F93F709631,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-356ECACF5AC17E86B1CDB9AA96C7C261, _:genid-4e694113159d4e3db4a1a913894a81d85879-2CB69B4AF60E88BDBD1E1F5D1D4CFC76,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-B0985D03690D0788A2F4424AB7C9CBD1, _:genid-4e694113159d4e3db4a1a913894a81d85879-C2EE375F403D366CE1EE39E894D39A3A,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-335B5DB9EC995ABBC530936B50A949AD, _:genid-4e694113159d4e3db4a1a913894a81d85879-94265D239F5687142F3D8070F4EEF746,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-3CF73788D5CF43D1C8F8F84ECDB2BEEA, _:genid-4e694113159d4e3db4a1a913894a81d85879-DF59E4FA5923795DE40F7F9C11623ED0,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-9B4B3668020E8FA7A0AC2FAB5840C8D4, _:genid-4e694113159d4e3db4a1a913894a81d85879-E9ABA4C16CE362E5D73A85D639B4E078,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-D4E18A4FD737DC80CA89D2C5919745C7, _:genid-4e694113159d4e3db4a1a913894a81d85879-06D4797812D3A328C67FDFF7C54251EF,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-DE19940A34094E620745CD1765F2CE44, _:genid-4e694113159d4e3db4a1a913894a81d85879-07EE024B1888D34BA55CA7EADEB530FF,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-8C5B13809DCE069D268F69C2005084A8, _:genid-4e694113159d4e3db4a1a913894a81d85879-8F570022527A8612E68C4A0FE6D61B5D,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-FDF8AE5F683A28A7EBBA6C94B58B4F0D, _:genid-4e694113159d4e3db4a1a913894a81d85879-60C69D16B0AD2EBFE1DEB17E44AD8A1D,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-B403E34DA0F9718B14D274A61BC8DE24, _:genid-4e694113159d4e3db4a1a913894a81d85879-099F89A2FB66B58B449EEB22D9135118,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-42676E6DD8F50ECF707B65D4D3D4B30D, _:genid-4e694113159d4e3db4a1a913894a81d85879-AA451E2F796B8B1733FEE2F8027248E8,
    _:genid-4e694113159d4e3db4a1a913894a81d85879-91E74621C33B100BD6F22AAF45D51CAE, _:genid-4e694113159d4e3db4a1a913894a81d85879-99AB66275601EB927081C552444DF047;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX pq: <http://www.wikidata.org/prop/qualifier/>
PREFIX p: <http://www.wikidata.org/prop/>
PREFIX bd: <http://www.bigdata.com/rdf#>
SELECT DISTINCT
  ?item
  ?itemLabel
  ?communeLabel
  (group_concat(DISTINCT ?merimee ; separator = \", \") as ?merimee)
  ?coords
  ?image
WHERE
{
  {
    SELECT DISTINCT ?item ?merimee WHERE {
      ?item wdt:P1435/wdt:P279* wd:Q916475 .
      ?item p:P1435 ?heritage_statement .
      FILTER NOT EXISTS { ?heritage_statement pq:P582 ?end . }
      ?item wdt:P380 ?merimee.
    }
    ORDER BY ?merimee
  }
  ?item wdt:P131/wdt:P131* wd:Q3068 .
  ?item wdt:P131 ?commune .
  OPTIONAL { ?item wdt:P625 ?coords . }
  OPTIONAL { ?item wdt:P18 ?image . }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr\" . }
}
GROUP BY ?item ?itemLabel ?communeLabel ?coords ?image
ORDER BY ?communeLabel ?itemLabel""" .
