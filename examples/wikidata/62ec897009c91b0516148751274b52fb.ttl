@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-62ec897009c91b0516148751274b52fb> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  rdfs:comment """ This page is an archive. Please do not modify it. Use the current page, even to continue an old discussion. Contents 1 Count only certain identifiers 2 Group by century of birth 3 Group minor results 3.1 grouping by range of values 3.2 Top 10 & others 4 Metadata for a commons category 5 All items that point to a specific url (no matter which property) 6 Brothers without property 7 Google Knowledge Graph 8 Extract all the IRIs 9 Listing norwegian ships where the manufacturer doesn't have a translation for \"norsk bokmål\" (nb) 10 Newest Images GEPRIS Historisch 11 articles on English Wikipedia with \"Korea\" or \"Korean\" in title not on Korean Wikipedia 12 The list of all provinces and their countries 13 Embajadores 14 Footballers died when playing a match 15 Author stated as 16 Oldest (or newest) geographical discoveries 17 unique Hebrew articles 18 P217 + prov:wasDerivedFrom 19 Looking for \"orphan\" errata 20 Count womans from specific places 21 Apply multi values in a filter 22 Only those with references and these have a certain value 23 Item creator 24 Subway maps 25 Language labels per column 26 A list of all the people 27 URL and shown text 28 Public domain poems without an audio recording Count only certain identifiers Hi! Through the following query SELECT ?type (COUNT(DISTINCT ?item) AS ?count) WHERE {
  ?item wdt:P9114 ?id .
  ?item wikibase:identifiers ?ids .
  BIND((?ids) AS ?type)
}
GROUP BY ?type
ORDER BY ?type
 Try it! I'm able to see the number of identifiers present in items having Mathematica Italiana person ID (P9114). Would it be possible, with a more complex query, counting only the identifiers having country (P17)Italy (Q38) ? I've tried some solutions but without success. Thank you in advance, --Epìdosis 20:06, 2 June 2021 (UTC) @Epìdosis: This sort of thing, I think. #title:count of Italian external IDs for Mathematica Italiana person ID people grouped by number of IDs
Select ?ID_count (count(?item) as ?item_count) where { 
  SELECT ?item (count(?id) as ?ID_count) WHERE {
    ?item wdt:P9114 ?P9114id .
    OPTIONAL { 
      ?item ?prop ?id.
      ?propItem wikibase:directClaim ?prop.
      ?propItem wikibase:propertyType wikibase:ExternalId.
      ?propItem wdt:P17 wd:Q38.}
    } group by ?item
} group by ?ID_count order by desc(?ID_count)
 count of Italian external IDs for Mathematica Italiana person ID people grouped by number of IDs --Tagishsimon (talk) 21:51, 2 June 2021 (UTC) @Tagishsimon: Amazing! Thanks to you the second table of User:Epìdosis/Koha/Statistics is just born, I'm really really happy! Good night, --Epìdosis 22:52, 2 June 2021 (UTC) Group by century of birth Similarly, from the query SELECT ?id ?birth WHERE {
  ?item wdt:P9114 ?id .
  ?item wdt:P569 ?birth .
}
 Try it! is it possible to count people by century of birth? X people born in the 15th century, Y born in the 16th etc. Thanks, --Epìdosis 20:52, 2 June 2021 (UTC) @Epìdosis: This, probably. iirc from the Y2K era, centuries start at year 1 and end at year 100, rather than running from 0 to 99. So this will be looking for 1801-1900, rather than 1800-1899. (remove the -1 if you want t'other century definition) #title:counts of century of birth for P9114 people 
select ?century (count(?item) as ?count) WHERE {
  ?item wdt:P9114 ?id .
  ?item wdt:P569 ?birth .
  bind(year(?birth)-1 as ?year)
  filter(bound(?year))
  bind (floor(?year/100) as ?century)
} group by ?century order by ?century
 counts of century of birth for P9114 people --Tagishsimon (talk) 23:13, 2 June 2021 (UTC) Group minor results Hi! Excuse me for the streak of questions, I hope this will be the last for a while. So, through this query SELECT ?type (COUNT(DISTINCT ?item) AS ?count) WHERE {
  ?item wdt:P8034 ?id .
  ?item wikibase:identifiers ?ids .
  BIND((?ids) AS ?type)
}
GROUP BY ?type
ORDER BY ?type
 Try it! I can group the items containing P8034 by the number of external IDs they have.Similarly, through SELECT ?type (COUNT(DISTINCT ?item) AS ?count) WHERE {
  ?item wdt:P8034 ?id .
  ?item wdt:P106 ?occ .
  BIND(?occ AS ?type)
}
GROUP BY ?type
ORDER BY DESC(?count)
 Try it! I can group the items containing P8034 by occupation (P106).My questions are: regarding the first query: how can I group the results by ?type so that I have something like \"1\", \"2\", \"3\", \"4\", \"5\", \"6-15\", \"16+\"? regarding the second query: how can I display the labels of the occupations and how can I show only the 10 most frequent occupations and group all the rest under the label \"others\"? Thank you very much as always! --Epìdosis 08:43, 3 June 2021 (UTC) grouping by range of values As you get one question for every 100 edits for free, you might still have a couple of questions left ;) Still, I think it's better to ask one query per section header .. For the first one, the following should do: Properties used: Vatican Library VcBA ID (P8034)   #title:Grouping by range of values (external-id count)
SELECT ?group (SUM(?count) as ?count_group) (SAMPLE(?sampl) as ?sample)
WITH
{
  SELECT ?type (COUNT(DISTINCT ?item) AS ?count) (SAMPLE(?item) as ?sampl) 
  WHERE 
  {
    ?item wdt:P8034 ?id .
    ?item wikibase:identifiers ?ids .
    BIND((?ids) AS ?type) #not really needed
  }
  GROUP BY ?type
} as %what
WHERE
{
  INCLUDE %what
  BIND( IF(?type < 6, CONCAT(\"0\",str(?type)),  #zero added for sorting by group
        IF(?type < 16, \"06-15\", \"16+\")) 
        as ?group) 
}
GROUP BY ?group
ORDER BY ?group Try it! --- Jura 11:06, 3 June 2021 (UTC) Top 10 & others Nice idea. I think I will adapt that one for talk pages of given names. Properties used: Vatican Library VcBA ID (P8034)   , occupation (P106)   #title:Top 10 & others (occupations)
SELECT ?group (SUM(?count) as ?occ_count) (IF(?group=\">10\", \" other\", SAMPLE(?itemLabel)) as ?occ)
WITH  {  
        SELECT DISTINCT ?item (COUNT(?p) as ?count) WHERE { ?p wdt:P8034 []; wdt:P106 ?item } GROUP BY ?item ORDER BY DESC(?count) 
      } AS %all 
WITH  {
        SELECT (?item as ?item2) (?count AS ?count2) WHERE { INCLUDE %all }
      } AS %all2 
WITH  {
        SELECT ?item (SUM(?x) AS ?rank) ?count WHERE {
          INCLUDE %all .
          INCLUDE %all2 .
          BIND( IF( ?count  <= ?count2 , 1, 0 ) AS ?x ) .
        } GROUP BY ?item ?count
      } AS %main 
WHERE
{
  hint:Query hint:optimizer \"None\".    
  INCLUDE %main .
  BIND( IF(?rank < 11, str(?rank), 
        \">10\")
        as ?group)
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". ?item rdfs:label ?itemLabel }
}
GROUP BY ?group
ORDER BY (?group=\">10\") DESC(?occ_count) Try it! The above could answer the second. If a person has several values in P106, \">10\" counts that person once for each.@Epìdosis: --- Jura 11:31, 3 June 2021 (UTC) @Jura1: These are great!!! I've just compiled User:Epìdosis/Koha/Statistics/Distribution/Occupation, User:Epìdosis/Koha/Statistics/Network and User:Epìdosis/Koha/Statistics/Sitelinks thanks to them and I will use them in many other occasions (including events, courses etc.)! Good afternoon, --Epìdosis 14:58, 3 June 2021 (UTC) @Epìdosis: looks good. I think the Graph module has some feature built-in doing the Topn'-thing directly. --- Jura 15:08, 3 June 2021 (UTC) Metadata for a commons category I am hoping for a query of the commons category: Images from Wiki Loves Earth 2021 in Australia which gives: the url of each image in the category the file name size of file (in MB) the username of the contributor who uploaded it date of upload date of file creation MargaretRDonald (talk) 02:48, 6 June 2021 (UTC) All items that point to a specific url (no matter which property) is it possible to request all wikidata items that have any url type property pointing to a specific url? Example http://iliadeodyssee.texte.free.fr/aatexte/berard/accueilberard/odyssberard.htm should yield L'Odyssée, 'Poésie homérique' (Q21715294) because it has the url linked via full work available at URL (P953) http://musee.louvre.fr/oal/joconde/indexFR.html should yield Mona Lisa (Q12418) because it has the url linked via described at URL (P973) http://vocab.getty.edu/doc/ should yield Mona Lisa (Q12418) because it has the url linked via URL (P2699) condition the query should be fast and should drain little performance off the wikimedia servers. --Shisma (talk) 15:10, 5 June 2021 (UTC)How about querying by URL? Sample: #title: query by URL for Q42
SELECT * { ?qid ?p <https://viaf.org/viaf/113230702/> }
 query by URL for Q42--- Jura 18:53, 7 June 2021 (UTC)Brothers without property I would like to write a query that extracts couples of Italians born in the same place with the same surname in the interval of 10 years not having brothers / sisters but I don't know where to start from. Could Anybody help me? Luckyz (talk) 07:46, 9 June 2021 (UTC) Items used: Italy (Q38)   , male (Q6581097)   Properties used: place of birth (P19)   , country (P17)   , family name (P734)   , date of birth (P569)   , sex or gender (P21)   , sibling (P3373)   """@en;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:Request_a_query/Archive/2021/06>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d818320-wikidata_prefixes;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
SELECT * 
{
    ?item1 wdt:P19 / wdt:P17 wd:Q38 ; wdt:P734 ?fn .
    ?item2 wdt:P19 / wdt:P17 wd:Q38 ; wdt:P734 ?fn .
    hint:Prior hint:rangeSafe true .
    FILTER( ?item != ?item2 )
    ?item1 wdt:P569 ?d1 . 
    ?item2 wdt:P569 ?d2 . 
    FILTER( ABS( YEAR(?d1) - YEAR(?d2) ) < 10 ) 
    ?item1 wdt:P21 wd:Q6581097 .
    ?item2 wdt:P21 wd:Q6581097 .
    FILTER NOT EXISTS { ?item1 wdt:P3373 ?item2 }
}  
LIMIT 3""" .
