@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-17259ba07de589913439c842db8110c0> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  sh:select """SELECT  ?item ?BugGuideID 
{
    ?item wdt:P2464 ?BugGuideID .  # has BugGuideID 
    ?item wdt:P105  ?rank .
    #VALUES ?rank {wd:Q34740 }     # Try it on \"genus\" rank only
    VALUES ?rank {wd:Q35409 wd:Q36602 wd:Q2455704 wd:Q37517 wd:Q2136103 wd:Q5867959 wd:Q227936 wd:Q38348 wd:Q2889003 wd:Q3965313 
       wd:Q5868144 wd:Q5867051 wd:Q14817220 wd:Q2981883 wd:Q1153785 wd:Q3504061 wd:Q10861426  } . # Try it on taxonomic ranks above genus
    ?item wdt:P171  ?pItem .       # has parent item
  
    MINUS {?item wdt:P171 # exclude items in Arthropoda tree
                 |wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171  
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171  
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171   
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171  
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171     
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171     
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171 
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171 
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 |wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 #|wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 #|wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171/wdt:P171
                 wd:Q1360 . }
}
Limit 20""";
  rdfs:comment """Documentation Start a query Current uses Statistics by class String length List of qualifiers Count BugGuide taxon ID identifier in BugGuide.net Description ID used by BugGuide (Q4986057) database, which collects photographs and locations for Arthropods (mostly insects and spiders) in US and Canada. In January 2017 over 53 thousand taxons were recorded illustrated by over a million photographs. Associated item BugGuide (Q4986057) Applicable \"stated in\" value BugGuide (Q4986057) Data type External identifier Domain According to this template: Taxons According to statements in the property: taxon (Q16521), hybrid (Q42621) or validly published name (Q17134993) When possible, data should only be stored as statements Allowed values [1-9]\\d{0,6} Example Hermetia illucens (Q285029) → 7646 Exoprosopa rhea (Q13632226) → 95034 Formatter URL https://bugguide.net/node/view/$1 Tracking: usage Category:Pages using Wikidata property P2464 (Q29168713) Lists Items with the most statements of this property Count of items by number of statements (chart) Items with the most statements Items with the fewest statements Count of items by number of sitelinks (chart) Items with the most sitelinks Items with the most sitelinks, but no link to one Wikipedia (sample: Welsh Wikipedia, cywiki) Items with the fewest sitelinks Most linked wikis Items with the most identifier properties Items with no other external identifier Items with no other statements Most recently created items Items with novalue claims Items with unknown value claims Usage history (total) Usage history (main statement) Chart by item creation date Mix'n'match (Report) Database reports/Constraint violations/P2464 Map Random list Proposal discussion Proposal discussion Current uses Total 47,703 Main statement 47,602 out of 53,000 (90% complete) 99.8% of uses Qualifier 2 <0.1% of uses Reference 99 0.2% of uses Search for values[create Create a translatable help page (preferably in English) for this property to be included here]Format “[1-9]\\d{0,6}”: value must be formatted using this pattern (PCRE syntax). (Help) List of violations of this constraint: Database reports/Constraint violations/P2464#Format, hourly updated report, SPARQLSingle value: this property generally contains a single value. (Help) List of violations of this constraint: Database reports/Constraint violations/P2464#Single value, hourly updated report, SPARQLDistinct values: this property likely contains a value that is different from all other items. (Help) List of violations of this constraint: Database reports/Constraint violations/P2464#Unique value, hourly updated report, SPARQL (every item), SPARQL (by value)Type “taxon (Q16521), hybrid (Q42621), validly published name (Q17134993)”: item must contain property “instance of (P31)” with classes “taxon (Q16521), hybrid (Q42621), validly published name (Q17134993)” or their subclasses (defined using subclass of (P279)). (Help) List of violations of this constraint: Database reports/Constraint violations/P2464#Type Q16521, Q42621, Q17134993, hourly updated report, SPARQLItem “taxon name (P225)”: Items with this property should also have “taxon name (P225)”. (Help) Exceptions are possible as rare values may exist. Exceptions can be specified using exception to constraint (P2303). List of violations of this constraint: Database reports/Constraint violations/P2464#Item P225, search, SPARQLItem “taxon rank (P105)”: Items with this property should also have “taxon rank (P105)”. (Help) Exceptions are possible as rare values may exist. Exceptions can be specified using exception to constraint (P2303). List of violations of this constraint: Database reports/Constraint violations/P2464#Item P105, search, SPARQLItem “parent taxon (P171)”: Items with this property should also have “parent taxon (P171)”. (Help) Exceptions are possible as rare values may exist. Exceptions can be specified using exception to constraint (P2303). List of violations of this constraint: Database reports/Constraint violations/P2464#Item P171, search, SPARQLAllowed entity types are Wikibase item (Q29934200): the property may only be used on a certain entity type (Help) Exceptions are possible as rare values may exist. Exceptions can be specified using exception to constraint (P2303). List of violations of this constraint: Database reports/Constraint violations/P2464#Entity typesScope is as main value (Q54828448), as reference (Q54828450): the property must be used by specified way only (Help) Exceptions are possible as rare values may exist. Exceptions can be specified using exception to constraint (P2303). List of violations of this constraint: Database reports/Constraint violations/P2464#Scope, SPARQL v t e Taxonomy properties Basic taxon name taxon rank parent taxon individual of taxon Qualifiers taxon author ex taxon author year of publication of scientific name for taxon incertae sedis nomenclatural status original spelling gender of a scientific name of a genus Optional IUCN conservation status taxon range map image endemic to taxonomic type botanist author abbreviation temporal range start temporal range end author citation (zoology) basionym replaced synonym (for nom. nov.) found in taxon code of nomenclature original combination taxon synonym hybrid of natural product of taxon this taxon is source of taxon common name this zoological name is coordinate with host NatureServe conservation status type locality (biology) NZTCS conservation status type host visited by ‎Red List of South African Plants conservation status Databases International IPNI author ID IUCN taxon ID BHL page ID ITIS TSN Encyclopedia of Life ID Fossilworks taxon ID GBIF taxon ID WoRMS-ID for taxa FishBase species ID MSW ID Tropicos ID IPNI plant ID MycoBank taxon name ID Plant List ID (Royal Botanic Gardens, Kew) P1076 AlgaeBase URL Index Fungorum taxon ID GRIN URL ZooBank ID for name or act Watson & Dallwitz family ID GrassBase ID conifers.org ID Plazi ID Avibase taxon ID African Plant Database ID CITES Species+ ID Xeno-canto species ID Panarctic Flora ID BugGuide taxon ID Index Hepaticarum ID Internet Bird Collection species ID iNaturalist taxon ID World Spider Catalog ID eBird taxon ID EURING number WCSPF ID Araneae spider ID BOLD Systems taxon ID PfaF ID uBio ID Ecocrop ID Phasmida Species File ID (old version) AmphibiaWeb Species ID Plants of the World Online ID IRMNG ID GONIAT taxon ID Tree of Life Web Project ID BirdLife taxon ID AntWeb ID Amphibian Species of the World ID Global Invasive Species Database ID Invasive Species Compendium Datasheet ID SeaLifeBase ID Hymenoptera Online taxon ID Hypericum MySpecies ID CMS ID Wild Herps ID Global Raptor Information Network ID Neotropical Birds ID Orthoptera Species File ID (old version) Sea Slug Forum ID Cockroach Species File ID (old version) Coreoidea Species File ID Mantodea Species File ID Systematic Catalog of Culicidae ID Map of Life ID AfroMoths ID FLOW ID Mushroom Observer ID Observation.org taxon ID IFPNI species ID The White-files species ID Lace Bugs Database ID Psyl'list species ID COOL species ID Global Species ID Strepsiptera database species ID Brentidae of the world species ID Illustrated catalog of Tessaratomidae species ID ScaleNet ID Fossiilid.info ID World Flora Online ID Native Plants Database ID Open Tree of Life ID Hardy's Guide to Marine Gastropods URL All About Birds ID NatureServe Explorer ID Catalogue of Life ID Paleobiology Database taxon ID Hesperomys taxon ID eGardenGo plant ID Lygaeoidea Species File ID (old) World Arachnid Catalog ID World Auchenorrhyncha Database ID ‎MilliBase taxon ID Consortium of Bryophyte Herbaria taxon ID Consortium of Lichen Herbaria taxon ID Encyclopedia of Cacti species ID CalPhotos taxon ID ASM Mammal Diversity Database ID Featherbase ID Dermaptera Species File taxon ID Embioptera Species File taxon ID Isoptera Species File taxon ID Zoraptera Species File taxon ID Aphid Species File taxon ID Grylloblattodea Species File taxon ID Mantophasmatodea Species File taxon ID Plecoptera Species File taxon ID Coleorrhyncha Species File taxon ID Cockroach Species File taxon ID (new) Lygaeoidea Species File taxon ID (new) Phasmida Species File taxon ID (new) Psocodea Species File taxon ID (new) National Africa Red List of South African Plants ID Central African Plants ID PlantZAfrica Plants of the Week ID Americas NCBI taxonomy ID Flora of North America taxon ID VASCAN ID USDA PLANTS ID Butterflies and Moths of North America ID Calflora ID ADW taxon ID CNPS ID ABA bird ID Guide to North American Birds ID MONA ID CONABIO ID Center for Biological Diversity ID ECOS ID C.V. Starr Virtual Herbarium ID John J. Audubon's Birds of America ID FEIS ID NOAA Fisheries Species Directory ID Invasive Plant Atlas of the United States ID NAS ID SEINet ID BHL name ID Bioweb Ecuador ID Burke Herbarium Image Collection ID NWT Species ID Madrean Discovery Expeditions Flora Database ID Madrean Discovery Expeditions Fauna Database ID Leafsnap ID Reflora ID UConn Plant Database ID Woody Plants Database cultivar ID KPU Plant Database ID Asia Flora of China ID Catalogue of Life in Taiwan ID (old version) Wildflowers of Israel ID Flora of Israel Online plant ID Amphibians of India ID Virtual Guide to the Flora of Mongolia ID NParks Flora & Fauna Web ID MyBIS species ID Vietherb species ID CPNI ID TaiCOL ID (new version) China Animal Scientific Database dbb ID China Animal Scientific Database taxon ID Oceania Species Profile and Threats Database ID New Zealand Organisms Register ID Australasian Pollen and Spore Atlas Code (archived) Flora of Australia ID (old) FloraBase ID NSW Flora ID VicFlora ID NT Flora ID APNI ID Australian Faunal Directory ID BirdLife Australia ID New Zealand Birds Online ID Flora of Australia ID (new) ATRF ID SA Flora ID Atlas of Living Australia ID Australian Marine Algal Name Index ID NZPCN ID Australian Weed ID Australian Fungi ID Australian Lichen ID NZTCS ID Arachne.org.au ID Birdata ID Australian Reptile Online Database ID Biota of New Zealand ID Europe BioLib taxon ID Fauna Europaea ID Dyntaxa ID LPSN URL ARKive ID (archived) BacDive ID EPPO Code ButMoth ID LepIndex ID Plantarium ID TAXREF ID NBN System Key Vlinderstichting ID Nederlands Soortenregister ID PalDat plant ID Titan ID FOIH taxon ID BTO five-letter code BTO Birds of Britain ID Fauna Europaea New ID Tierstimmenarchiv ID The Reptile Database ID Lepidoptera of Belgium ID Oiseaux.net ID Echinoid Directory ID Espèces Envahissantes Outre-mer ID MNHN taxon ID GT IBMA ID FloraWeb ID Info Flora ID Verspreidingsatlas.nl ID EUNIS ID for species Danmarks svampeatlas ID eBiodiversity ID Belgian Species List ID Insects (Insecta) of the World ID Pilze Deutschland ID Moose Deutschland ID Microworld ID NBIC taxon ID Royal Horticultural Society plant ID Danish 2010 redlist ID Microlepidoptera.nl ID SOR bird ID ToateAnimalele ID Moths and Butterflies of Europe and North Africa ID Palynodata taxa ID izeltlabuak.hu ID Endemia.nc animal taxon ID UK Beetles ID Naturbasen species ID Moscow University Herbarium ID FloraVeg.EU taxon ID Euro+Med PlantBase taxon ID Subnational Plant Finder ID (Missouri Botanical Garden) Plant Parasites of Europe ID Michigan Flora ID Portal to the Flora of Italy ID Threatened Species Link ID Alabama Plant Atlas ID Atlas of Florida Plants ID Cal-IPC ID Flora of Wisconsin ID Weeds in Ontario ID ODNR Division of Wildlife ID Queensland Biota ID Washington Flora Checklist ID OregonFlora taxon ID Oregon Flora Image Project ID Idaho Species ID Montana Field Guide species ID E-Fauna BC species ID E-Flora BC species ID Washington Native Plant Society Plant Directory ID New York Flora Atlas ID Gardens Navigator ID Virginia Tech Dendrology Factsheets ID North Carolina Extension Gardener Plant Toolbox ID Colorado Plant Database ID vPlants ID Biota Information System of New Mexico species ID Maryland Plant Atlas ID Maryland Biodiversity Project species ID Nebraska Invasive Species Program species ID Vascular Plants of Iowa species ID Flora of New Jersey Project atlas ID Rare Species Guide ID Minnesota Plant List ID Flora of the Southeastern United States ID PAEnflowered taxon URL Digital Atlas of the Virginia Flora ID The Plant List ID (Arizona Native Plant Society) Flora of the Hawaiian Islands URL Montana Plant Life URL Mid-Atlantic Herbaria Consortium taxon ID Native Plants Hawaii ID SERNEC taxon ID TORCH taxon ID Penstemon Database ID References BHL page ID IUCN taxon ID IPNI author ID ZooBank author ID ZooBank publication ID IPNI publication ID BPH journal ID Harvard botanical journal ID Tropicos publication ID BioStor work ID Fossilworks reference ID Washington Rare Plant Field Guide ID (PDF version) IFPNI author ID Palynodata publications ID Hardy's Guide to Marine Gastropods URL Washington Rare Plant Field Guide ID (Web version) taxonomic treatment BUGZ ID See also: Wikidata:WikiProject Taxonomy; Wikidata property related to taxa (Q18609040) Test if taxon in Arthropoda tree [edit] This ID should be only used for Arthropoda taxons. The query below is supposed to test for it: SELECT ?item ?BugGuideID 
{
    ?item wdt:P2464 ?BugGuideID .      # has BugGuideID 
    ?item wdt:P171  ?pItem .           # has parent item
    MINUS {?item wdt:P171+ wd:Q1360. } # exclude items in Arthropoda tree
    MINUS {?item wdt:P105 wd:Q38348. } # exclude Arthropoda (Q1360) itself
}
 Try it! However it always times out. Its ugly cousin below worked for me, when applied separately to genus, then to species ranks and finally to other ranks. """@en;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Property_talk:P2464>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:wikidata_prefixes;
  schema:target <https://query.wikidata.org/sparql/> .
