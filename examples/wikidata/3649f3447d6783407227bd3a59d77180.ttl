@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-3649f3447d6783407227bd3a59d77180> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  rdfs:comment """ This page is an archive. Please do not modify it. Use the current page, even to continue an old discussion. Contents 1 All humans with specific label 2 Duplicate Results 3 Get most recently published example of an item 4 Checking consistency of values of P585, P580 and P582 5 List of birds on ga 6 Get only the information from statements 7 Result with more of one declaration 8 1990 WTA Tour 9 All fish 10 Filtering by city 11 Filling missing images using Federated Queries in a SPARQL query 12 List of movies released 10 years ago (dynamically with today's date) 13 Transpose multiple property statement values into columns 14 Extinction of animals 15 Cats interwiki 16 Querry for Wikimedia Commons 17 Members of the European Parliament of the first legislature 18 From Canada, has Wikitree, does not have FamilySearch 19 List of tennis player whose first singles title was at a Grand Slam tournament 20 Barchart order 21 Year of taxon publication (P574) is inconsistent with the date of birth or death of the taxon author (P405) 22 Get full name given a person 23 List of all entries in a category and subcategories 24 Is instance of, but doesn't have property 25 How many African language Wikipedias are there? 26 STR in label 27 Date details for Wikimedia Commons 28 Chains of causality 29 Optimizing query 30 Creating a link 31 Query to return a list of properties by data type 32 List of bridges of Paris 33 Upload picture free to upload it on wikidata 34 Query works, but reaches timeout when performed in Python 35 Is it possible to do a query, tryin to find for example a film by writing his name? 36 Japan politics query 37 How can I take more details of my list of films? 38 premio recibido sin ref 39 Fix queries for WD:BLP restricted properties 40 List of sportsmen by number of twitter followers they have 41 list of Wikidata items --> Wikipedia language versions for each 42 Professors at the ETH Zurich (without picture) 43 New example query for Wikidata:SPARQL federation input 44 How to search a film by name in title AND publication year? 45 I'mrust! 46 Select property in result 47 Norwegian heritage property identification number of Riksantikvaren (the Directorate for Cultural Heritage) 48 Can u give me an example of how to retrieve info from a certain Qcode? 49 Professor John R. Gregg 50 search women that dont exist in one wiki but exist in others 51 Wikidata common service | Mass editing of local language caption 52 Federated query fail All humans with specific label Could anyone make a query of all humans with the word 'Connor Blakley' and 'Anan Islam' in their label in any language? --Trade (talk) 11:07, 1 October 2020 (UTC) You can search for it: Special:Search/inlabel:\"Connor Blakley\" haswbstatement:P31=Q5. As integration into SPARQL is currently broken [1], you can't do the same on Query Server these days. --- Jura 11:20, 1 October 2020 (UTC) Duplicate Results Hello,Someone could explain me why I have so many duplicate results?Thanks in advance! #GLAM Suisse
SELECT ?item ?itemLabel ?loc2Label
WHERE 
{
  ?item wdt:P31/wdt:P279* wd:Q1030034;
        wdt:P17 wd:Q39.
  ?item wdt:P131 ?loc. 
  ?loc wdt:P31 wd:Q70208; p:P131 ?decl_loc2. ?decl_loc2 ps:P131 ?loc2.?loc2 wdt:P31 wd:Q23058.
             FILTER NOT EXISTS{?decl_loc2 ps:P131 ?loc2;pq:P582 ?datefin.}
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],de,it,en\". }
}
ORDER BY ?itemLabel
 Try it! --Memoriav-bdc (talk) 11:20, 1 October 2020 (UTC) I think it probably comes from multiple parents in wdt:P279*. You can avoid it by using \"SELECT DISTINCT\" instead of \"SELECT\". --- Jura 11:24, 1 October 2020 (UTC) Thanks @Jura1:. I forgot always this fonctionnality.--Memoriav-bdc (talk) 16:46, 1 October 2020 (UTC) Get most recently published example of an item Hi all. What's the most efficient query to get the 100 most recently published instances of an item (e.g. the 100 most recently published doctoral thesis (Q187685))? T.Shafee(evo&evo) (talk) 07:03, 2 October 2020 (UTC) @Evolution and evolvability: For doctoral theses I guess it is simply: SELECT DISTINCT ?item ?publication_date
WHERE
{
  ?item wdt:P31 / wdt:P279 * wd:Q187685 .
  ?item wdt:P577 ?publication_date .
}
ORDER BY DESC(?publication_date)
LIMIT 100
 Try it! but beware there may be inaccuracies due different precisions of publication date (P577) (day, month or year). For types of work with very many items, like scholarly article (Q13442814), the query will timeout. --Dipsacus fullonum (talk) 07:55, 2 October 2020 (UTC) @Dipsacus fullonum: Thank you - I kept just using the plain \"ORDER\" and couldn't work out what I'd forgotten! Have use it to generate some links that I'll use for getting people to learn manual editing by adding main subject (P921) statements to theses via https://w.wiki/ekg. T.Shafee(evo&evo) (talk) 09:43, 2 October 2020 (UTC) Checking consistency of values of P585, P580 and P582 User:Bouzinac wrote in section #Shortest and longest wars above: \"My goal of data quality has I'd have another query for you : the items having both start time (P580) end time (P582) point in time (P585), showing those that having point in time (P585) very much not between start time (P580) and end time (P582) ?\" I have considered how to do this, and have come to these requirements for a query: If P585 have precision day P580 and P582, if present, must have same value and precision day. If P585 have precision month P580 and P582, if present, must have values in the same month with precision month or higher. If P580 and P582 both have precision day, they must be different days. If P585 have precision year P580 and P582, if present, must have values in the same year with precision year or higher. If P580 and P582 both have precisions higher than year, they must be in different months. If P585 have precision decade P580 and P582, if present, must have values in the same decade with precision decade or higher. If P580 and P582 both have precisions higher than decade, they must be in different years. If P585 have precision century P580 and P582, if present, must have values in the same century with precision century or higher. If P580 and P582 both have precisions higher than century, they must be in different decades. If P585 have precision millenia P580 and P582, if present, must have values in the same millenia with precision millenia or higher. If P580 and P582 both have precisions higher than millenia, they must be in different centuries. Before I create these queries, I had like to ask for comments on the specific requirements. Do you agree, or can they be improved? --Dipsacus fullonum (talk) 07:17, 2 October 2020 (UTC) Supposedly, one could adjust ranks based on the results of the queries. One just needs to bear in mind that conflicting dates can come from references providing conflicting information. --- Jura 07:25, 2 October 2020 (UTC) I'd like to show the use case that made me Wonder about dates : https://www.wikidata.org/w/index.php?title=Q1064335&oldid=1179975218#P585 The more I think about it, I finally start to think that if there is start time (P580) and end time (P582), then, there, in an absolute way of modelling, shouldn't be none point in time (P585) after all. If a war/country/long processus/relationship... has a beginning and an end, how come it has a simple point in time (P585) ? Bouzinac 💬●✒️●💛 08:34, 2 October 2020 (UTC) Maybe for wars it's less obvious why point in time (P585) can generally be sufficient. Check 37th Torino Film Festival (Q76087259) .. as many film festival editions, it just has the year in P585. Some editions have P580/P582, but is that really useful information for editions in the past? --- Jura 08:47, 2 October 2020 (UTC) In your example 37th Torino Film Festival (Q76087259) (that i've modified), beginning and end dates of a festival are obvious, more precise than date. And thus date should be removed. How would you sparql-query any event ocurred in 2019, be it with date=2019 or start-date>=2019>=end-date ? Bouzinac 💬●✒️●💛 08:54, 2 October 2020 (UTC) Well, unless you add start and end date to all other edition items (and keep adding them), I don't think deletion of P585 is an efficient approach. Reasonator would probably find it even without start/end date. --- Jura 09:01, 2 October 2020 (UTC) Oh .. it times-out even for not so recent years: https://reasonator.toolforge.org/?date=1780 --- Jura 09:11, 2 October 2020 (UTC) Je ne connais pas réasonator...C'est supposé faire quoi? Bouzinac 💬●✒️●💛 09:27, 2 October 2020 (UTC) A une époque, l'option ?date= faisait une jolie récapitulation basée sur P585, P580, P582, etc. --- Jura 09:30, 2 October 2020 (UTC) List of birds on ga Hi. As a continuum of 'List of living birds with an article on...' request I made a few weeks ago, I've added the code (which works on cy) onto gawiki here, but the Wikidata list does not update manually or overnight with Listeria. Any help please? Llywelyn2000 (talk) 07:27, 18 September 2020 (UTC) @Llywelyn2000: \"Overnight\" might take a couple of days. Given what is displayed when one clicks \"manual update\", it's seems to be the issue with the number of items (Topic:Vsgnh3njiw3ej3cl). Either you try to reduce \"LIMIT 1000\" to (e.g.) \"LIMIT 200\" (running the query directly on query service gives some ca. 550) or you ask Magnus to look into it. --- Jura 09:51, 20 September 2020 (UTC) Thanks Jura. Just back from a week off wiki. The odd thing is that the list works on cywiki but not on gawiki - which has a smaller number of articles on birds (650). It would be wonderful if this tool could be developed further; I used it as an alternative to 'See also'. I've left Magnus a message. Thanks again! Llywelyn2000 (talk) 11:27, 2 October 2020 (UTC) Get only the information from statements Hi,When I have a query like SELECT * WHERE {
  ?s ?label \"optimization\"@en .
  ?s ?p ?o
} I would like to have only the triples I see in the Statements box and the definition(s).Best: Stoyan @StoyanDim: This query will show the triples for all statements with best rank for entities with an English label \"optimization\": SELECT ?s ?sLabel ?property ?propertyLabel ?o ?oLabel
WHERE
{
  ?s rdfs:label \"optimization\"@en .
  ?s ?p ?o .
  ?property wikibase:directClaim ?p .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! --Dipsacus fullonum (talk) 12:21, 2 October 2020 (UTC) @Dipsacus fullonum: Thank you, it looks way better! I have two questions though: Is it possible not to leave out the identifiers, e.g. from the optimization example I need only what I see under Statements. Second, when I use the search box and type 'optimization', the first result is 'mathematical optimization', which I actually look for. How can I get this one instead of the (actually correct one) 'optimization'? Sorry if I'm too oriented to the UI, but I guess the results there also based on a SPARQL query only. @StoyanDim: The user interface may distinguish between statements and identifiers, but from a more technical point of view the identifiers are just a special type of statements. Anyway I can remove them from the results. Q24476018 is the only item with the label \"optimization\"@en, but Q141495 has it as an alias. That is the reason it is in the search. I can include aliases in the query: SELECT ?s ?sLabel ?property ?propertyLabel ?o ?oLabel
WHERE
{
  ?s rdfs:label | skos:altLabel \"optimization\"@en . # Look for both labels and aliases
  ?s ?p ?o .
  ?property wikibase:directClaim ?p .
  MINUS { ?property wikibase:propertyType wikibase:ExternalId . } # Remode external identifiers from the result
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
ORDER BY ?s
 Try it! --Dipsacus fullonum (talk) 20:39, 2 October 2020 (UTC) Result with more of one declaration Hello,I want to write a query to control if in my list of item one have more that one declaration in P31. Could you help me please. Here is the basis : #Sites archéologiques en Suisse
SELECT DISTINCT ?item ?itemLabel
WHERE 
{
  ?item wdt:P17 wd:Q39;
  wdt:P31/wdt:P279* wd:Q839954.
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],de,it,en\". }
}
ORDER BY ?itemLabel
 Try it! Thanks in advance!--2le2im-bdc (talk) 08:53, 3 October 2020 (UTC) Items used: Switzerland (Q39)   , archaeological site (Q839954)   Properties used: country (P17)   , instance of (P31)   , subclass of (P279)   #Sites archéologiques en Suisse, avec plus qu'une valeur en P31
SELECT DISTINCT 
  ?item ?itemLabel
  (COUNT(DISTINCT ?instance) as ?count)
  (GROUP_CONCAT( DISTINCT ?instanceLabel; separator=\", \" ) as ?instances) 
WHERE 
{
  ?item wdt:P17 wd:Q39;
  wdt:P31/wdt:P279* wd:Q839954.
  ?item wdt:P31 ?instance .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr,de,it,en\".
                         ?item rdfs:label ?itemLabel .
                         ?instance rdfs:label ?instanceLabel .
                         }
}
GROUP BY ?item ?itemLabel
HAVING (?count > 1) 
ORDER BY ?itemLabel Try it! @2le2im-bdc: maybe with the above? --- Jura 09:02, 3 October 2020 (UTC) Thanks a lot @Jura1:. --2le2im-bdc (talk) 09:08, 3 October 2020 (UTC) 1990 WTA Tour Hi, would like a list of all tennis tournaments which are part of the 1990 WTA tour (Q1134303). Fields: Label, Country, Start Date, End Date, Surface played on, Located in the administrative territorial entity, Prize Money. Thanks. --Wolbo (talk) 13:21, 3 October 2020 (UTC) @Wolbo: Hi, I write this : https://w.wiki/ewx. I had to use OPTIONAL as some items don’t have all the required fields. Lepticed7 (talk) 14:18, 3 October 2020 (UTC) @Lepticed7: thanks, that's exactly what I was looking for. The OPTIONAL statement is useful because it shows the gaps in the data. --Wolbo (talk) 14:32, 3 October 2020 (UTC) #based on a query by User:Lepticed7: https://w.wiki/ewx
SELECT ?item ?itemLabel ?y ?start ?end ?countryLabel ?surfaceLabel ?locationLabel ?unit ?prize ?partof ?partofLabel ?partof2 ?partof2Label
WHERE
{
  ?item wdt:P31 wd:Q47345468;
    wdt:P361 wd:Q1134303.
  OPTIONAL { ?item wdt:P585 ?y0 . BIND(YEAR(?y0) as ?y) }
  OPTIONAL { ?item wdt:P580 ?start. }
  OPTIONAL { ?item wdt:P582 ?end. }
  OPTIONAL { ?item wdt:P17 ?country. }
  OPTIONAL { ?item wdt:P765 ?surface. }
  OPTIONAL { ?item wdt:P276 ?location. }
  OPTIONAL { ?item p:P2121/psv:P2121 ?st . ?st wikibase:quantityAmount ?prize . OPTIONAL { ?st wikibase:quantityUnit/wdt:P498 ?unit }  } 
  OPTIONAL { ?item wdt:P361 ?partof . FILTER( ?partof != wd:Q1134303)  }
  OPTIONAL { ?item wdt:P31 ?partof2 . FILTER( ?partof2 != wd:Q47345468)  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! expanded the above query by Lepticed7 --- Jura 12:43, 4 October 2020 (UTC) Hi @Jura1:, is it possible to make a variation of this query which would list the number of tennis events per WTA Tour year? All fish I tried to get all species of fish by going through the qualifiers of fish (Q152) instance of (P31) organisms known by a particular common name (Q55983715), but it happened to also return me lion (Q140), so I first thought there's an error, but it happens that lions are Tetrapoda (Q19159) and tetrapods are Sarcopterygii (Q160830). OK, so I added a qualifier to say to excluding (P1011) tetrapods.So far so good. What's a query that returns me all species of fish now, given this new addition? I thought select ?taxon {
  wd:Q152 p:P31 ?s .
  ?s ps:P31 wd:Q55983715 .
  ?s pq:P642 ?o .
  ?taxon wdt:P171* ?o .
  minus {
    ?s pq:P1011 ?x .
    ?taxon wdt:P171* ?x .
  }
}
 Try it! might work, but it times out. Any ideas? --Denny (talk) 19:09, 29 September 2020 (UTC) @Denny: select ?taxon
with {
  select ?taxon where {
    ?taxon wdt:P171*/^pq:P642 [ps:P31 wd:Q55983715; ^p:P31 wd:Q152].
  }
} as %fishTaxa
with {
  select ?taxon where {
    ?taxon wdt:P171*/^pq:P1011 [ps:P31 wd:Q55983715; ^p:P31 wd:Q152].
  }
} as %exceptions
where {
  include %fishTaxa. minus { include %exceptions. }
}
 Try it! does not time out. --CamelCaseNick (talk) 19:36, 29 September 2020 (UTC) @CamelCaseNick: This is a truly wondrous thing! Thank you! --Denny (talk) 20:53, 29 September 2020 (UTC) There are not 52,723 species (of fish)? --Succu (talk) 21:26, 29 September 2020 (UTC) @Succu: Interesting point. So, this also includes higher taxa, not just species. If I filter only for species, the number goes down to 42,111. It also includes both extant and extinct species, and I wonder how complete we are on these. The following filters get it down to 40,905: https://w.wiki/eQC CAS lists 35,613. The discrepancy could be explained by either not all species being listed as extinct in a way I check here, or by having still too many taxa connected from fish. --Denny (talk) 22:27, 29 September 2020 (UTC) @Denny: It's easier to use FishBase species ID (P938): SELECT ?taxonName WHERE {
   ?item wdt:P105 wd:Q7432 . # species
   ?item wdt:P225 ?taxonName .
   ?item wdt:P938 ?id .
}
ORDER BY ?taxonName
 Try it! According to FishBase (Q837101) (ver. 12/2019) there are 34294 species of fish . --Succu (talk) 17:45, 5 October 2020 (UTC) Filtering by city I have this query for 'Palaces in Portugal. https://w.wiki/fDxI would like to filter this to only \"Palaces in Lisbon\" however most of the wikidata items do not have a city property. What's the best way to filter this to show only 'Palaces' within the city of Lisbon? Thanks --Nonoumasy (talk) 13:57, 5 October 2020 (UTC)Template:Nonoumasy @Nonoumasy: Most of the palace items have a located in the administrative territorial entity (P131) statement you can use. Add ?palace wdt:P131+ wd:Q597. to your query. --Dipsacus fullonum (talk) 14:58, 5 October 2020 (UTC) Filling missing images using Federated Queries in a SPARQL query Since some Wikidata items do not include images, is there a way to fill in these images using another data source outside of wikimedia? For eg, I have this SPARQL query: https://w.wiki/fDxSome of the \"Palaces of Portugal\" doesn't have a corresponding wikidata image, is it possible to find this image in another data source if such a source exists as a LOD? Any tips on solving this problem thru SPARQL is appreciated. Otherwise, I would use an API to fill in the images outside of SPARQL either in javascript or Python. --Nonoumasy (talk) 14:03, 5 October 2020 (UTC)Template:Nonoumasy @Nonoumasy: I don't know what LOD stands for, but you cannot use SPARQL to change or edit the content of Wikidata. You can use it to find those palaces that don't have a statement with image (P18). --Dipsacus fullonum (talk) 15:05, 5 October 2020 (UTC) https://fist.toolforge.org/wdfist/ might be useful to populate wikidata items with a commons image search tool (who adds images to the items). Bouzinac 💬●✒️●💛 15:13, 5 October 2020 (UTC) Sorry. I didn't explain well. I don't want to modify wikidata content. I am looking for a solution to get atleast one image from a sparql query even if some wikidata item do not have an image associated with it. --Nonoumasy (talk) 16:24, 5 October 2020 (UTC)Template:Nonoumasy @Nonoumasy: It is indeed possible to obtain additional data using a federated service. However, the list of federated databases is limited and most of them represent a specialized field of expertise. Therefore, it is unlikely that you will significantly enrich your dataset using images from outside Wikidata, unless you're interested in a particular specialized field.Vojtěch Dostál (talk) 17:27, 5 October 2020 (UTC) @Nonoumasy: This is a query for WCQS (Wikimedia Commons Query Service) with a federated call to WDQS. It will get images from Commons which depicts the palaces but there are only any when P18 is also used on Wikidata, so unfortunately there isn't much point in using it. SELECT ?palace ?palaceLabel (SAMPLE(?P18_image) AS ?image_from_Wikidata) (SAMPLE(?Commons_image) AS ?image_from_Commons) ?coords
WITH
{
  SELECT ?palace ?palaceLabel ?P18_image ?coords
  WHERE
  {
    SERVICE <https://query.wikidata.org/sparql>
    {
      ?palace wdt:P31 wd:Q16560;
              wdt:P17 wd:Q45.
      OPTIONAL { ?palace wdt:P625 ?coords. }
      OPTIONAL { ?palace wdt:P18 ?P18_image. }
      OPTIONAL { ?palace rdfs:label ?palaceLabel. FILTER (LANG(?palaceLabel) = \"pt\") }
    }
  }
} AS %get_items
WHERE
{
  INCLUDE %get_items
  OPTIONAL { ?Commons_image wdt:P180 ?palace. }
}
GROUP BY ?palace ?palaceLabel ?coords
 Try it! --Dipsacus fullonum (talk) 17:37, 5 October 2020 (UTC) Thanks. Those points make sense. I will probably just add using an API of some sort outside of WDQS. --Nonoumasy (talk) 06:56, 6 October 2020 (UTC){nonoumasy} List of movies released 10 years ago (dynamically with today's date) Hi everyone. I've built this query to get the movies released 10 years ago, but I would like to get the date dynamically so my query doesn't need to be updated every day. Could you help me here ? Thanks a lot ! Have a look at Wikidata:WikiProject_Movies/new_films. --- Jura 10:00, 6 October 2020 (UTC) Thank you ! Transpose multiple property statement values into columns Use case here is an item with up to three P921 statements. I'd like a single row for the item, with the three P921 values displayed in three columns. I'm clearly some way from my target.This fails in an accessible sort of a way if I try to show two main subject columns: SELECT  ?item ?itemLabel ?ms1 ?ms1Label ?ms2 ?ms2Label WHERE 
{
  VALUES ?item {
    wd:Q99536927   # 3 P921s
    wd:Q99689936   # 2 P921s
    wd:Q99927619   # 1 P921
    wd:Q100144327  # 0 P921s
    }
  optional {?item wdt:P921 ?ms1 .
    optional {?item wdt:P921 ?ms2 . filter(str(?ms1) > str(?ms2) )
              } 
           }       
  SERVICE wikibase:label {bd:serviceParam wikibase:language \"en\".}
  } order by ?item
 Try it! This fails with a not very comprehensible way when attempting three main subject columns: SELECT  ?item ?itemLabel ?ms1 ?ms1Label ?ms2 ?ms2Label ?ms3 ?ms3Label WHERE 
{
  VALUES ?item {
    wd:Q99536927   # 3 P921s
    wd:Q99689936   # 2 P921s
    wd:Q99927619   # 1 P921
    wd:Q100144327  # 0 P921s
    }  
  optional {?item wdt:P921 ?ms1 .
    optional {?item wdt:P921 ?ms2 . filter(str(?ms1) > str(?ms2) )
      optional {?item wdt:P921 ?ms3 . filter(str(?ms1) > str(?ms3) && str(?ms2) > str(?ms3) ) 
                } 
              } 
           }       
  SERVICE wikibase:label {bd:serviceParam wikibase:language \"en\".}
  } order by ?item
 Try it! I'm probably heading in a poor direction & need help. fwiw, the dataset of interest right now has 0-3 P921 values, but, one day, will have instances having 4 or more P921s. Is there a solution is the presumption of 0-3 cases is made? (I appreciate I could group_concat, but I'm trying to avoid that route, preferring a one-value-per-cell output). thx. --Tagishsimon (talk) 22:04, 6 October 2020 (UTC) @Tagishsimon: I suggest using a subquery to order the P921 statements for each item: SELECT  ?item ?itemLabel
  (SAMPLE(?ms1_) AS ?ms1) (SAMPLE(?ms1_Label) AS ?ms1Label)
  (SAMPLE(?ms2_) AS ?ms2) (SAMPLE(?ms2_Label) AS ?ms2Label)
  (SAMPLE(?ms3_) AS ?ms3) (SAMPLE(?ms3_Label) AS ?ms3Label)
WHERE 
{
  OPTIONAL {
    {
      SELECT ?item ?ms (COUNT(?lt) AS ?number)
      WHERE
      {
        VALUES ?item {
          wd:Q99536927   # 3 P921s
          wd:Q99689936   # 2 P921s
          wd:Q99927619   # 1 P921
          wd:Q100144327  # 0 P921s
        }
        OPTIONAL
        {
          ?item wdt:P921 ?ms .
          ?item wdt:P921 ?lt .
          FILTER (STR(?lt) <= STR(?ms))
        }
      }
      GROUP by ?item ?ms
    }
  }
  BIND (IF (?number = 1, ?ms, ?unbound) AS ?ms1_)
  BIND (IF (?number = 2, ?ms, ?unbound) AS ?ms2_)
  BIND (IF (?number = 3, ?ms, ?unbound) AS ?ms3_)
  SERVICE wikibase:label {
    bd:serviceParam wikibase:language \"en\" .
    ?item rdfs:label ?itemLabel .
    ?ms1_ rdfs:label ?ms1_Label .
    ?ms2_ rdfs:label ?ms2_Label .
    ?ms3_ rdfs:label ?ms3_Label .
  }
}
GROUP BY ?item ?itemLabel
 Try it! --Dipsacus fullonum (talk) 23:43, 6 October 2020 (UTC) Thank you Dipsacus fullonum; I take my hat off to you. So much to admire in that query. Tell me please, why must the subquery be OPTIONAL? If removed, the query times-out, but I don't apprehend why. thx. --Tagishsimon (talk) 01:35, 7 October 2020 (UTC) It is a trick to prevent reordering of the query by the optimizer. It cannot move anything from after an OPTIONAL expression to the front of it, as that would change the semantics of the query. It would work the same way to make it into a named subquery. --Dipsacus fullonum (talk) 06:34, 7 October 2020 (UTC) Things I learn. Thank you. --Tagishsimon (talk) 13:30, 7 October 2020 (UTC) Extinction of animals Hello (Wikidata) World!A list of extinct animal species and date/approximate date of extinction would be much appreciated. Asking for a friend (who proposes to build a memorial wall in the style of war memorials; I proposed a web page to start with).Thanks in anticipation. Michaelgraaf (talk) 15:32, 7 October 2020 (UTC) Cats interwiki Hello, I need articles from Category:Felids on English Wikipedia that are missing in Ukrainian Wikipedia but avoiding asteroids/galaxies (there are many in Category:Lynx (constellation) and similar)--Anntinomy (talk) 16:11, 5 October 2020 (UTC) @Anntinomy: This query will make the list. Note that en:Category:Lynx (constellation) isn't a subcategory in en:Category:Felids so articles about the constellation are not in the list. SELECT DISTINCT ?title_en ?sitelink_en ?item
WITH
{
  SELECT ?title_en
  WHERE
  {
    SERVICE wikibase:mwapi
    {
      bd:serviceParam wikibase:api \"Search\" .
      bd:serviceParam wikibase:endpoint \"en.wikipedia.org\" .
      bd:serviceParam mwapi:srnamespace \"0\" .
      bd:serviceParam mwapi:srsearch 'deepcat:Felids' .
      ?title wikibase:apiOutput mwapi:title .
    }
    BIND (STRLANG(?title, \"en\") AS ?title_en)
  }
} AS %get_titles_en
WITH
{
  SELECT ?title_en ?sitelink_en
  WHERE
  {
    INCLUDE %get_titles_en
    ?sitelink_en schema:name ?title_en.
  }
} AS %get_sitelinks_en
WITH
{
  SELECT ?title_en ?sitelink_en ?item
  WHERE
  {
    INCLUDE %get_sitelinks_en
    ?sitelink_en schema:isPartOf <https://en.wikipedia.org/>.
    ?sitelink_en schema:about ?item.
  }
} AS %get_items_en
WHERE
{
  INCLUDE %get_items_en
  MINUS
  {
    [] schema:about ?item;
       schema:isPartOf <https://uk.wikipedia.org/>.
  }
}
 Try it! --Dipsacus fullonum (talk) 18:46, 5 October 2020 (UTC) Thanks! --Anntinomy (talk) 19:41, 5 October 2020 (UTC) @Dipsacus fullonum: I need to clean it from cartoons and some other staff. I think I`ll be able to do this if you show where to add avoidance. Thanks again! --Anntinomy (talk) 16:34, 11 October 2020 (UTC) @Anntinomy: The category en:Category:Felids do include en:Category:Fictional felids. You could exclude it, but wouldn't it be better to define which items/articles you want in your list by using data from Wikidata instead of by placement in some Wikipedia category? --Dipsacus fullonum (talk) 16:51, 11 October 2020 (UTC) Querry for Wikimedia Commons Hi, I hope it's the right place to ask. Here is a querry to show the files that have depicts (P180) athletics competitor (Q11513337): #shows files that depict athletics competitors
#defaultView:ImageGrid
SELECT ?file ?image WHERE {
  ?file wdt:P180 wd:Q11513337.
  ?file schema:contentUrl ?url .
  bind(iri(concat(\"http://commons.wikimedia.org/wiki/Special:FilePath/\", wikibase:decodeUri(substr(str(?url),53)))) AS ?image)
}
 Try it! This querry is quite limited but this is about the maximum of my capacities. Can someone make a querry to show all the files that have: depicts (P180) → items with → occupation (P106) athletics competitor (Q11513337) and with Commons quality assessment (P6731) Wikimedia Commons valued image (Q63348040) Precise exemple: File:Antonella Bellutti.jpg, this file depict Antonella Bellutti (Q436450) (this item has occupation (P106) athletics competitor (Q11513337)), and the file has the right assessment in structured data, therefore the image should be included within the results of this querry. Is it possible to do such a thing? Christian Ferrer (talk) 16:02, 8 October 2020 (UTC) @Christian Ferrer: It is possible. The query needs to contain a federated query to WDQS to get the entities for athletics competitors. I placed the federated query in a subquery for efficiency reasons. #shows files that depict athletics competitors
#defaultView:ImageGrid
SELECT ?file ?image
WITH
{
  SELECT ?item
  WHERE
  {
    SERVICE <https://query.wikidata.org/sparql>
    {
      ?item wdt:P106 wd:Q11513337 .
    }
  }
} AS %get_items
WHERE
{
  INCLUDE %get_items
  ?file wdt:P180 ?item .
  ?file schema:contentUrl ?url .
  ?file wdt:P6731 wd:Q63348040 .
  BIND(IRI(CONCAT(\"http://commons.wikimedia.org/wiki/Special:FilePath/\", wikibase:decodeUri(SUBSTR(STR(?url),53)))) AS ?image)
}
 Try it! --Dipsacus fullonum (talk) 17:20, 8 October 2020 (UTC) Excelent! Thanks you very much! Christian Ferrer (talk) 17:23, 8 October 2020 (UTC) Members of the European Parliament of the first legislature Hello, I'm a pretty noob in terms of SPARQL queries, so I'd like to ask for help to create a list (table) of Member of the European Parliament (Q27169) with parliamentary term (P2937):First European Parliament (Q17315702), ideally with the following additional columns start time (P580), end time (P582), parliamentary group (P4100), represents (P1268), electoral district (P768) and elected in (P2715). Thank you! --Jcornelius (talk) 18:19, 10 October 2020 (UTC) @Jcornelius: SELECT ?MEP ?MEPLabel ?start ?end ?groupLabel ?representsLabel ?constituencyLabel ?electionLabel
WHERE
{
  ?MEP p:P39 ?MEPstatement .
  ?MEPstatement ps:P39 wd:Q27169 .
  ?MEPstatement pq:P2937 wd:Q17315702 .
  OPTIONAL { ?MEPstatement pq:P580 ?start . }
  OPTIONAL { ?MEPstatement pq:P582 ?end . }
  OPTIONAL { ?MEPstatement pq:P4100 ?group . }
  OPTIONAL { ?MEPstatement pq:P1268 ?represents . }
  OPTIONAL { ?MEPstatement pq:P768 ?constituency . }
  OPTIONAL { ?MEPstatement pq:P2715 ?election . }  
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],de,en\" . }
}
 Try it! --Dipsacus fullonum (talk) 00:13, 11 October 2020 (UTC) @Dipsacus fullonum:: Thanks a lot! --Jcornelius (talk) 16:31, 11 October 2020 (UTC) From Canada, has Wikitree, does not have FamilySearch Hello! Could I request that someone write a query for records where the person is from Canada (per P27), has a value for WikiTree person ID, but does not have a value for FamilySearch person ID, please? Thanks! -- Zanimum (talk) 15:12, 11 October 2020 (UTC) country of citizenship (P27) Canada (Q16) WikiTree person ID (P2949) FamilySearch person ID (P2889) Items used: Canada (Q16)   Properties used: country of citizenship (P27)   , WikiTree person ID (P2949)   , FamilySearch person ID (P2889)   , date of birth (P569)   , date of death (P570)   , place of birth (P19)   , country (P17)   , place of death (P20)   """@en;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:Request_a_query/Archive/2020/10>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d89683-wikidata_prefixes;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX bd: <http://www.bigdata.com/rdf#>
SELECT 
  ?item ?itemLabel ?itemDescription 
  ?wt
  ?dob ?dod 
  ?pob ?pobLabel ?cobLabel
  ?pod ?podLabel ?codLabel
  ?st ?sl ?ids
WHERE
{
  ?item wdt:P27 wd:Q16 .
  ?item wdt:P2949 ?wt . 
  MINUS { ?item wdt:P2889 [] }
  OPTIONAL { ?item wdt:P569 ?dob }
  OPTIONAL { ?item wdt:P570 ?dod }  
  OPTIONAL { ?item wdt:P19 ?pob . ?pob wdt:P17 ?cob }    
  OPTIONAL { ?item wdt:P20 ?pod . ?pod wdt:P17 ?cod }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en,fr\". }
  ?item wikibase:statements ?st ; wikibase:sitelinks ?sl ; wikibase:identifiers ?ids 
}""" .
