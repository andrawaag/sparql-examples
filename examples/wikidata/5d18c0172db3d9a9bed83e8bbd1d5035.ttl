@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-5d18c0172db3d9a9bed83e8bbd1d5035> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  sh:select """SELECT ?film ?filmLabel ?filmDescription 
WHERE 
{
  ?film wdt:P31 wd:Q11424 ; schema:description \"film\"@nl .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
}
LIMIT 10561""";
  rdfs:comment """ This page is an archive. Please do not modify it. Use the current page, even to continue an old discussion. Contents 1 georeferencing old placenames 2 How to former official city names? 3 How to filter out the minimum value of an expression X and get more columns than that particular expression besides the column(s) for the GROUP BY by expression(s)? 4 Show only first image 5 wd:Q468455 (death by burning) or wd:Q337935 (necromancy) 6 Articles by publisher? 7 I'd like to \"OR\" search 8 lonelyitems clone 9 How to get only the first image? 10 Films where Dutch description is film 11 Number of species names that are not synonyms 12 commons category property does not match commons category sitelink 13 P4812 14 Restrict results to entities 15 has (P238:\"IATA airport code\") or (P239:\"ICAO airport code\") and no english sitelinks ( en.wikipedia.org ) 16 Virus parent taxa 17 How to get wikibase:mwapi to display more than 50 results? 18 Names of African countries in all their official languages 19 List of episodes of TV series 20 Timeout 21 People without Dutch description 22 Places in West Bengal 23 Q2225692 24 Query is malformed: Bad aggregate 25 Get all parent taxons 26 without sitelinks to de.wikipedia 27 Counting results 28 Virtual graph ? 29 Example for Anti-Timeout 30 Path query running very very slow 31 Date of birth = Jan 1 32 Q17318027 33 One ID and no other 34 Grouping result by entity, not by property georeferencing old placenames Hello everybody,I am a researcher at an university and try to write an algorithm for georeferencing old placenames. As I have to test the name for certain spelling mistakes or dialects with the levenshtein-distance, I need a list of all human settlements from wikidata with a certain amount of data (name (german), alternate name(german), coodinates, ISO 3166-1 alpha-2 code of state were the settlement is located and the types of settlement (town, vilage, capital, and so on) I have trouble solve the task. As I understand, the query will need a lot of time, so I set up a local wikidata but I still do not get the information, as I need it. The problem is, that there can be more than one type associetaed to one settlement. so I have to group my output in order to prevent duplicate results.Here is my query so far: SELECT ?item ?itemLabel ?altname ?coord ?staat ?kurz (group_concat(?art) as ?arten)
                   WHERE
                   {
                       ?item wdt:P31/wdt:P279* wd:Q486972.
                                ?item rdfs:label ?itemLabel filter (lang(?itemLabel) = \"de\").
                                ?item wdt:P17 wd:Q183.
                                OPTIONAL{?item wdt:P1448 ?altname filter (lang(?altname) = \"de\"). }
                               ?item  wdt:P625 ?coord.
                         OPTIONAL{?item wdt:P17 ?staat }.
                         OPTIONAL{?staat wdt:P297 ?kurz }.
                         OPTIONAL{?item wdt:P31 ?art}.
                   }
                   group by ?item ?itemLabel ?altname ?coord ?staat ?kurz does anybody see mistakes, why I get timeouts, even on a local wikidata? --19:57, 14 February 2018‎ special:contribs/snjuk How to former official city names? Hello everyone. Does anyone has a clue, how I can get old official place names? For example city (Q515) has several official names. But if I query the property, I get only the new one. How could I get all of the Place names? Old official names included?sincerely,Erik--22:58, 24 February 2018‎ special:contribs/snjuk I moved this from category talk:request a query archive to here and refreshed the discussion at wikidata:request a query#RE:How_to_former_official_city_names?. Arlo Barnes (talk) 04:07, 5 July 2020 (UTC) How to filter out the minimum value of an expression X and get more columns than that particular expression besides the column(s) for the GROUP BY by expression(s)? I have this result: ?item ?expression_X ?expression_Y item1 2 y1 item1 1 y2 item1 3 y3 item2 11 y4 item2 22 y5 item3 7 y6 item3 5 y7 With a query like SELECT ?item (MIN(?expression_X) AS ?min_X)
GROUP BY ?item I will get this. ?item ?min_X item1 1 item2 11 item3 5 i.e. just keep the one row per item with the minimum value on expression_X for the respective item.My question is: What type of query/subquery should I use to get the following result? ?item ?min_X ?expression_Y item1 1 y2 item2 11 y4 item3 5 y7 i.e. with the column for ?expression_Y kept? --Larske (talk) 12:09, 31 January 2018 (UTC) Don't have time to write you an example query, but I think the stategy is a query with three parts - first, turn the full existing query into a named sub-query, then set ?min_X to the minimum value of X in the results of the sub-query, than set ?Y to the value of Y that corresponds to ?min_X in the sub-query results. Jheald (talk) 15:01, 31 January 2018 (UTC) Interesting question. If I understand this correctly : https://www.w3.org/TR/sparql11-query/#aggregateRestrictions then an approach like SELECT ?item (MIN(?expression_X) AS ?min_X) ?expression_Y
GROUP BY ?item ( … as ?expression_Y)
 – The preceding unsigned comment was added by TomT0m (talk • contribs) at 16:22, 31 January 2018‎ (UTC). (ec) I'll come back to the sub-query approach in a moment. Before that, here's a more basic approach, taking advantage of User:Andrew Gray's outstanding work on the history of the House of Commons in the UK to find the \"Baby of the House\" (ie the youngest MP) in each parliament. The approach is to have an inner query that finds the latest date of birth in each parliament, then an outer query that finds which MP in that parliament had that date of birth. SELECT ?parlLabel ?parl_start ?item ?itemLabel ?dob WHERE {
  {
    SELECT ?parl (MAX(?dob) AS ?dob) WHERE {
        ?item wdt:P39 ?parl .
        ?parl wdt:P279 wd:Q16707842 .
        ?item wdt:P569 ?dob .
    } GROUP BY ?parl 
  }
  ?item wdt:P39 ?parl .
  ?item wdt:P569 ?dob .
  ?parl wdt:P571 ?parl_start .
      
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
} ORDER BY ?parl_start
 Try it! The query reveals a couple of anomalies in the earliest parliaments that Andrew is just getting to the clean-up stage for -- Thomas Williams (Q7793765) who was apparently elected at the age of twelve, and John Aldridge (Q26250395) elected at the age of minus three! (Pedantic footnote: the query doesn't check that the MP served for the whole parliament -- for example, like David Steel (Q333847) they may have been elected at a bye-election; in which case there might have been a different MP, not listed here, who had been baby of the House up until that point). Jheald (talk) 16:26, 31 January 2018 (UTC) I had a pattern for the subquery that seem to match yours : select ?item ?min_X ?y {

  { SELECT ?item (MIN(?expression_X) AS ?min_X) GROUP BY ?item. }
  
  [ triple pattern or subquery compute ?x and ?y from ?item using expressionX and expressionY ]
  
  filter ( ?x = ?min_X) .
}
 author TomT0m / talk page 16:37, 31 January 2018 (UTC) Let me get back to you on that. Meanwhile, here is basically the same query as before, but this time using a named subquery: SELECT ?parlLabel ?parl_start ?item ?itemLabel ?dob 
  WITH {
    SELECT ?item ?parl ?dob WHERE {
        ?item wdt:P39 ?parl .
        ?parl wdt:P279 wd:Q16707842 .
        ?item wdt:P569 ?dob .
    }
  } AS %sub_query_results

WHERE {
  {
    SELECT ?parl (MAX(?dob) AS ?dob) WHERE {
      INCLUDE %sub_query_results .
    } GROUP BY ?parl
  }
  INCLUDE %sub_query_results .
  ?parl wdt:P571 ?parl_start .
      
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
} ORDER BY ?parl_start
 Try it! This runs slightly more efficiently, because it only looks up the dates of births for the MPs in each parliament once, rather than twice as in the original query. The solution set from this is stored in the variable %sub_query_results One can then INCLUDE it, as a solution set, in the main query. Above, we do this twice: first in the inner query, which finds the latest DoB for each parliament in that solution set. Then in the outer query, we match the parliament and the DoB from the inner query to the rows in the INCLUDED solution set -- this is just SPARQL joining the results from different solution sets in the usual way, by stating the relevant requirements one after the other. The result is a query that completes a bit faster -- and also is easy for the engine to optimise, because we have explicitly told it (with the sub-query) what part of the query to run first. Note, btw, that %sub_query_results is just a variable name -- we could have called it anything. Jheald (talk) 16:51, 31 January 2018 (UTC) Thanks Jheald for your assistance! The named subquery did the trick. I just had to refrain from changing the variable name in \"(MIN(?x) AS ?x)\" in order for the JOIN to work as expected. Btw, if you look for the oldest members in the different parliaments, you will find other anomalies, like Sir Charles Burrell, 3rd Baronet (Q7526182) who probably wasn's very talkative in the three parliaments he was member of three to twelve years after his death. --Larske (talk) 20:16, 31 January 2018 (UTC) Love it! Paging @Andrew Gray: :-) Srsly, Andrew's done/doing a brilliant job of cleaning this dataset up -- you can really see the cut-off of where he's got to so far, going back in time, and more recently than that the anomalies are very very few (if any?) Serious respect is deserved. Jheald (talk) 20:27, 31 January 2018 (UTC) @Larske, Jheald: thanks both for these queries - they're really interesting to look at! At the moment I'm importing data from the Historic Hansard database, and we know that has some... interesting issues for less prominent people. I'm going through in parallel checking records against more reliable sources where they seem inconsistent, but hadn't done a run on birth and death dates yet. People being listed as MPs after their death was a surprise! I'll dig into these a bit more and get them corrected - thanks again for spotting them. Andrew Gray (talk) 20:40, 31 January 2018 (UTC) @Andrew Gray: William Kirk (Q8014050) is another one who was a member of two parliaments after his death. --Larske (talk) 12:10, 1 February 2018 (UTC) Show only first image I have a query that works nicely: #defaultView:Map
SELECT ?item ?itemLabel ?itemDescription ?locationLabel ?coord (SAMPLE(?img) AS ?img) WHERE {
        ?item wdt:P31 wd:Q1965390 .
        ?item wdt:P276 ?location .
        ?location wdt:P625 ?coord .
        OPTIONAL { ?item wdt:P18 ?img . }
        SERVICE wikibase:label { bd:serviceParam wikibase:language \"de,de\". }
    }
GROUP BY ?item ?itemLabel ?itemDescription ?locationLabel ?coord
 Try it! Now some of the items have multiple images (e. g. look at the one dot that there is in \"Stuttgart\" right now), but I want only one to show, that's why there is the \"SAMPLE\" function. Is it possible to replace the SAMPLE part with something that shows me not any random, but only the first of the images in an item as in the sequence shown in the Wikidata user interface? How are multiple items in a property ranked anyway in a SPARQL query? Will the SAMPLE query always randomly chose, or will it at least chose between images of preferred rank? I can't find anything about that.What would be even better for my purpose would be a way to show a little gallery of all (or, say, the first 10) images in the item within that blurb that pops up on the map created by SPARQL (without creating multiple dots). Probably a feature request rather than a query request, but if it's already possible, I'd like to know it, too. Thanks in advance --Anvilaquarius (talk) 14:33, 2 February 2018 (UTC) If there are any images for an item that have preferred rank, then wdt:P18 will only see those, and won't see any of the others at all. In general this technique should only be used with caution, because you would also be hiding those images (or, more generally, values) from anybody else writing a query who only looked with wdt: The function MIN() can be used as a deterministic replacement for SAMPLE() -- here I presume it would return the first filename in alphabetic sequence, which may not be what you are looking for. If you want to select a particular image for each item, another approach might be to add a object of statement has role (P3831) qualifier to distinguish between the nature of the presented images. A sequence of OPTIONAL { } clauses would let you look for particular values in a preferential order. Jheald (talk) 14:53, 2 February 2018 (UTC) Thanks for the info. I feared so much... I didn't know about the \"preferred\" problems so I won't use this idea. --Anvilaquarius (talk) 16:54, 2 February 2018 (UTC) wd:Q468455 (death by burning) or wd:Q337935 (necromancy) Hi, I should want all women whom death by burning or by necromancy. I do : SELECT ?iteme ?itemeLabel
WHERE {
  ?iteme wdt:P31 wd:Q5 ;
          wdt:P21 wd:Q6581072.
  OPTIONAL {
    ?iteme wdt:P1399 ?condamnation. 
    ?condamnation wdt:P31 wd:Q337935.
  }
  OPTIONAL {
    ?iteme wdt:P509 ?deces. 
    ?deces wdt:P31 wd:Q468455.
  }
  FILTER(BOUND(?deces)|| BOUND(?condamnation)).
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"fr\" }
}
 Try it! ... but I get nothing. Why ? --Touam (talk) 19:47, 3 February 2018 (UTC) @Touam: Pretty-much nothing links to necromancy (Q337935) - see https://www.wikidata.org/wiki/Special:WhatLinksHere/Q337935 ... so that element of the query will return little. Then, looking at the construction of the P509 / Q468455 clause, there does not seem to be a cause of death which is itself an instance of death by burning. Simpler by far to look for: SELECT ?iteme ?itemeLabel
WHERE {
    ?iteme wdt:P509 wd:Q468455;
            wdt:P21 wd:Q6581072. 
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"fr\" }
}
 Try it! Following the spirit of your query (and there's probably a better way to do this), there's: SELECT ?iteme ?itemeLabel ?condamnationLabel ?decesLabel
WHERE {
  ?iteme wdt:P31 wd:Q5 ;
          wdt:P21 wd:Q6581072.
  OPTIONAL {
    ?iteme wdt:P1399 wd:Q337935.
    ?iteme wdt:P1399 ?condamnation
  }
  OPTIONAL {
    ?iteme wdt:P509 wd:Q468455.
    ?iteme wdt:P509 ?deces 
  }
  FILTER(BOUND(?deces)|| BOUND(?condamnation)).
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"fr\" }
}
 Try it! hth --Tagishsimon (talk) 21:04, 3 February 2018 (UTC) Articles by publisher? Hi! If I wanted to find a list of individual scientific articles by publisher in Wikidata, how would I do that?For instance, say I want to find all papers published by ACM. Right now, the item for the individual paper, eg this one: Harnessing the wisdom of crowds in wikipedia: quality through coordination (Q35966281) notes that it is published in the proceedings where it came from. The item for the proceedings: Proceedings of the 2008 ACM conference on Computer supported cooperative work (Q35966560) notes that it is published by ACM Association for Computing Machinery (Q127992).How can I do the transitive search to get: all of the items that are published in (P1433) proceedings (Q1143604) that are in turn published by Association for Computing Machinery (Q127992)? Note: there's of course journals and many non-proceedings publications by ACM, but once I figure out how to do this with one case I think I can just extrapolate. Thanks for the help! -- Phoebe (talk) 15:40, 5 February 2018 (UTC) @Phoebe: Here is a query proposal: SELECT ?publisherLabel ?publicationtypeLabel ?publicationLabel ?article ?articleLabel WHERE
{
  VALUES ?publisher { wd:Q127992 }  # add more publishers here
  VALUES ?publicationtype { wd:Q1143604 }  # add more publication types here
  ?article wdt:P1433 ?publication .
  ?publication wdt:P31 ?publicationtype .
  ?publication wdt:P123 ?publisher .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
 } 
 ORDER BY ?publisherLabel ?publicationtypeLabel ?publicationLabel ?articleLabel
 Try it! --Larske (talk) 18:44, 5 February 2018 (UTC) brilliant, thanks @Larske:! Phoebe (talk) 19:49, 5 February 2018 (UTC) I'd like to \"OR\" search I'd like to show items that are added Q7075 (Library) or Q28564 (Public Library) as P31 (instance of). How do I do? The code shown below returned error:(--軽快 (talk) 16:13, 6 February 2018 (UTC) SELECT ?lib ?libLabel WHERE {
  ?lib (wdt:P31 wd:Q7075)|| (wdt:P31 wd:Q28564).
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"ja\". }
}
 Try it! Use VALUES: SELECT ?lib ?libLabel WHERE {
  VALUES ?lib_class { wd:Q7075 wd:Q28564 }
  ?lib wdt:P31 ?lib_class .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"ja\". }
}
 Try it! It might also be worth to query for all subclasses of library (Q7075): SELECT ?lib ?libLabel WHERE {
  ?lib wdt:P31/wdt:P279* wd:Q7075 .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"ja\". }
}
 Try it! —MisterSynergy (talk) 16:17, 6 February 2018 (UTC) I received good results. Thank you for your help! --軽快 (talk) 23:23, 6 February 2018 (UTC) lonelyitems clone Bene*'s Lonely items tool no longer functions, and no one can seem to get a hold of Bene* even as it appears there is no public repository for the tools' code, so I have been trying to build a clone myself using Quarry. The query I suspected might work is as follows:select wb_terms.term_full_entity_id, secondtable.ips_site_page
 from wb_terms
 inner join (select * from wb_items_per_site where ips_item_id in
           (select ips_item_id from wb_items_per_site group by ips_item_id having count(*)=1)
           and ips_site_id = 'bnwiki') as secondtable
 on wb_terms.term_entity_id=secondtable.ips_item_id
 limit 50 where 'bnwiki' could be any other wiki and the limit need not be 50 items, but the query always seems to hang. Is there a better way of writing a query to do what lonelyitems did? Mahir256 (talk) 06:05, 6 February 2018 (UTC) Do you have a Wikitech/Toolforge account? The code of bene's tools is actually readable for all users (as all tool sources on Toolforge are by default). —MisterSynergy (talk) 06:26, 6 February 2018 (UTC) @MisterSynergy: No, as I have not needed to use it since whatever Wikimedia code I needed to look at was on the appropriate GitHub mirror. Where on Toolforge can I find Bene*'s code? Mahir256 (talk) 06:36, 6 February 2018 (UTC) Assuming you don’t have an account: create one at wikitech-wiki (I recommend to use the same user name as here) and set it up properly (you need to register public keys, and so on). There is “Getting started” documentation available at wikitech-wiki, and if something does not work as expected they help in the IRC channels. Once this is done, you can connect to the Toolforge console (login.tools.wmflabs.org, on Windows e.g. by using PuTTY) and do nano /data/project/bene/public_html/lonelyitems/index.php — or create your own tools. —MisterSynergy (talk) 06:44, 6 February 2018 (UTC) @MisterSynergy: Okay, I have created an account there and am awaiting approval of my membership request so that I can connect properly. Mahir256 (talk) 06:52, 6 February 2018 (UTC) ┌────────────────────────────────────────────────────────────────────────────────────────────────────┘ @MisterSynergy: So I am running the query being built here and it does return results. The portion of the code where the error occurs is here (reposted for clarity): $repo = mysqli_connect_wiki( 'wikidatawiki' );
 $sql = createSQL( $repo, $wiki, $offset, $limit );
 $url = htmlspecialchars( getUrl( $repo, $wiki ) );
 $wikihtml = htmlspecialchars( $wiki );
 if( $result = $repo->query( $sql ) ) {
   // spit out the result; omitted for clarity
 }
 else {
   echo '<p class=\"error\">Sorry, there was an error performing your request.</p><small>Technical details: ' . $repo->error . '</small></p>';
  } At one point in the past, the query could run for a long time but would still output results at the end. Now it terminates immediately, without any warning, irrespective of the parameters passed to construct the query itself. Do you or someone else familiar with connecting to (clone) databases know what the problem may be? Mahir256 (talk) 05:45, 8 February 2018 (UTC) No clear idea. Some files such as /data/project/bene/config.php are access-restricted for whatever reason, so we cannot look into them. Typically only ~/replica.my.cnf needs to have restrictive permissions (which it has by default), since it contains tool-specific database credentials. So I don’t fully understand how this tool connects to the database, the mysqli_connect_wiki() function is basically a black box. However, some weeks ago (November?) they have changed the aliases of the database hosts (see history of wikitech:Help:Toolforge/Database). I can’t tell whether the old ones still work, but this might be an issue here. —MisterSynergy (talk) 06:21, 8 February 2018 (UTC) @Mahir256: I managed to get a (temporary) clone of this tool running at tools.wmflabs.org/mstools/lonelyitems-clone/, with my own PDO database connector instead of Bene's approach. You can read all relevant code, except for the database credentials.However, after I saw the results I am pretty sure that the same can be achieved with the Query Service:SELECT ?item ?name ?sitelink WHERE {
  ?sitelink schema:about ?item; schema:isPartOf <https://bn.wikipedia.org/>; schema:name ?name .
  ?item wikibase:sitelinks 1 .
}
 Try it!—MisterSynergy (talk) 09:14, 8 February 2018 (UTC)How to get only the first image? This gives me all the images for each event: #defaultView:Timeline

SELECT ?Chaos_Communication_Camp ?Chaos_Communication_CampLabel ?start_time ?image WHERE {
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
  ?Chaos_Communication_Camp wdt:P361 wd:Q450487.
  OPTIONAL { ?Chaos_Communication_Camp wdt:P580 ?start_time. }
  OPTIONAL { ?Chaos_Communication_Camp wdt:P18 ?image. }
}
 Try it! I want only the first. how? --Loominade (talk) 13:45, 7 February 2018 (UTC) Set one of them to prefered on Wikidata itself. Otherwise there is no reason to have multiple image statements. Sjoerd de Bruin (talk) 13:52, 7 February 2018 (UTC) You may want to use SAMPLE (note that this needs also the line with GROUP BY to work). It's not the first image, but a random one. See my similar thread and same problem above. #defaultView:Timeline

SELECT ?Chaos_Communication_Camp ?Chaos_Communication_CampLabel ?start_time (SAMPLE(?image) as ?image) WHERE {
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
  ?Chaos_Communication_Camp wdt:P361 wd:Q450487.
  OPTIONAL { ?Chaos_Communication_Camp wdt:P580 ?start_time. }
  OPTIONAL { ?Chaos_Communication_Camp wdt:P18 ?image. }
}
GROUP BY ?Chaos_Communication_Camp ?Chaos_Communication_CampLabel ?start_time
 Try it! --Anvilaquarius (talk) 13:17, 8 February 2018 (UTC) Films where Dutch description is film I'm looking for films where the Dutch description is film. (Not contains the word film, but the description is the word film). I've tried: SELECT DISTINCT ?film ?filmLabel ?desc WHERE {
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
  ?film wdt:P31 wd:Q11424.
  ?film schema:description ?desc FILTER ((lang(?desc))=\"nl\") .
  FILTER(?desc=\"film\") .
}
LIMIT 100
 Try it! That didn't work. When I remove the second filter, I do get results with a description that is only the word film. What am I doing wrong (and how can I do it right)? Mbch331 (talk) 21:33, 7 February 2018 (UTC) Items used: film (Q11424)   Properties used: instance of (P31)   """@en;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:Request_a_query/Archive/2018/02>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:wikidata_prefixes;
  schema:target <https://query.wikidata.org/sparql/> .
