@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-e126d8096222efc6962bfb0ecb6bcea4> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/th>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eu>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en-gb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/vec>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/hy>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/id>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/be-tarask>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/tr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ro>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/he>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/zh>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pt-br>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/si>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eo>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/da>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ar>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ko>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ms>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/sv>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lt>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ca>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/uk>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/it>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ja>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/es>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/cs>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ru>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/de>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d857023-wikidata_prefixes, _:genid-4e694113159d4e3db4a1a913894a81d857023-6676AE46FBBE8E43C8BB2587CE8DF42D,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-15CDA9E0A32E62BFDFF1C9C7A8BB3202, _:genid-4e694113159d4e3db4a1a913894a81d857023-5E51A8EAC4AD3223C6FEEB320FE50AF1,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-0EEC3208399221C40D42A482E822E041, _:genid-4e694113159d4e3db4a1a913894a81d857023-7E92AF07EDFEEA944F6484BAFE270E3D,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-253DFA1BC7A477982D5B9F92F6D4FD1D, _:genid-4e694113159d4e3db4a1a913894a81d857023-D09302BC5B29682038A9496272FAE295,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-69D1EC2AFBE4E940947F4C30BE69A3A8, _:genid-4e694113159d4e3db4a1a913894a81d857023-C078630C3B2E8E9D49A7282797C0A3BD,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-7163807EE228E11729DB672C48ECCC19, _:genid-4e694113159d4e3db4a1a913894a81d857023-2738E5B4D9533FA6E1E1F26CDAE03491,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-2F7A80BFAFE448C78D917F292A849976, _:genid-4e694113159d4e3db4a1a913894a81d857023-9E7A3A1D08497781A3047943BDA98D2A,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-F963A289E0E3EAC539F6A3BE6C99ADC8, _:genid-4e694113159d4e3db4a1a913894a81d857023-603F449ABD17163689A9F0EF8E2700A8,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-B7928247DA7E982E50BC1E727ECF1D68, _:genid-4e694113159d4e3db4a1a913894a81d857023-A3EAFD7EB6D5670801CEB1F3B97790B7,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-7CEBDA793A850F5E89542347A6E8C77F, _:genid-4e694113159d4e3db4a1a913894a81d857023-7C228822B91DCEF4E1BB6129EF708C83,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-BEF37F4FE36CF9D23E2027C4EC5097E3, _:genid-4e694113159d4e3db4a1a913894a81d857023-704530970FD1AD269E373404683430CF,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-F793FC29F002CD8B8B97B85C9EB447E5, _:genid-4e694113159d4e3db4a1a913894a81d857023-9AA1591E7B5450330A389A2D09DDF3D0,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-041F096119271A5A825FF963E8C783FF, _:genid-4e694113159d4e3db4a1a913894a81d857023-38807BE00C1310AFE12CC7C2881A8B8F,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-DAECB4DEABA794AE40769C206436B82C, _:genid-4e694113159d4e3db4a1a913894a81d857023-0DD5458CD76ADF778C2F99EAC71A024F,
    _:genid-4e694113159d4e3db4a1a913894a81d857023-4AE8E79B7E2A047B4F18F7C2BC135447, _:genid-4e694113159d4e3db4a1a913894a81d857023-91AB693238FECF3AD56AA008CAAF4B34;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX bd: <http://www.bigdata.com/rdf#>
#title: <span lang=\"en\" dir=\"ltr\" class=\"mw-content-ltr\">Animals which are Threatened as per IUCN Red List</span>
# https://en.wikipedia.org/wiki/Conservation_status
# Common names are in English only

SELECT ?animal ?scientific_names ?common_names ?statusLabel where
{
  # hint:Prior hint:runLast true
   {
      SELECT DISTINCT ?animal (GROUP_CONCAT(DISTINCT ?scientific_name; separator=\", \") as ?scientific_names) (GROUP_CONCAT(DISTINCT ?common_name; separator=\", \") as ?common_names) WHERE
      {

        ?animal wdt:P141 ?status;
                wdt:P225 ?scientific_name;
                wdt:P1843 ?common_name.
        filter( ?status
           IN (
               wd:Q11394,  #Endangered
               wd:Q219127, #critcally endangered
               wd:Q278113  #vulnurable
              )
          ).

        # Only return common names in English
        FILTER(LANGMATCHES(LANG(?common_name), \"en\"))
      }
      GROUP BY ?animal
   }.
   ?animal wdt:P141 ?status.
   SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
}""" .
