@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-cc27e569e9929153b01fbec74006c7ad> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  rdfs:comment """ This page is an archive. Please do not modify it. Use the current page, even to continue an old discussion. Contents 1 Find a vietnamese article 2 Weird time-out in a query 3 #TEMPLATE 4 Persons having an ID on Canadian Encyclopedia artikkel-ID 5 Member of Organized Crime gangs 6 Query to Obtain City of the Airport [SOLVED] 7 Is it possible to list people with items created in the last 12 months? 8 gsbbox equivalent 9 Ruth (Surname) 10 Modify a query to cast the same globe 11 Pictures both used on wikidata and locally in infoboxes 12 all DOI? 13 Colouring graph nodes and labelling relationships 14 Performance issue when a MINUS is added to my query 15 SPARQL 16 Getting city & latitude / longitude from residence & university values 17 Why is this querry so slow, can it be made faster? 18 All Persons, their DOB, DOD (if applicable) and Occupation 19 Find all countries and their administrative regions at all levels, including states, cities, counties, etc. 20 Agregar una tabla de wiki data a una nota en wikipedia 21 need wiki data query to extract yearly propulation growth of countries 22 Enlazar wikidata con wikipedia 23 Leaders and other metadata for each battle/sieges during the Sengoku Period. 24 Greek Given names 25 Missing citizenship 26 Missing articles in English 27 Checking where entities are referred 28 Filter fr description 29 Page ranges 30 Query for pages without Scholia link 31 References used in an item 32 Facts from specific domain 33 United States Senators/House reps who have been astronauts 34 A list of false cognates (lexemes) between Portuguese and Esperanto 35 Get all latin alphabet interwikis of an item 36 Result empty after 440th row though result is >2000, where is the error? 37 Policia EEUU 38 SPARQL on Commons 39 query information from the wiki archive 40 which properties are used in a subclass 41 Slow query on label 42 All rivers in europe with mouth and spring 43 show source 44 This query times out 45 Articles in idwiki but does not exist in enwiki 46 Wars 47 why can't find any city in USA using label ? 48 Australian Women's Register ID 49 FILTER NOT EXISTS for wdt:Pxxxx OR wdt: Pnnnnn? 50 query of villages in a certain district in China also having having Tibetan name set 51 Wrong query 52 Joseph de Cambis 53 Get items with deleted Commons images through a query 54 Find the longest river, sort by desc. Take 22 seconds, can it be improved further ? 55 global universities 56 How to optimize nested OPTIONAL ? 57 Can inverse property paths be used in the GAS service? 58 Query to identify the actors who were in films shot in Georgia. 59 query to get politician data 60 Multiple dates of death 61 Query for case variants of strings 62 How to limit result to qualifier with oldest value - searching former municipalities in Finland 63 Data quality : inception (P571) and dissolved, abolished or demolished date (P576) 64 elementos con propiedad que tenga varios calificativos 65 Works with Creators' Gender 66 List of authors in the Portuguese Wikisource sorted by name and last name 67 Items in a defined territory, showing missing labels and descriptions 68 Incorrect results looking for senate seats? 69 Items with coordinates within an OSM relation 70 Refining a Listeria query 71 Not DISTINCT? 72 List of religions by country 73 Sorting and grouping in query 74 Sort dates according to BC / AD 75 Re-running queries on earlier versions of Wikidata 76 Trouble with ORDER BY 77 Folding values in a query 78 Make a tree father country > child country (or the reverse) more visuable 79 Chess champions 80 Iconclass/project:sum of all paintings 81 Dates 82 No results for congresses 1-3? 83 In the commons category 84 Taxonomic class for Critter of the Week 85 Query to get UG Space Bibliographic Wikidata Items 86 publications from a particular year and place 87 Retrieving Wikidata data for list of items (QIDs) in SPARQL-XML format Find a vietnamese article Find a vietnamese article about a plant taxon which begins with \"P\" which and which contains an image file beginning with \"P\" but where there is no matching English wikipedia article. MargaretRDonald (talk) 00:36, 31 October 2020 (UTC) @MargaretRDonald: WDQS has no insight into images held within a vi-wiki article. This query satisfies your other specification points, and in addition checks whether the wikidata item has an image starting with P. Does that help? SELECT ?item ?itemLabel ?image ?article WITH {SELECT ?item ?image ?article
WHERE 
{
  ?article schema:about ?item ;
          schema:isPartOf <https://vi.wikipedia.org/> .
  ?item wdt:P31 wd:Q16521 .
  ?item wdt:P18 ?image . 
} } as %i
WHERE
{
  INCLUDE %i
  FILTER NOT EXISTS { 
    ?article2 schema:about ?item ;
          schema:isPartOf <https://en.wikipedia.org/> .
                    }
  filter (contains(str(?image),\"FilePath/P\"))
  filter (contains(str(?article),\"wiki/P\"))  
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
  }
 Try it! --Tagishsimon (talk) 01:34, 31 October 2020 (UTC) WDQS can in fact query about which images are used in viwiki articles via the MediaWiki API. But I have trouble seeing how the first character of the image names can be relevant as image names can be any text in any language. --Dipsacus fullonum (talk) 07:51, 31 October 2020 (UTC) Besides, the images returned from MWAPI are any file used on a page. There is no way to know if it is actually an image of the taxon, or e.g. an icon used in a hatnote or stub template or anything like that. --Dipsacus fullonum (talk) 08:04, 31 October 2020 (UTC) Thank you both for your thoughts (very helpful indeed). @Tagishsimon: @Dipsacus fullonum: I have modified te query slightly to get only taxa with APNI ids, and ideally would like to limit the results to files in the commons category [[Category:Photographs by Kevin Thiele]] SELECT ?item ?itemLabel ?image ?article WITH {SELECT ?item ?image ?article
WHERE 
{
  ?article schema:about ?item ;
          schema:isPartOf <https://vi.wikipedia.org/> .
  ?item wdt:P31 wd:Q16521 .
  ?item wdt:P18 ?image .
  ?item wdt:P5984 ?apni .
} } as %i
WHERE
{
  INCLUDE %i
  FILTER NOT EXISTS { 
    ?article2 schema:about ?item ;
          schema:isPartOf <https://en.wikipedia.org/> .
                    }
  filter (contains(str(?image),\"FilePath/P\"))
  filter (contains(str(?article),\"wiki/P\"))  
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
  }
 Try it! MargaretRDonald (talk) 07:02, 1 November 2020 (UTC)@MargaretRDonald: It is no problem limiting to files in the category. Just add a subquery to find the category members and match the image names from the two subqueries. I also moved two filters to the first subquery for efficiency and reformated the query to my preferences as I cannot read a query well if matching brackets are not in the same columns. So: SELECT ?item ?itemLabel ?image ?article ?image_title
WITH
{
  SELECT ?item ?image ?article ?image_title
  WHERE 
  {
    ?article schema:about ?item ;
             schema:isPartOf <https://vi.wikipedia.org/> .
    ?item wdt:P31 wd:Q16521 .
    ?item wdt:P18 ?image .
    ?item wdt:P5984 ?apni .
    FILTER (CONTAINS(STR(?image),\"FilePath/P\"))
    FILTER (CONTAINS(STR(?article),\"wiki/P\"))  
    BIND (SUBSTR(wikibase:decodeUri(STR(?image)), 52) AS ?image_title)
  }
} AS %i
WITH
{
  SELECT ?image_title
  WHERE
  {
    SERVICE wikibase:mwapi
    {
      bd:serviceParam wikibase:endpoint \"commons.wikimedia.org\" .
      bd:serviceParam wikibase:api \"Generator\" .
      bd:serviceParam mwapi:generator \"categorymembers\" .
      bd:serviceParam mwapi:gcmtitle \"Category:Photographs by Kevin Thiele\" .
      bd:serviceParam mwapi:gcmtype \"file\" .
      bd:serviceParam mwapi:gcmprop \"title\" .
      bd:serviceParam mwapi:gcmlimit \"max\" .
      ?file wikibase:apiOutput mwapi:title .
    }
    BIND (SUBSTR(?file, 6) AS ?image_title)
  }
} AS %wanted_image_titles
WHERE
{
  INCLUDE %i
  INCLUDE %wanted_image_titles
  FILTER NOT EXISTS
  { 
    ?article2 schema:about ?item ;
              schema:isPartOf <https://en.wikipedia.org/> .
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! --Dipsacus fullonum (talk) 08:13, 1 November 2020 (UTC) @Dipsacus fullonum: Perfect. Thanks heaps. MargaretRDonald (talk) 09:20, 1 November 2020 (UTC) Weird time-out in a query Here's a query that is giving me weird time-outs, and I don't understand why, given that with very small changes I can make it not time out (but also not give me the results I want). The query is work-in-progress, towards plotting how Scottish church ministers moved from one job to another. The key thing I'm trying to get here are the coordinates on each line for their previous job, and the coordinates for their current job; so that I then would be able to plot a line between them.The code below times out.But weirdly, if I comment out the lines giving me ?form_lat and ?from_lon then everything works (tinyurl.com/yxbhcm37) though of course I don't get the 'from' coords. Interestingly, it is not the line ?from p:P625 ?from_coords_stmt which seems to cause a problem, but rather any subsequent use of ?from_coords_stmt, eg even ?from_coords_stmt ps:P625 ?from_coords (tinyurl.com/yxgjyoue ; cf also tinyurl.com/y2kz9uts). I don't understand this.Also, if I remove the OPTIONAL from the join in the %ministers_moves block, then the problem goes away. tinyurl.com/yy54r62r (But then I don't get a line in the output for the minister's first job). For the ministers' first jobs, with the OPTIONAL, the COALESCE should give ?from the same value as ?place. And the query can find the coordinates for ?place with no problem. So why is it failing for ?from ?This kind of time-out is the sort of thing that could happen from a typo, if the typo led to a line with a triple with unbound variables. But I don't think I've made a typo, or got unbound variables that I can see. Can anybody spot or explain what might be going on here? Jheald (talk) 19:56, 31 October 2020 (UTC)Query: SELECT DISTINCT
  ?name ?minister ?moves ?seq ?place_name ?from_lat ?from_lon ?lat ?lon

WITH {
  SELECT DISTINCT ?minister ?place ?StartTime ?res_stmt WHERE {
    ?minister wdt:P106 wd:Q1423891 .
    ?minister p:P551 ?res_stmt .
    ?res_stmt ps:P551 ?place .
    ?res_stmt pq:P580 ?StartTime .
      #pq:P582 ?EndTime .
    
  } ORDER BY ?minister ?StartTime
} AS %ministers

WITH {
  SELECT DISTINCT ?minister (COUNT(DISTINCT(?rs1)) AS ?seq) ?place ?StartTime WHERE {
    INCLUDE %ministers .
    {
      SELECT DISTINCT ?minister (?place AS ?pl1) (?StartTime AS ?st1) (?res_stmt AS ?rs1) WHERE {
        INCLUDE %ministers .
      }
    }
    FILTER ((?st1 < ?StartTime) || ((?st1 = ?StartTime) && (STR (?rs1) <= STR(?res_stmt)))) .
  } GROUP BY ?minister ?place ?StartTime ?res_stmt
  ORDER BY ?minister ?seq
} AS %ministers_seq 

WITH {
  SELECT DISTINCT ?minister ?seq (COALESCE(?from1, ?place) AS ?from) ?place ?place_name ?StartTime WHERE {
    INCLUDE %ministers_seq .
    BIND ((?seq) AS ?seq1) .
    OPTIONAL {
      SELECT ?minister (?seq + 1 AS ?seq1) (?place AS ?from1) WHERE {
         INCLUDE %ministers_seq .
      }
    }
    FILTER (bound(?from1)|| bound(?place)) .
    SERVICE wikibase:label {
       bd:serviceParam wikibase:language \"en\".
       ?place rdfs:label ?place_name .
    }
    
  }
} AS %ministers_moves


WITH {
  SELECT ?minister (MAX(?seq) AS ?moves) WHERE {
    INCLUDE %ministers_seq
  } GROUP BY ?minister
} AS %ministers_total

WHERE {  
  INCLUDE %ministers_moves.
  INCLUDE %ministers_total.
  
  ?place p:P625 / psv:P625 / wikibase:geoLatitude ?lat .
  ?place p:P625 / psv:P625 / wikibase:geoLongitude ?lon . 
  ?from  p:P625 ?from_coords_stmt .
         
  ?from_coords_stmt psv:P625 / wikibase:geoLatitude  ?from_lat .
  ?from_coords_stmt  psv:P625 / wikibase:geoLongitude ?from_lon . 
 

  SERVICE wikibase:label {
       bd:serviceParam wikibase:language \"en\".
       ?minister rdfs:label ?name .
  }
} 
ORDER BY DESC(?moves) ?minister ?seq
 Try it! I‚Äôm not sure what makes the optimizer choose the wrong order, but disabling it just for the final part of the query seems to help (hint:SubQuery hint:optimizer \"None\".). SELECT DISTINCT
  ?name ?minister ?moves ?seq ?place_name ?from_lat ?from_lon ?lat ?lon

WITH {
  SELECT DISTINCT ?minister ?place ?StartTime ?res_stmt WHERE {
    ?minister wdt:P106 wd:Q1423891 .
    ?minister p:P551 ?res_stmt .
    ?res_stmt ps:P551 ?place .
    ?res_stmt pq:P580 ?StartTime .
      #pq:P582 ?EndTime .
    
  } ORDER BY ?minister ?StartTime
} AS %ministers

WITH {
  SELECT DISTINCT ?minister (COUNT(DISTINCT(?rs1)) AS ?seq) ?place ?StartTime WHERE {
    INCLUDE %ministers .
    {
      SELECT DISTINCT ?minister (?place AS ?pl1) (?StartTime AS ?st1) (?res_stmt AS ?rs1) WHERE {
        INCLUDE %ministers .
      }
    }
    FILTER ((?st1 < ?StartTime) || ((?st1 = ?StartTime) && (STR (?rs1) <= STR(?res_stmt)))) .
  } GROUP BY ?minister ?place ?StartTime ?res_stmt
  ORDER BY ?minister ?seq
} AS %ministers_seq 

WITH {
  SELECT DISTINCT ?minister ?seq (COALESCE(?from1, ?place) AS ?from) ?place ?place_name ?StartTime WHERE {
    INCLUDE %ministers_seq .
    BIND ((?seq) AS ?seq1) .
    OPTIONAL {
      SELECT ?minister (?seq + 1 AS ?seq1) (?place AS ?from1) WHERE {
         INCLUDE %ministers_seq .
      }
    }
    FILTER (bound(?from1)|| bound(?place)) .
    SERVICE wikibase:label {
       bd:serviceParam wikibase:language \"en\".
       ?place rdfs:label ?place_name .
    }
    
  }
} AS %ministers_moves


WITH {
  SELECT ?minister (MAX(?seq) AS ?moves) WHERE {
    INCLUDE %ministers_seq
  } GROUP BY ?minister
} AS %ministers_total

WHERE {  
  INCLUDE %ministers_moves.
  INCLUDE %ministers_total.
  
  hint:SubQuery hint:optimizer \"None\".
  
  ?place p:P625 / psv:P625 / wikibase:geoLatitude ?lat .
  ?place p:P625 / psv:P625 / wikibase:geoLongitude ?lon . 
  ?from  p:P625 ?from_coords_stmt .
         
  ?from_coords_stmt psv:P625 / wikibase:geoLatitude  ?from_lat .
  ?from_coords_stmt psv:P625 / wikibase:geoLongitude ?from_lon . 
 

  SERVICE wikibase:label {
       bd:serviceParam wikibase:language \"en\".
       ?minister rdfs:label ?name .
  }
} 
ORDER BY DESC(?moves) ?minister ?seq
 Try it! --TweetsFactsAndQueries (talk) 20:12, 31 October 2020 (UTC) Thanks, Lucas! Jheald (talk) 14:59, 1 November 2020 (UTC) #TEMPLATE Any idea why https://w.wiki/jff shows the name of the query on the right side, but https://w.wiki/jns doesn't? --- Jura 09:47, 2 November 2020 (UTC) That the second uses a named subquery seems to be the difference. Remove it (without any care & attention to the query) and voila. https://w.wiki/jos --Tagishsimon (talk) 11:12, 2 November 2020 (UTC) Thanks! I also tried a version where one picks the items to compare with based one a values query, but that didn't work out either. Sample: https://w.wiki/jp6 Wikidata:SPARQL_query_service/queries/examples#US_presidents_and_spouses is a working sample. (The only I found) --- Jura 11:28, 2 November 2020 (UTC) Interesting stuff with which I was not familiar. In the working example, I see a variable name switch from ?country to ?id, but applying that to yours didn't fix it. --Tagishsimon (talk) 11:39, 2 November 2020 (UTC) Yes, ?id seems required, fixing that and simplifying it somehow gets it to work: https://w.wiki/jpX . Thanks! --- Jura 11:56, 2 November 2020 (UTC)  #TEMPLATE={\"template\":\"Identifiers present on ?comparewith , but not on the item for Sean Connery\",\"variables\":{\"?comparewith\":{\"query\":\"SELECT DISTINCT ?id WHERE { VALUES ?id { wd:Q81520 wd:Q181917 wd:Q4547 wd:Q134333 wd:Q41233 wd:Q205599 wd:Q37459 wd:Q7374 }  } \" } } }
SELECT
  ?p ?pLabel ?comparewithLabel
  (SAMPLE(?url) AS ?url_comp2) 
WHERE 
{
  BIND(wd:Q39666 as ?comparewith)
  hint:Query hint:optimizer \"None\".
  {  ?comparewith ?wdt ?v.
     ?p wikibase:directClaim ?wdt; wikibase:propertyType wikibase:ExternalId.
     FILTER NOT EXISTS { wd:Q4573 ?wdt [] }
        FILTER NOT EXISTS { ?p wdt:P31 wd:Q66712599 }
        FILTER NOT EXISTS { ?p wdt:P31 wd:Q27525351 }
        FILTER NOT EXISTS { ?p wdt:P31 wd:Q66118402 }   
     OPTIONAL { ?p wdt:P1630 ?f. } BIND(URI(REPLACE(?f, \"\\\\$1\", ?v)) AS ?url)
  } UNION { BIND( wd:Q4573 as ?p) }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\"}
}
GROUP BY ?p ?pLabel ?comparewithLabel
ORDER BY (?url_comp2)Try it!Somehow this merges: 76 identifiers present on the item for Penelope Cruz, but not on the item for Sean Connery 96 identifiers present on items of other movie stars, but not on the item for Sean Connery Updated it on Wikidata:Status_updates/Next. --- Jura 12:03, 2 November 2020 (UTC) Persons having an ID on Canadian Encyclopedia artikkel-ID May I have a list of persons having an article on norwegian wikipedia (nb), and also having an Canadian Encyclopedia article ID (P5395). Pmt (talk) 10:10, 2 November 2020 (UTC) @Pmt: nb or no? The first finds nothing. The second, implemented below, more successful. Easy to tweak if you need to. SELECT ?item ?itemLabel ?ID ?sitelink ?article 
WHERE 
{
  ?item wdt:P5395 ?ID. 
  ?article schema:about ?item ;
          schema:isPartOf <https://no.wikipedia.org/> ;
          schema:name ?sitelink  .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],no,en\". }
}
 Try it! --Tagishsimon (talk) 11:05, 2 November 2020 (UTC) There is no nb.wikipedia.org (the subdomain redirects to no.wikipedia.org) which explains why it doesn't give any results. There is a nn.wikipedia.org (Norgewian nynorsk) with results. --Dipsacus fullonum (talk) 11:26, 2 November 2020 (UTC) Member of Organized Crime gangs I'm looking for gangsters sentenced to prison I suppose the data is incomplete but a search does give a few: SELECT ?item ?itemLabel ?penalty ?penaltyLabel
WHERE 
{
  ?item wdt:P31 wd:Q5 . # Human
  ?item wdt:P106 wd:Q46961 . # Gangster
  ?item wdt:P1596 ?penalty . # Penalty
  ?penalty wdt:P279* wd:Q841236 . # Penalty is a subclass of imprisonment
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\" . }
}
 Try it! --Dipsacus fullonum (talk) 20:24, 2 November 2020 (UTC) Query to Obtain City of the Airport [SOLVED] I am interested in learning which airport is located in which city. With a little bit of work I had the code of looking up the airport from its ICAO code working.(https://w.wiki/jxo) However I am having difficulties trying to get the city where the airport is located.located in the administrative territorial entity (P131) looks promising, but a few attempts reveals that it would not only return the city of the airport, but also the province, the state, the municipality, etc. For example, RJAA (Narita International Airport near Tokyo, Japan) has both Narita (the city) and Chiba Perfecture listed there, KUNV (University Park Airport in State College, Pennsylvania, USA) only has Pensylvania listed, and ZSQD (Qingdao Liuting International Airport in Qingdao, Shandong, China) only has Chengyang District (one level lower than city) listed.I came with two solutions but failed to put the codes together.The first solution is to keep using the wdt:P131 and set up a filter to remove anything that is not a city. SELECT ?airport ?airportLabel ?airportIn ?airportInLabel ?airportInType ?airportInTypeLabel WHERE {
  ?airport wdt:P239 \"RJAA\".
  { ?airport wdt:P131 ?airportIn. }
  { ?airportIn wdt:P31 ?airportInType. }
  FILTER(EXISTS { ?airportInType wdt:P279 wd:Q515. })
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
}
 Try it! It only works with RJAA as it has Narita P31 Q494721 (instance of City of Japan) and Q494721 P279 Q515 (subclass of City). It did not work with ZGGG which has Guangzhou P31 Q515 (instance of City), nor did it work with those airports that only has P131 with districts. Of course I can also manually add those instance of cities into each airport's wikidata entry but that is likely going to take a lot of effort and introduce some redundant info (such as RJAA wdt:P131 Narita wdt:P31 ((city of Japan) AND (city))).The second solution is to take the coordinate of the airport and to do a query to find out which city this coordinate belongs to. I am afraid that it may take way too much resources and I have no idea about how to write a query for such.Please let me know if you have any other thoughts on how I can build a query that takes an ICAO airport code and returns the city the airport is located at.Staph aureus (talk) 17:52, 3 November 2020 (UTC) It really depends what you are looking for. Maybe place served by transport hub (P931) suits you better? If there are multiple values, query the closest or the most populous one. --- Jura 18:18, 3 November 2020 (UTC) Before I may be able to help, I need to know what you mean by \"City of the Airport\". I live in Denmark and none of the Danish airports that I know of are located in a city, but somewhere in the country outside any city. --Dipsacus fullonum (talk) 21:34, 3 November 2020 (UTC) To make things simpler, I am assuming that every airport, as a building, has its address, and every address has a component of \"City\" or its local equivalent. That is what I am looking for. For Kansai International Airport, I am happy to take Izumisano city instead of the nearby Osaka city. For Vancouver International Airport, I am also happy to take Richmond instead of Vancouver. However if this is more difficult than taking the \"largest city nearby\" then I think I can accept either one. --Staph aureus (talk) 23:45, 3 November 2020 (UTC) Actually Jura's idea of using place served by transport hub (P931) is quite brilliant. Could not believe I missed out such a good property when I was staring at those airports. SELECT ?airport ?airportLabel ?airportIn ?airportInLabel WHERE {
  ?airport wdt:P239 \"RJAA\".
  { ?airport wdt:P931 ?airportIn. }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
}
 Try it! It works like a charm now. Thanks for your help. --Staph aureus (talk) 00:00, 4 November 2020 (UTC) @Staph aureus: named after (P138) could be another option. I added a quite a few some time ago (adding more precise P131 seemed less interesting to me). If it's a place, it's usually similar to place served by transport hub (P931) or the other place you were looking for. Querying the distance between these finds a few exceptions. --- Jura 07:22, 4 November 2020 (UTC) Is it possible to list people with items created in the last 12 months? #Mujeres mexicanas
SELECT ?item ?name ?image ?gender ?year_of_birth ?country_of_birth
       (GROUP_CONCAT(DISTINCT ?state_or_province_of_birth; separator=\", \") AS ?states_or_provinces_of_birth)
       ?year_of_death ?country_of_death ?occupations
WITH
{
  SELECT ?item ?image ?gender_item ?year_of_birth ?country_of_birth_item
         ?year_of_death ?country_of_death_item
         (GROUP_CONCAT(?occupation; SEPARATOR=\", \") AS ?occupations)
  WHERE
  {
    ?item wdt:P21 wd:Q6581072 .
    ?item wdt:P27 wd:Q96 .
    OPTIONAL {
      ?item wdt:P18 ?image.
    }
    OPTIONAL {
      ?item wdt:P21 ?gender_item.
    }
    ?item wdt:P569 ?date_of_birth.
    BIND (YEAR(?date_of_birth) AS ?year_of_birth)
    FILTER (?year_of_birth >= 1675 && ?year_of_birth < 1995)
    OPTIONAL {
      ?item wdt:P19/wdt:P17 ?country_of_birth_item.
    }
    OPTIONAL {
      ?item wdt:P570 ?date_of_death.
      BIND (YEAR(?date_of_death) AS ?year_of_death)
    }
    OPTIONAL {
      ?item wdt:P20/wdt:P17 ?country_of_death_item.
    }
    OPTIONAL {
      ?item wdt:P106 ?occupation_item.
    }
    SERVICE wikibase:label {
      bd:serviceParam wikibase:language \"es,en\".
      ?occupation_item rdfs:label ?occupation.
    }
  }
  GROUP BY ?item ?image ?gender_item ?year_of_birth ?country_of_birth_item ?year_of_death ?country_of_death_item
} AS %query
WHERE
{
  INCLUDE %query
  OPTIONAL {
    ?state_or_province_of_birth_item wdt:P131 ?country_of_birth_item.
    ?item wdt:P19/wdt:P131* ?state_or_province_of_birth_item.
  }
  SERVICE wikibase:label {
    bd:serviceParam wikibase:language \"es,en\".
    ?item rdfs:label ?name.
    ?gender_item rdfs:label ?gender.
    ?country_of_birth_item rdfs:label ?country_of_birth.
    ?country_of_death_item rdfs:label ?country_of_death.
    ?state_or_province_of_birth_item rdfs:label ?state_or_province_of_birth.
  }
}
GROUP BY ?item ?name ?image ?gender ?year_of_birth ?country_of_birth ?year_of_death ?country_of_death ?occupations
 Try it!Hi, it's been almost 9 months since my last application. And I'd like to add the women's items that have been created since April. This is so I can add them to my personal wikirepository. Is that possible? so that I don't have to go through the 3000+ items from women born in Mexico one by one. Greetings. --Hispano76 (talk) 20:58, 3 November 2020 (UTC)Items used: female (Q6581072) ‚ÄØ , Mexico (Q96) ‚ÄØ , QID milestone (Q38074555) ‚ÄØ Properties used: sex or gender (P21) ‚ÄØ , country of citizenship (P27) ‚ÄØ , quantity (P1114) ‚ÄØ , point in time (P585) ‚ÄØ # by Jura1, 2020-11-03
#defaultView:AreaChart
SELECT ?date ?cumulativecount 
{
    hint:Query hint:optimizer \"None\".
    {   SELECT ?milestonep (COUNT(?item) as ?cumulativecount)
        WHERE
        {
          { SELECT ?item {    ?item wdt:P21 wd:Q6581072 . ?item wdt:P27 wd:Q96 . }  LIMIT 190000 }
          BIND( xsd:integer( substr(str(?item), 33)) as ?qid)
          wd:Q38074555 p:P1114 ?milestonep .
          ?milestonep ps:P1114 ?milestone .
          FILTER( ?milestone > ?qid ) 
        }
        GROUP BY ?milestonep
    }          
    ?milestonep pq:P585 ?date
} Try it!The above gives you an idea when they were created. However, it could be that P27=Q96 was added only later.Q88888888 was created at the end of March, so anything more recent would be new since. --- Jura 21:04, 3 November 2020 (UTC) A relative simple approach is find an item created on the limit date. Remove the \"Q\" from the item names and convert the number part to integers. Any items with greater integers than the item from the limit date are created later than that. It is also possible to get the exact creation time for any item with a precision of 1 second by using a MWAPI call but it is limited how many items you can query about in one query without causing timeout. --Dipsacus fullonum (talk) 21:48, 3 November 2020 (UTC) I would agree that the easiest solution here is to use the QID as a proxy for age, with any ID past your cut-off being new. There may be a few weird cases where an item was created before, a duplicate was created after, and the old item was merged into the new one - but this situation is very unusual. Andrew Gray (talk) 22:52, 3 November 2020 (UTC) @Hispano76: So for example if you only want items created later than Q88000000 from 19 Mar 2020 insert this filter in your code: FILTER (xsd:integer(SUBSTR(STR(?item),33)) > 88000000)
 You can adjust the number as you like to get the right cut off date. --Dipsacus fullonum (talk) 07:57, 4 November 2020 (UTC) gsbbox equivalent Hi. Is there any way to get all items with coordinates inside a bound box? Like this API. --‘±’∑’∏’ø’è’Ü’Ç (talk) 06:20, 4 November 2020 (UTC) @‘±’∑’∏’ø’è’Ü’Ç: Yes, see the section mw:Wikidata Query Service/User Manual#Geospatial search in the WDQS user manual. There is also example code there. --Dipsacus fullonum (talk) 07:00, 4 November 2020 (UTC) Ruth (Surname) I am looking for people with the surname Ruth with no article at hewiki. Thanks. YoavR (talk) 16:50, 2 November 2020 (UTC) @YoavR: SELECT ?item ?itemLabel
WHERE 
{
  ?item wdt:P31 wd:Q5 . # Human
  ?item wdt:P734 wd:Q37494439 . # Surname is Ruth
  MINUS
  {
    ?article schema:about ?item .
    ?article schema:isPartOf <https://he.wikipedia.org/> . # No article at hewiki
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en,he\". }
}
 Try it! --Dipsacus fullonum (talk) 20:02, 2 November 2020 (UTC) Thank you very much. YoavR (talk) 20:35, 2 November 2020 (UTC) @YoavR: I'll be adding another 55 names to that report in an hour or so (just waiting for quickstatements to get around to it) based on this query --Tagishsimon (talk) 20:52, 2 November 2020 (UTC) Might as well combine those two for the lols: SELECT DISTINCT ?item ?itemLabel 
WHERE {
  hint:Query hint:optimizer \"None\".
  {  
    SERVICE wikibase:mwapi {
      bd:serviceParam wikibase:api \"Search\";
                      wikibase:endpoint \"www.wikidata.org\";
                      mwapi:srsearch \"Ruth\".
      ?title wikibase:apiOutput mwapi:title.
    }
    BIND(IRI(CONCAT(STR(wd:), ?title)) AS ?item)
    ?item rdfs:label ?itemLabel . filter(lang(?itemLabel)=\"en\")
    FILTER NOT EXISTS { ?item wdt:P734 wd:Q37494439 .}
    FILTER(regex(?itemLabel,\".+Ruth$\"))
  }
  UNION
  {
    ?item wdt:P734 wd:Q37494439 . # Surname is Ruth
  }
  MINUS
  {
    ?article schema:about ?item .
    ?article schema:isPartOf <https://he.wikipedia.org/> . # No article at hewiki
  }
  ?item wdt:P31 wd:Q5
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! --Tagishsimon (talk) 21:06, 2 November 2020 (UTC) @Tagishsimon: A little tip for another time. You can extract ?item directly from the MWAPI service by using the predicate wikibase:apiOutputItem that automatically converts the title to an IRI for an item. That will make query many times faster. Instead of the normally expensive REGEX function you can also use the simpler FILTER STRENDS(?itemLabel, \"Ruth\") but I doubt it will very noticeable in this case. --Dipsacus fullonum (talk) 06:59, 3 November 2020 (UTC) Isn't regex usually quicker than the less technical functions (strends, strstarts, ..)? --- Jura 07:18, 3 November 2020 (UTC) That depends on how they are implemented. If STRENDS and STRSTARTS for instance just are wrappers for REGEX, you are right. But they will always be faster if you write a specialized optimized implementation for them. --Dipsacus fullonum (talk) 07:40, 3 November 2020 (UTC) Well, at Wikidata Query Service. --- Jura 08:50, 3 November 2020 (UTC) Depending on whether you want to include or exclude Del Ruth (Q93133323) or other surnames, you might want to filter just for FILTER NOT EXISTS { ?item wdt:P734 [] }. --- Jura 07:16, 3 November 2020 (UTC) I fixed a few that used \"Ruth\" instead of \"Del Ruth\" or \"van Ruth\". --- Jura 08:50, 3 November 2020 (UTC) @Tagishsimon: how will you tell from your query which person has surname Ruth and which has given name Ruth? --Infovarius (talk) 20:51, 4 November 2020 (UTC) Modify a query to cast the same globe Hello, I'd like to modify this query so that the given item (Q867556 in this example)'s globe should also be used to filter anything that is in a 10-km radius around the point of Q867556, in the same globe. Thanks! Bouzinac‚ÄØüí¨‚óè‚úíÔ∏è‚óèüíõ 08:28, 4 November 2020 (UTC) SELECT ?globe ?place ?placeLabel ?location ?instanceLabel ?dist WHERE {
  wd:Q867556 wdt:P625 ?loc .
  SERVICE wikibase:around {
      ?place wdt:P625 ?location .
      bd:serviceParam wikibase:center ?loc.
      bd:serviceParam wikibase:geoGlobe ?globe . 
      bd:serviceParam wikibase:radius 10 . # in kilometers
  }
 # FILTER ( ?globe = wd:Q2 )
  OPTIONAL { 
    ?place wdt:P31 ?instance .
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language 'en' }
  BIND(geof:distance(?loc, ?location) AS ?dist) .
} ORDER BY ASC(?dist)
 Try it! ‚Äì The preceding unsigned comment was added by Bouzinac (talk ‚Ä¢ contribs). \"geoGlobe\" should be \"globe\", but I'm not sure if that works well with wikibase:radius though. BTW We are trying to improve the situation for non-Earth coordinates currently mixed into P625, see Wikidata:Property_proposal/planetary_coordinates. --- Jura 08:57, 4 November 2020 (UTC) @Bouzinac: The geospatial search gives an error message if the globe parameter isn't a constant. So it will be necessary to first make one query to get the globe, and then make another query with the found globe inserted as a constant. If a bound variable was possible you could use this query: SELECT ?globe ?place
WHERE
{
  wd:Q867556 p:P625 ?locstatement .
  ?locstatement a wikibase:BestRank .
  ?locstatement ps:P625 ?loc .
  ?locstatement psv:P625 / wikibase:geoGlobe ?globe .
  SERVICE wikibase:around {
      ?place wdt:P625 ?location .
      bd:serviceParam wikibase:center ?loc.
      bd:serviceParam wikibase:globe ?globe . 
      bd:serviceParam wikibase:radius 10 . # in kilometers
  }
}
 Try it! But it fails with java.lang.IllegalArgumentException: Non-constant globe value is not supported yet. The word \"yet\" suggests that it will be supported in the future, but you will have to ask development team if there are any plans for that. --Dipsacus fullonum (talk) 14:16, 4 November 2020 (UTC) If if you set the globe to a constant ( wd:Q405 ), radius seems still to assume Q2 .. --- Jura 15:07, 4 November 2020 (UTC) That's not what I'm finding. SELECT ?globe ?place
WHERE
{
  wd:Q867556 p:P625 ?locstatement .
  ?locstatement a wikibase:BestRank .
  ?locstatement ps:P625 ?loc .
  ?locstatement psv:P625 / wikibase:geoGlobe ?globe .
  SERVICE wikibase:around {
      ?place wdt:P625 ?location .
      bd:serviceParam wikibase:center ?loc.
      bd:serviceParam wikibase:globe wd:Q405 . 
      bd:serviceParam wikibase:radius 10 . # in kilometers
  }
}
 Try it! --Tagishsimon (talk) 16:01, 4 November 2020 (UTC) The query has the unit only in a comment. How did you find it? --- Jura 16:12, 4 November 2020 (UTC) I'm not sure what you're asking. I set the globe parameter to a constant and the query searched a radius around a point on the moon, as Df specified it would, above. --Tagishsimon (talk) 16:33, 4 November 2020 (UTC) The question is if it searches 10 km around it or not. --- Jura 16:35, 4 November 2020 (UTC) Here is an expanded version of the query: Items used: Chacornac (Q867556) ‚ÄØ , Moon (Q405) ‚ÄØ Properties used: coordinate location (P625) ‚ÄØ SELECT ?loc0 ?loc1 ?place1 ?place1Label ?distWBaround ?distGEOF
WHERE
{
  wd:Q867556 wdt:P625  ?loc0 .
  SERVICE wikibase:around {
      ?place1 wdt:P625 ?loc1 .
      bd:serviceParam wikibase:center ?loc0 .
      bd:serviceParam wikibase:globe wd:Q405 . 
      bd:serviceParam wikibase:radius 200 . # which unit¬†?
      bd:serviceParam wikibase:distance ?distWBaround . # which unit¬†?
  }
  BIND(geof:distance(?loc1, ?loc0) as ?distGEOF) # which unit¬†?
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
} Try it! I also created a few from w:Chacornac_(crater)#Satellite craters. --- Jura 16:42, 4 November 2020 (UTC) Well, it's that query but with the wd:Q405 being a look-up of what globe Chacornac (Q867556) is on, not a value typed on? Bouzinac‚ÄØüí¨‚óè‚úíÔ∏è‚óèüíõ 17:55, 4 November 2020 (UTC) Pictures both used on wikidata and locally in infoboxes Is it possible to have a query showing a list of pictures both used in Wikidata (P|18) and also used local only in norwegian (nb) infoboxes? Also informing @4ing: Breg Pmt (talk) 08:50, 4 November 2020 (UTC) If the relevant infobox on nowiki used a category like Category:Local image same as Wikidata (Q16742292), one could just query that ... --- Jura 09:08, 4 November 2020 (UTC) One could try to compare the page image used on Wikidata with the one on nowiki. Sample: https://www.wikidata.org/w/index.php?title=Q20&action=info https://no.wikipedia.org/w/index.php?title=Norge&action=info This isn't necessarily the P18 image or the image in the infobox, but it can be. --- Jura 09:20, 4 November 2020 (UTC) My original request on nowp was whether it is possible to identify pages where the infobox uses an image that is present in the article (not in the infobox). This typically occurs when an infobox is added to an article already containing an image of the subject. - 4ing (talk) 09:47, 4 November 2020 (UTC) @Pmt, 4ing: I have answered in no:Wikipedia:Torget#Dupliserte bilder. --Dipsacus fullonum (talk) 12:14, 4 November 2020 (UTC) Can you translate? Ultimately, is it possible to determine if the infobox repeats an image already in the article? --- Jura 13:36, 4 November 2020 (UTC) I don't think it is possible. There is an API call that can list all files which are used on a page, but the list doesn't show how many times a file is used on a page. And I know of no other ways to find out (besides downloading and analyze all rendered pages). --Dipsacus fullonum (talk) 13:53, 4 November 2020 (UTC) @Jura1: Thats is correct understood from my side. Having an image (P18) in a infobox, given in that infobox only. And then list the same image existing in Wikidata. Many infoboxes on norwgian Wikipedia uses images from wikidata directly. Pmt (talk) 13:55, 4 November 2020 (UTC) all DOI? Hey, when I try to download the Q-IDs of all DOI registered to Wikidata I always run into timeout. I tried to limit the amount of itmes by reducing the scope to scholarly articles. Is there a way specify for example to small chuncks of items (maybe only Q-ID registered from 2010-2011) that could be combined later on? Thank you! SELECT ?item WHERE {
  ?item wdt:P31 wd:Q13442814.
  ?item wdt:P356 ?doi . 
 SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE], ar,be,bg,bn,ca,cs,da,de,el,en,es,et,fa,fi, fr,he,hi,hu,hy,id,it,ja,jv,ko,nb,nl,eo,pa,pl,pt,ro,ru,sh,sk,sr,sv,sw,te,th,tr,uk,yue,vec,vi,zh\"}
                                }
 Try it! --Eva (talk) 15:36, 04 Nov 2020 (CET) @EvaSeidlmayer: It‚Äôs possible to use the LDF API : https://query.wikidata.org/bigdata/ldf?subject=&predicate=wdt%3AP356&object= ( see https://www.mediawiki.org/wiki/Wikidata_Query_Service/User_Manual#Linked_Data_Fragments_endpoint ) I also remember we used the technique to slice by Qid ordering in the past, something like SELECT ?item WHERE {
  
  ?item wdt:P356 ?doi . 
  
  filter (str(?item) < str(wd:Q100000))
}
 Try it! but this does not seem to work as is, I‚Äôll try to find what worked (it was a long time ago, maybe this is not practicable anymore) author TomT0m / talk page 14:51, 4 November 2020 (UTC) There are now over 26 million statements with P356 (doi). SPARQL queries are not suited to retrieve that much data. I suggest that you instead make a full or partial database download. --Dipsacus fullonum (talk) 14:59, 4 November 2020 (UTC) WDumper (Q83952948) might work for you. --- Jura 15:03, 4 November 2020 (UTC) Colouring graph nodes and labelling relationships I've been creating a new Wikidata query which shows tunes which are contrafacts (melodies based on another tune's chords) along with the composer etc. #Show tunes and tunes on which they are based
#defaultView:Graph
SELECT 
?item ?itemLabel ?composer ?composerLabel ?image
?other ?otherLabel (\"7FFF00\" as ?rgb)
WHERE
{
    ?item wdt:P31 wd:Q23817390 .   # tune
    ?item  wdt:P144    ?other  .   # if the tune is based on another
    ?item wdt:P86 ?composer .
    OPTIONAL {?composer  wdt:P18     ?image  . }  # grab image
    #?other wdt:P18     ?image2 .   # grab image
    #?other wdt:P86 ?otherComposer .
	SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\" }
}
 Try it! [Try it]I can colour the node of the original melody (?otherLabel) as green.Ideally I'd like to colour other nodes (new tune, composer) different colours AND even better to label the edges of the graph (\"based on\", \"composed by\")If anyone has any pointers, please, I'd be greatful, thanks.Watty62 (talk) 19:23, 4 November 2020 (UTC) Performance issue when a MINUS is added to my query Hi everyone.I have a fast query that looks like this: select ?o ?olabel 
 WITH {
 select distinct ?o where {?s   <http://www.wikidata.org/prop/direct/P31>  <http://www.wikidata.org/entity/Q5> .  ?s <http://www.wikidata.org/prop/direct/P106> ?o  } LIMIT 50} AS %examples
 WHERE {
 INCLUDE %examples . OPTIONAL { ?o <http://www.w3.org/2000/01/rdf-schema#label> ?olabel . FILTER (lang(?olabel)='en') }
 } I have tested this variant for my %examples named query: select distinct ?o where {?s   <http://www.wikidata.org/prop/direct/P31>  <http://www.wikidata.org/entity/Q5> .  ?s <http://www.wikidata.org/prop/direct/P106> ?o  .  
                           MINUS { ?o   <http://www.wikidata.org/prop/direct/P31>  <http://www.wikidata.org/entity/Q28640>}  } LIMIT 50 which is fast too.But when I use the latter query as my %examples named query, then everything becomes VERY slow. select ?o ?olabel 
 WITH {
 select distinct ?o where {?s   <http://www.wikidata.org/prop/direct/P31>  <http://www.wikidata.org/entity/Q5> .  ?s <http://www.wikidata.org/prop/direct/P106> ?o  .  
                           MINUS { ?o   <http://www.wikidata.org/prop/direct/P31>  <http://www.wikidata.org/entity/Q28640>}  } LIMIT 50} AS %examples
 WHERE {
 INCLUDE %examples . OPTIONAL { ?o <http://www.w3.org/2000/01/rdf-schema#label> ?olabel . FILTER (lang(?olabel)='en') }
 } Any help is welcome. ‚Äì The preceding unsigned comment was added by 2a01:e0a:cd:4230:e599:a481:c75d:154f (talk ‚Ä¢ contribs) at 15:48‚Äé, 18 May 2020 (UTC). SPARQL Lugar de nacimiento de 25 actores franceses ‚Äì The preceding unsigned comment was added by 185.226.176.234 (talk ‚Ä¢ contribs) at 11:38, 25 May 2020 (UTC). SELECT ?item ?itemLabel ?itemDescription ?pob ?pobLabel
{
    ?item wdt:P106 wd:Q33999 .
    ?item wdt:P19 ?pob .
    ?item wdt:P27 wd:Q142 .
    SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
LIMIT 25
 Try it! ‚Äì The preceding unsigned comment was added by Jura1 (talk ‚Ä¢ contribs) at 16:33, 25 May 2020 (UTC). Getting city & latitude / longitude from residence & university values Thanks to the help of some here, I have this query where I can get top famous people from any state, including whether they were born there, lived there, went to school there, or worked there. My question is - how can I translate some of the residence and school values to the city or lat/long that they are located in? Ideally, I'd love to have columns for that as well. Thanks in advance for any help! SELECT ?person ?personLabel ?fame ?twitterHandle ?instagramHandle ?birthPlace ?residence ?educatedAt ?workedAt ?playedFor
 WITH
 {
 SELECT DISTINCT ?team
 WHERE
 {
   ?team wdt:P115 ?venue.
   ?venue wdt:P131* wd:Q812.
 }
 } AS %get_teams
 WITH
 {
 SELECT DISTINCT ?person
 WHERE
 {
   ?person wdt:P31 wd:Q5. # Is human
   ?person wdt:P27 wd:Q30. # Is US Citizen
   ?person (wdt:P19 | wdt:P551 | wdt:P037 | wdt:P69) / wdt:P131* wd:Q812. # Born/lived/worked/educated in Florida
   hint:Prior hint:gearing \"forward\". # Search the property chain above forward
   ?person wikibase:sitelinks ?fame
   FILTER (?fame > 35)
   OPTIONAL { ?person wdt:P570 ?date_of_death. }
   FILTER (! BOUND(?date_of_death)) # No date of death, i.e. living
 }
 } AS %first_selection
 WITH
 {
 SELECT DISTINCT ?person
 WHERE
 {
   INCLUDE %get_teams
   ?person wdt:P54 ?team.
   ?person wikibase:sitelinks ?fame
   FILTER (?fame > 35)
   OPTIONAL { ?person wdt:P570 ?date_of_death. }
   FILTER (! BOUND(?date_of_death)) # No date of death, i.e. living
 }
 } AS %get_team_players
 WITH
 {
 SELECT DISTINCT ?person
 WHERE
 {
   { INCLUDE %first_selection }
   UNION
   { INCLUDE %get_team_players }
 }
 } AS %get_persons
 WITH
 {
 SELECT ?person (COUNT(?wikipedialink) AS ?fame)
 WHERE
 {
   INCLUDE %get_persons
   ?wikipedialink schema:isPartOf [ wikibase:wikiGroup \"wikipedia\" ]; schema:about ?person.
 }
 GROUP BY ?person
 HAVING (?fame > 35)
 } AS %get_fame
 WITH
 {
 SELECT ?person ?fame (GROUP_CONCAT(DISTINCT ?placeLabel; SEPARATOR=\", \") AS ?birthPlace)
 WHERE
 {
   INCLUDE %get_fame
   OPTIONAL
   {
     ?person wdt:P19 ?place.
     ?place wdt:P131* wd:Q812.
     hint:Prior hint:gearing \"forward\".
   }
   SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". ?place rdfs:label ?placeLabel. }
 }
 GROUP BY ?person ?fame
 } AS %get_birthPlace
 WITH
 {
 SELECT ?person ?fame ?birthPlace (GROUP_CONCAT(DISTINCT ?placeLabel; SEPARATOR=\", \") AS ?residence)
 WHERE
 {
   INCLUDE %get_birthPlace
   OPTIONAL
   {
     ?person wdt:P551 ?place.
     ?place wdt:P131* wd:Q812.
     hint:Prior hint:gearing \"forward\".
   }
   SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". ?place rdfs:label ?placeLabel. }
 }
 GROUP BY ?person ?fame ?birthPlace
 } AS %get_residence
 WITH
 {
 SELECT ?person ?fame ?birthPlace ?residence (GROUP_CONCAT(DISTINCT ?placeLabel; SEPARATOR=\", \") AS ?educatedAt)
 WHERE
 {
   INCLUDE %get_residence
   OPTIONAL
   {
     ?person wdt:P69 ?place.
     ?place wdt:P131* wd:Q812.
     hint:Prior hint:gearing \"forward\".
   }
   SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". ?place rdfs:label ?placeLabel. }
 }
 GROUP BY ?person ?fame ?birthPlace ?residence
 } AS %get_educatedAt
 WITH
 {
 SELECT ?person ?fame ?birthPlace ?residence ?educatedAt (GROUP_CONCAT(DISTINCT ?placeLabel; SEPARATOR=\", \") AS ?workedAt)
 WHERE
 {
   INCLUDE %get_educatedAt
   OPTIONAL
   {
     ?person wdt:P937 ?place.
     ?place wdt:P131* wd:Q812.
     hint:Prior hint:gearing \"forward\".
   }
   SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". ?place rdfs:label ?placeLabel. }
 }
 GROUP BY ?person ?fame ?birthPlace ?residence ?educatedAt
 } AS %get_workedAt
 WITH
 {
 SELECT ?person ?fame ?birthPlace ?residence ?educatedAt ?workedAt (GROUP_CONCAT(DISTINCT ?teamLabel; SEPARATOR=\", \") AS ?playedFor)
 WHERE
 {
   INCLUDE %get_workedAt
   OPTIONAL
   {
     INCLUDE %get_teams
     ?person wdt:P54 ?team.
   }
   SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". ?team rdfs:label ?teamLabel. }
 }
 GROUP BY ?person ?fame ?birthPlace ?residence ?educatedAt ?workedAt
 } AS %get_playedFor
 WHERE
 {
 INCLUDE %get_playedFor
 OPTIONAL { ?person wdt:P2002 ?twitterHandle. }
 OPTIONAL { ?person wdt:P2003 ?instagramHandle. }
 SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
 }
 ORDER BY DESC(?fame) ‚Äì The preceding unsigned comment was added by 192.195.81.202 (talk ‚Ä¢ contribs) at 19:14‚Äé, 22 June 2020 (UTC). Why is this querry so slow, can it be made faster? Hi all, I am trying to make a query that would return every entity associated in any way with Donald trumpThis is my query: SELECT ?p ?pLabel ?entity ?entityLabel ?prop ?property1Label WHERE 
{   
  ?property1 rdf:type wikibase:Property. #get all possible propreties
  ?property1 wikibase:directClaim ?prop . 
  filter(?prop not in(wdt:P1889,wdt:P1889))#filter out unwanted propreties (e.g. \"different from\")
  
  {?entity ?prop wd:Q22686 . }#select all entities that have Q as proprety 
   Union
  {wd:Q22686 ?prop  ?entity  .}#and select all propreties of Q

  ?entity wdt:P31 ?p.#check the category of ?entity
  ?p wdt:P279* ?p2.#and all of it's \"subclasses\"
  filter(?p2 in(wd:Q164509,wd:Q164509)) #and keep it only if it is a subclass of one of the following
    
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}group by ?p ?pLabel ?entity ?entityLabel ?prop ?property1LabelTry it!‚Äì The preceding unsigned comment was added by 195.234.243.5 (talk ‚Ä¢ contribs) at 09:30‚Äé, 29 June 2020 (UTC). All Persons, their DOB, DOD (if applicable) and Occupation As a user of WikiData, I would like to write a query that will return the following: All persons containing a first and last name within the `en` language Persons must be born after 1900 Query must return first name, last name, complete date of birth (if known), complete date of death (if known), occupation (if listed) The first and last name returned shall be their given name unless it is unavailable and then it shall be their common name The query shall not time-out The query may be broken up in segments (e.g. born between dates, last names starting with Aa-Al, etc) So that I can complete further research analysis. ‚Äì The preceding unsigned comment was added by 2600:8800:2200:89dc:55e6:3d74:f922:85ab (talk ‚Ä¢ contribs) at 23:36‚Äé, 20 July 2020 (UTC). Hi. I don't really understand the request and have some questions about it: 1) What do mean when saying \"within the `en` language\"? 2) What do you mean by \"The first and last name returned shall be their given name unless it is unavailable and then it shall be their common name\"? -- ‚Äì The preceding unsigned comment was added by Dipsacus fullonum (talk ‚Ä¢ contribs) at 05:42‚Äé, 21 July 2020 (UTC). Find all countries and their administrative regions at all levels, including states, cities, counties, etc. HelloÔºå How to find all countries and their administrative regions at all levels, including states, cities, counties, etc. ThanksÔºÅ ‚Äì The preceding unsigned comment was added by Wzs951015 (talk ‚Ä¢ contribs) at 23 July 2020, 10:26‚Äé (UTC). Agregar una tabla de wiki data a una nota en wikipedia Hola,No he logrado que la tabla que hice en wikidata aparezca en una nota de wikipedia ¬øhay alg√∫n modo de lograrlo? la nota de wikipedia es esta: https://es.wikipedia.org/wiki/Planta_Solar_Villanueva y la de wikidata es esta: https://www.wikidata.org/wiki/Q98448721 need wiki data query to extract yearly propulation growth of countries need wiki data query to extract yearly population growth of countries from 1960 years should be in column and countries should be in rows can you please help me to get the query Enlazar wikidata con wikipedia Hola hice una tabla en wikidata pero no puedo enlazar ¬øalguien me puede apoyar? Leaders and other metadata for each battle/sieges during the Sengoku Period. Not sure how to phrase this query since its seems like its multiple queries instead of just one. I would like to get data such as the'Commanders and Leaders', 'belligerents', 'strength', 'casualties and loses' for all the battles/sieges during the Sengoku Period. I already made a query of these battles and sieges here... https://w.wiki/bZRWikipedia infoboxes are showing for these for some battles. For eg. https://en.wikipedia.org/wiki/Battle_of_SekigaharaWhat would be the best way to make this query to get the metadata for each of these battles/sieges? Thanks in advance N Greek Given names Hello. I want:a) a query with all items that have given name (P735) -> a value that have writing system (P282) -> Greek alphabet (Q8216), but they don't have name in native language (P1559). For example, Nikolas Englezou (Q7036597) has given name (P735) -> Nikolas (Q97619413) which is an item that have writing system (P282) -> Greek alphabet (Q8216). Nikolas Englezou (Q7036597) has no name in native language (P1559) (in any language) so it must be in the results.b) a query with all items that have given name (P735) -> a value that have writing system (P282) -> Greek alphabet (Q8216), and they have name in native language (P1559) in a language different that Greek. (for example they may have only one value with P1559 in English, or they may have two values with P1559: one in English and one in Greek). For example, Nikitas Tsakiroglou (Q12881733) has given name (P735) -> Nikitas (Q39292409) which is an item that have writing system (P282) -> Greek alphabet (Q8216). Nikitas Tsakiroglou (Q12881733) has name in native language (P1559) in a language that is not Greek. So it must be in the results.Data Gamer play 21:58, 3 November 2020 (UTC) @Data Gamer: a) SELECT ?item ?itemLabel ?givenname ?givennameLabel
WHERE
{
  ?item wdt:P735 ?givenname .
  ?givenname wdt:P282 wd:Q8216 . # writing system is Greek alphabet
  MINUS
  {
    ?item wdt:P1559 [] . # No name in native language
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],el,en\" . }
}
 Try it! b) SELECT ?item ?itemLabel ?nativename (LANG(?nativename) AS ?language_code)
WHERE
{
  ?item wdt:P735 ?givenname .
  ?givenname wdt:P282 wd:Q8216 . # writing system is Greek alphabet
  ?item wdt:P1559 ?nativename .
  FILTER (LANG(?nativename) != \"el\")
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],el,en\" . }
}
 Try it! --Dipsacus fullonum (talk) 07:35, 4 November 2020 (UTC) Thanks!! Data Gamer play 22:56, 5 November 2020 (UTC) Missing citizenship Not sure if such a query already exists, but I would like to have a list of all people that are born in the United States (P569 > 1776 and P19 having P131 = Q30 or subdivision thereof) and do not have US citizenship (i.e. not the statement P27=Q30). Steak (talk) 21:47, 4 November 2020 (UTC) Something lke ... but you can't have labels b/c timeout (at least, not from me) ... SELECT ?item ?itemLabel ?dateOfBirth with {select ?item ?dateOfBirth
WHERE 
{
  ?item wdt:P569 ?dateOfBirth .  hint:Prior hint:rangeSafe true .
  FILTER(\"1776-00-00\"^^xsd:dateTime <= ?dateOfBirth)
  ?item wdt:P19/wdt:P131* wd:Q30.
  FILTER NOT EXISTS {?item wdt:P27 wd:Q30 . }
  }  } as %i
where
{
  INCLUDE %i
  ?item wdt:P31 wd:Q5. 
#  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! --Tagishsimon (talk) 23:33, 4 November 2020 (UTC) Two comments: It is much faster to use wdt:P19/wdt:P17 than wdt:P19/wdt:P131*. However it give more results, mostly Puerto Ricans because Puerto Rico (Q1183) has country (P17) but not located in the administrative territorial entity (P131). Why the 1776 filter? Didn't the inhabitants in the original 13 states become US citizens even if they were born before that date. And the other US states joined USA later anyway. --Dipsacus fullonum (talk) 02:44, 5 November 2020 (UTC) The filter was to avoid persons died before 1776. But actually, the threshold should be 1868 due to the en:Citizenship Clause. Steak (talk) 08:19, 5 November 2020 (UTC) That makes more sense. The use of date of birth (P569) should be then be changed to date of death (P570), and the variable name also changed. --Dipsacus fullonum (talk) 09:00, 5 November 2020 (UTC) Missing articles in English Hello,I'm wondering: what are the French-speaking Wikipedia articles with most interwikis... but not in English? Related to that: the biggest French-speaking Wikipedia articles with no English counterparts? Thanks in advance!Remi Mathis (talk) 11:10, 5 November 2020 (UTC) @Remi Mathis: Both French and English Wikipedia are so big that it is difficult to make that kind of queries without timeout. This query will find articles in French Wikipedia where the Wikidata item has at least 100 sitelinks (both Wikipedia and other Wikimedia projects) but none in English Wikipedia. SELECT ?item ?article ?sitelinks
WITH
{
  SELECT ?item ?article ?sitelinks
  WHERE
  {
    ?article schema:about ?item .
    ?article schema:isPartOf <https://fr.wikipedia.org/> .
    ?item wikibase:sitelinks ?sitelinks . hint:Prior hint:rangeSafe true .
    FILTER (?sitelinks >= 100)
  }
} AS %articles
WHERE
{
  INCLUDE %articles
  MINUS
  {
    [] schema:about ?item ; schema:isPartOf <https://en.wikipedia.org/> .
  }
  MINUS
  {
    VALUES ?exclude { wd:Q11266439 wd:Q20010800 wd:Q15184295 wd:Q14204246
                      wd:Q59541917 wd:Q36330215 wd:Q4167836  wd:Q23894233 }
    ?item wdt:P31 ?exclude . # exclude templates, project pages, modules, categories
  }
}
 Try it! It may or may not timeout. The only result is fr:Talmud. --Dipsacus fullonum (talk) 16:25, 5 November 2020 (UTC) @Remi Mathis: If you decrease the number of sitelinks, the next result comes when it reaches items with 60 sitelinks: SELECT ?item ?article
WHERE
{
  ?article schema:about ?item .
  ?article schema:isPartOf <https://fr.wikipedia.org/> .
  ?item wikibase:sitelinks 60 .
  MINUS
  {
    [] schema:about ?item ; schema:isPartOf <https://en.wikipedia.org/> .
  }
  MINUS
  {
    VALUES ?exclude { wd:Q11266439 wd:Q20010800 wd:Q15184295 wd:Q14204246
                      wd:Q59541917 wd:Q36330215 wd:Q4167836  wd:Q23894233
                      wd:Q59259626 wd:Q19887878 wd:Q15647814 wd:Q23894246
                      wd:Q30432511 wd:Q11753321 wd:Q24046192 wd:Q4663903
                      wd:Q13331174 wd:Q59542487 }
    ?item wdt:P31 ?exclude . # exclude templates, project pages, modules, categories, portals
  }
}
 Try it! It is faster to use an integer constant as object in the triple with wikibase:sitelinks as here, instead of using a variable and a filter. You can run the query repeatedly with decreasing constant values. The space between the number and the period is important here. Without the space, the number would be interpreted as a decimal number instead of an integer, and nothing would be found. --Dipsacus fullonum (talk) 07:42, 6 November 2020 (UTC) I found the next results after 60 at items with 50, 47, 45, 43, 37, 35, 34, 33 sitelinks. --Dipsacus fullonum (talk) 08:00, 6 November 2020 (UTC) Checking where entities are referredIs there a better way to answer the question \"Does this show up anywhere but as a statement qualifier?\" than the querySELECT ?sub ?uri WHERE {
  ?sub ?pred wd:Q58425066.
  BIND(str(?sub) as ?uri)
  FILTER ( !regex(?uri, '/entity/statement/') )
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! Can I test that ?sub is a statement without parsing the url? Gettinwikiwidit (talk) 11:27, 6 November 2020 (UTC) If I understand your request correctly, you want to have items with statements that have any qualifier with Hawaii (Q58425066) as the qualifier value. This is the query: SELECT ?item ?p ?qualifier WHERE {
  ?item ?p [ ?pq wd:Q58425066 ] .
  ?qualifier wikibase:qualifier ?pq .
}
 Try it! ‚ÄîMisterSynergy (talk) 12:22, 6 November 2020 (UTC) Sort of. My question began by wondering where any of the United States senate constituency (Q58425000) items were referred to. The result of the simple query seemed to be returning all statements qualifiers, but I was wondering if it was the object of any statements and so wanted to filter out results where the subject is a statement. Does this make sense? It looks like your query looks specifically for places where this entity is a qualifier. Gettinwikiwidit (talk) 13:03, 6 November 2020 (UTC) I still don't really get it. Maybe for the moment have a look at DESCRIBE wd:Q58425066
 Try it! . This lists all triples where the item in question is involved as subject or object; some of them are rather technical, but it does contain all links from and to that item. In general, most backlinks to an item should have any of these prefixes: wdt: (main statement value, direct link from subject item), ps: (main statement value, via statement node), pq: (qualifier value, via statement node), or pr: (reference value, via reference node that is connected to the statement node via prov:wasDerivedFrom). Technically, there are a few other places (predicates) where items could theoretically be used as values, but it is very unlikely that you find any of those when dealing with election constituencies. ‚ÄîMisterSynergy (talk) 13:20, 6 November 2020 (UTC) This looks like it helps to answer my original question, though I'd like to do it for all instances of United States senate constituency (Q58425000). I guess my solution isn't awful, but I was more or less looking to check does ?sub have a specified prefix. FWIW, per my proposal on Wikidata:Project_chat I am planning to change the labels on such entries to add the word \"delegation\". I wanted to make sure I understood all uses of them before making such a change. Gettinwikiwidit (talk) 13:29, 6 November 2020 (UTC) Okay now I see, I guess. The \"prefix check\" is indeed only possible as a string-based operation, which is rather inefficient. Optimally we'd have something like ?statement_node rdf:type wikibase:Statement (as described at mw:Wikibase/Indexing/RDF_Dump_Format#WDQS_data_differences, but not available here). However, given that this is a rather small data set, we can still do the string operation: SELECT * WHERE {
  ?s ?p [ wdt:P31 wd:Q58425000 ] .
  FILTER( SUBSTR(STR(?s), 1, STRLEN(STR(wds:))) != STR(wds:) ) .
}
 Try it! Seems like all constituency items are only values of electoral district (P768) qualifiers, and there is nothing else. ‚ÄîMisterSynergy (talk) 13:56, 6 November 2020 (UTC) Thanks very much. I had tried ?statement_node rdf:type wikibase:Statement but it didn't work. I wasn't sure if I misunderstood or if there was a better way to express it. I also didn't know you could run STR() on just the prefix. Very useful. Gettinwikiwidit (talk) 14:49, 6 November 2020 (UTC) Filter fr description Hello I'd like to filter either french description or english description or NULL (having one row per item). How should I change FILTER((LANG(?itemdesc)) = \"fr\") in this query ? Why Q101104073 isn't shown in that query ?‚Äé Thanks ! Q101104073 has no item description, which you have mde a mandatory requirement. --Tagishsimon (talk) 20:45, 6 November 2020 (UTC) I think, if I understand the question, this will find items where there is a French, English or Null (for all languages) description; it will emit the english if available, then the french. You could use the variable names and e.g. group_concat if you want both. SELECT distinct ?item ?itemLabel ?itemdesc ?creat  ?dissolution  WHERE {
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en,fr\". }
#  values ?item {wd:Q101104073}
  ?item wdt:P31/wdt:P279* wd:Q3024240.
  OPTIONAL { ?item wdt:P571 ?creat. }
  OPTIONAL { ?item wdt:P576 ?dissolution. }
  OPTIONAL {?item schema:description ?itemdesc . FILTER((LANG(?itemdesc)) = \"fr\") BIND (TRUE as ?true) }
  OPTIONAL {?item schema:description ?itemdesc2 . FILTER((LANG(?itemdesc2)) = \"en\") BIND (TRUE as ?true) }
  OPTIONAL { FILTER NOT EXISTS {?item schema:description ?itemdesc .} BIND (TRUE as ?true)}
  filter(BOUND(?true))
} order by ?creat
 Try it! --Tagishsimon (talk) 20:51, 6 November 2020 (UTC) Wow, thank you, i've slightly adapted here. 2800 items to be checked, pfew :-) Bouzinac‚ÄØüí¨‚óè‚úíÔ∏è‚óèüíõ 21:09, 6 November 2020 (UTC) Page ranges I need to find an item about a paper, or papers, with a DOI, and where page(s) (P304) includes: a comma a character in the range a-zA-Z - as two separate queries, please. Andy Mabbett (Pigsonthewing); Talk to Andy; Andy's edits 16:55, 7 November 2020 (UTC) @Pigsonthewing: something like the below. I presume you just need examples, not all of them. SELECT ?item ?itemLabel ?pages WITH {
  SELECT ?item ?pages
WHERE 
{
  ?item wdt:P304 ?pages.
  filter(contains(?pages,\",\"))
#  filter(regex(?pages,\"[a-zA-Z]\"))
} limit 10 } as %i
WHERE
{
  INCLUDE %i
  ?item wdt:P356 ?doi.
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! --Tagishsimon (talk) 18:17, 7 November 2020 (UTC) You're a clever bugger, Tagishsimon. Thank you. Andy Mabbett (Pigsonthewing); Talk to Andy; Andy's edits 18:29, 7 November 2020 (UTC) Query for pages without Scholia link The WikiProject New Zealand group is thinking about useful maintenance queries. We wondered if it is possible to have a query that searches for New Zealand researchers (not sure whether through occupation researcher or people with an ORCID or...?) with a Wikipedia page that doesn't yet have the Scholia template on it? DrThneed (talk) 01:17, 8 November 2020 (UTC) @DrThneed: I'm sure there's more could be done with this by way of looking at 'employed by a NZ university' or various occupation classes ... but it's the same query from 2 questions ago, repurposed. ?layer is probably your friend. I'll add some more selection fu shortly. SELECT DISTINCT ?item ?itemLabel ?itemDescription ?article ?result WHERE
{
  ?item wdt:P27 wd:Q664.
  {?item wdt:P496 [].}                                # has an ORCId
  UNION                                                 # and/or
  {?university wdt:P31/wdt:P279* wd:Q4671277. hint:Prior hint:gearing \"forward\".
  ?item wdt:P108 ?university.}                        # employed by an academic institution
  UNION                                                 # and/or
  { VALUES ?profession {wd:Q1650915 wd:Q66666607}     # occupation is researcher or academic
    ?item wdt:P106/wdt:P279* ?profession .  hint:Prior hint:gearing \"forward\".}
  OPTIONAL {                                          # get en-wiki articles having a Scholia template
    SELECT ?item ?pageid ?ns WHERE {
      SERVICE wikibase:mwapi {
        bd:serviceParam wikibase:endpoint \"en.wikipedia.org\" .
        bd:serviceParam wikibase:api \"Generator\" .
        bd:serviceParam mwapi:generator \"search\" .
        bd:serviceParam mwapi:gsrsearch \"hastemplate:\\\"Scholia\\\"\" .
        bd:serviceParam mwapi:gsrlimit \"max\" .
        ?item wikibase:apiOutputItem mwapi:item .
        ?ns wikibase:apiOutput \"@ns\" .
       }
    } LIMIT 10000                             
  }
     OPTIONAL {                                        # ?item might have an EN wiki article
    ?article schema:about ?item ;
          schema:isPartOf <https://en.wikipedia.org/> 
  }
  BIND(IF(BOUND(?ns)&&BOUND(?article),\"Has scholia\",
         IF(BOUND(?article),\"Scholia missing\",\"No article\")) as ?result)
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
}
 Try it! --Tagishsimon (talk) 01:29, 8 November 2020 (UTC) Thank you! So quick :) There will be much happiness and consequent infoboxing. DrThneed (talk) 01:35, 8 November 2020 (UTC) @DrThneed: More fu, above. This only really works up until more than 10k Scholia templates are used on en-wiki, after which it's hit & miss whether the academics found by the early clauses match those found by the search service. Right now, 1,311 such templates on en-wiki, afaics so NZ has first-mover advantage. Finally, to be very specific, we're getting people with NZ citizenship here. Were you to want non-NZ academics working in NZ, a tweak would be required. --Tagishsimon (talk) 01:54, 8 November 2020 (UTC) @DrThneed: Tweaked again; columns should be more useful now. --Tagishsimon (talk) 02:21, 8 November 2020 (UTC) Brilliant, thank you, just what we needed. We'll worry about the 10k Scholia problem when we get there, although I guess this will help us get there faster! DrThneed (talk) 02:56, 8 November 2020 (UTC) @DrThneed: Yeah. Me again. In the version below, the report checks that the person is the author or editor of a publication. The little I know about the Scholia template suggests these might be your highest priorities? SELECT DISTINCT ?item ?itemLabel ?itemDescription ?article ?result WHERE
{
  ?item wdt:P27 wd:Q664.
  {?item wdt:P496 [].}                                # has an ORCId
  UNION                                                 # and/or
  {?university wdt:P31/wdt:P279* wd:Q4671277. hint:Prior hint:gearing \"forward\".
  ?item wdt:P108 ?university.}                        # employed by an academic institution
  UNION                                                 # and/or
  { VALUES ?profession {wd:Q1650915 wd:Q66666607}     # occupation is researcher or academic
    ?item wdt:P106/wdt:P279* ?profession .  hint:Prior hint:gearing \"forward\".}
  OPTIONAL {                                          # get en-wiki articles having a Scholia template
    SELECT ?item ?pageid ?ns WHERE {
      SERVICE wikibase:mwapi {
        bd:serviceParam wikibase:endpoint \"en.wikipedia.org\" .
        bd:serviceParam wikibase:api \"Generator\" .
        bd:serviceParam mwapi:generator \"search\" .
        bd:serviceParam mwapi:gsrsearch \"hastemplate:\\\"Scholia\\\"\" .
        bd:serviceParam mwapi:gsrlimit \"max\" .
        ?item wikibase:apiOutputItem mwapi:item .
        ?ns wikibase:apiOutput \"@ns\" .
       }
    } LIMIT 10000                             
  }
     OPTIONAL {                                        # ?item might have an EN wiki article
    ?article schema:about ?item ;
          schema:isPartOf <https://en.wikipedia.org/> 
  }
  FILTER EXISTS {?paper wdt:P31/wdt:P279* wd:Q732577.  # things that are publications
                 hint:Prior hint:gearing \"forward\".
                 ?paper wdt:P50|wdt:P98 ?item .    # is the author or editor of a publication
  }
  BIND(IF(BOUND(?ns)&&BOUND(?article),\"Has scholia\",
         IF(BOUND(?article),\"Scholia missing\",\"No article\")) as ?result)
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\". }
}
 Try it! --Tagishsimon (talk) 02:59, 8 November 2020 (UTC) Thank you, that's a useful tweak. DrThneed (talk) 03:38, 8 November 2020 (UTC)  References used in an item Items used: Franklin School (Q100000001) ‚ÄØ Properties used: type of reference (P3865) ‚ÄØ , reference URL (P854) ‚ÄØ , retrieved (P813) ‚ÄØ , stated in (P248) ‚ÄØ SELECT ?prop3Label ?cLabel ?statedinLabel ?propIDLabel   ?refurl 
  ?reftypeLabel (GROUP_CONCAT(DISTINCT ?propLabel; separator=\", \") as ?claims)
{
SELECT DISTINCT ?prop ?propLabel ?prop3Label ?cLabel ?statedinLabel ?propIDLabel 
  ?refurl 
  ?reftypeLabel
{
  hint:Query hint:optimizer \"None\". 
  wd:Q100000001 ?p ?st . 
   ?prop wikibase:claim ?p .
    ?st ?ps ?a . 
    ?a ?pr [] .
   ?prop2 wikibase:reference ?pr .
  OPTIONAL { ?prop3 wikibase:reference ?pr .  ?a ?pr ?c .
            FILTER( ?pr != pr:P3865 && ?pr != pr:P854 && ?pr != pr:P813 && ?pr != pr:P248   )  
            FILTER NOT EXISTS { ?prop3 wikibase:propertyType wikibase:ExternalId }
            }
  OPTIONAL { ?a pr:P248 ?statedin }
  OPTIONAL { ?propID wikibase:propertyType wikibase:ExternalId ; wikibase:reference ?pr0 . ?a ?pr0 [] }
  OPTIONAL { ?a pr:P3865 ?reftype }
  OPTIONAL { ?a pr:P854 ?refurl . BIND(\"y\" as ?hasrefurl) }
  
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}  
}
GROUP BY ?prop3Label ?cLabel ?statedinLabel ?propIDLabel 
  ?refurl 
  ?reftypeLabel Try it!I'm trying to build a good query that would show what references are used in an item that could potentially work and be displayed on any item.The above works somewhat for Franklin School (Q100000001) that has only 4 different references (+ some differences in formatting/reference url): the official website, myschool, some other website, the place name sign.If you change it to Q42, it's less condensed.Ideally the columns would probably be: the value of \"stated in\" (mainly label, possibly also the item) maybe also or alternatively, the label of the external-id property type of reference (if available) reference url (possibly external-id-urls included there as well) everything else available for the same reference could probably just be be concatenated in one column (not yet done in the above) + all claims using the reference (last column in the above) If there are some differences in the information for a similar reference, I don't mind if there are several lines (e.g. myschool in two lines for the sample above). The query doesn't fully join it to that point yet though.What do you think? --- Jura 06:24, 8 November 2020 (UTC) Facts from specific domain I am looking for all facts, containing certain relation, e.g. wdt:P361, bur restricted to a specific domain, let's say 'Artificial Intelligence'. Thank you! The hardest part of that request is to interpret what you mean. It may be this: SELECT DISTINCT ?item ?itemLabel ?object ?objectLabel
{
  ?item wdt:P31 / wdt:P279* wd:Q11660 . # Find items in the domain
  ?item wdt:P361 ?object .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\" . }
}
 Try it! or it may not. --Dipsacus fullonum (talk) 18:23, 9 November 2020 (UTC) United States Senators/House reps who have been astronauts Mainly inspired by Mark Kelly (Q357510), who was just elected last week. I figure this might be a neat query to have in next week's status update :) Nicereddy (talk) 03:40, 10 November 2020 (UTC) @Nicereddy: SELECT ?item ?itemLabel ?position ?positionLabel
{
  ?item wdt:P106 wd:Q11631 . # Occupation: Astronaut
  VALUES ?position { wd:Q4416090 wd:Q13218630 } # US senator, US representative
  ?item wdt:P39 ?position .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\" . }
}
 Try it! Additional information could be added like space missions, electoral district, election periods etc. --Dipsacus fullonum (talk) 11:10, 10 November 2020 (UTC) @Nicereddy, Dipsacus fullonum: This might also be of interest - SELECT distinct ?position ?positionLabel (count (distinct ?item) as ?count)
{
  { ?item wdt:P106 wd:Q11631 } union { ?item wdt:P106 wd:Q13188567 } union { ?item wdt:P450 ?mission } 
  # three ways to say \"went to space\" - occupation astronaut, occupation cosmonaut, was on a spaceflight
  # 
  ?item p:P39 ?ps. ?ps ps:P39 ?position . ?item wdt:P31 wd:Q5
  # they held some kind of position and also were a real person
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\" . }
} group by ?position ?positionLabel order by desc(?count)
 Try it! This query goes a bit further - it finds all positions held by someone who's gone to space, and the \"astronaut\" query is extended a bit to pick up about ten or fifteen extra people who don't have occupation:astronaut set. I think there's over a dozen legislatures in there, but it seems tricky to limit it to only elected posts. Andrew Gray (talk) 12:57, 10 November 2020 (UTC) A list of false cognates (lexemes) between Portuguese and Esperanto Basically, I want to have a Listeria list replace this page pt:Ap√™ndice:Falsos cognatos/Esperanto pt:wikt:Ap√™ndice:Falsos cognatos/Esperanto. How could it be done? NMaia (talk) 02:27, 10 November 2020 (UTC) I think you mean: https://pt.wiktionary.org/wiki/Ap%C3%AAndice:Falsos_cognatos/Esperanto That would probably be identical forms or lemma but different sense (one or several)? --- Jura 07:35, 10 November 2020 (UTC) @Jura1: Thanks. Yes, identical forms but different meanings. If the forms are the same and the meaning is the same, it doesn't count. NMaia (talk) 13:26, 10 November 2020 (UTC) Items used: Esperanto (Q143) ‚ÄØ , Portuguese (Q5146) ‚ÄØ """@en;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:Request_a_query/Archive/2020/11>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d846058-wikidata_prefixes;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX llemma:   <http://wikiba.se/ontology#lemma>
PREFIX lcat:     <http://wikiba.se/ontology#lexicalCategory>
PREFIX llang:    <http://purl.org/dc/terms/language>
PREFIX lforms:   <http://www.w3.org/ns/lemon/ontolex#lexicalForm>
PREFIX lhasform: <http://www.w3.org/ns/lemon/ontolex#representation>
PREFIX lfeature: <http://wikiba.se/ontology#grammaticalFeature>
PREFIX lsenses:  <http://www.w3.org/ns/lemon/ontolex#sense>
PREFIX lglos:    <http://www.w3.org/2004/02/skos/core#definition>

SELECT
  *
WITH
{  
  SELECT ?leo ?lmeo ?lcateo (strlang(str(?lword_eo),\"pt\") as ?lword_pt) 
  WHERE
  { ?leo llemma: ?lmeo ; llang: wd:Q143 ; lcat: ?lcateo ; lforms: / lhasform: ?lword_eo } 
} as %eo
WHERE
{
  hint:Query hint:optimizer \"None\".
  INCLUDE %eo 
  ?lfpt lhasform: ?lword_pt .          
  ?lpt llemma: ?lmpt ; llang: wd:Q5146 ; lcat: ?lcatpt ; lforms: ?lfpt
}""";
  <http://example.org/bigdata_select> """PREFIX llemma:   <http://wikiba.se/ontology#lemma>
PREFIX lcat:     <http://wikiba.se/ontology#lexicalCategory>
PREFIX llang:    <http://purl.org/dc/terms/language>
PREFIX lforms:   <http://www.w3.org/ns/lemon/ontolex#lexicalForm>
PREFIX lhasform: <http://www.w3.org/ns/lemon/ontolex#representation>
PREFIX lfeature: <http://wikiba.se/ontology#grammaticalFeature>
PREFIX lsenses:  <http://www.w3.org/ns/lemon/ontolex#sense>
PREFIX lglos:    <http://www.w3.org/2004/02/skos/core#definition>

SELECT
  *
WITH
{  
  SELECT ?leo ?lmeo ?lcateo (strlang(str(?lword_eo),\"pt\") as ?lword_pt) 
  WHERE
  { ?leo llemma: ?lmeo ; llang: wd:Q143 ; lcat: ?lcateo ; lforms: / lhasform: ?lword_eo } 
} as %eo
WHERE
{
  hint:Query hint:optimizer \"None\".
  INCLUDE %eo 
  ?lfpt lhasform: ?lword_pt .          
  ?lpt llemma: ?lmpt ; llang: wd:Q5146 ; lcat: ?lcatpt ; lforms: ?lfpt
}""" .
