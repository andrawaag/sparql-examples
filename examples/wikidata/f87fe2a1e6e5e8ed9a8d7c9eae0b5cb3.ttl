@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-f87fe2a1e6e5e8ed9a8d7c9eae0b5cb3> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/th>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eu>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en-gb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/vec>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/hy>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/id>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/be-tarask>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/tr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ro>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/he>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/zh>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pt-br>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/si>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eo>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/da>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ar>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ko>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ms>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/sv>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lt>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/nl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ca>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/uk>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/it>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ja>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/es>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/cs>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ru>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/de>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/fr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d854590-wikidata_prefixes, _:genid-4e694113159d4e3db4a1a913894a81d854590-1F2E42630282093B01D5961CAE4E9517,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-0C9B739A8447ACC30DA22A754AAD3BB7, _:genid-4e694113159d4e3db4a1a913894a81d854590-A240695E668D24A0CB06CA7EE816DCBF,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-0191188E4482338CB28C00DCAA1FBEDE, _:genid-4e694113159d4e3db4a1a913894a81d854590-F9E85A285B7A4F5653A5AC6E73375811,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-DFC9DE5A51DDE515090593193B91A48C, _:genid-4e694113159d4e3db4a1a913894a81d854590-578E7A3DFB2D8EB53FBB68319368D864,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-33F64E68A6FF89DF647B3B84044C1E12, _:genid-4e694113159d4e3db4a1a913894a81d854590-EF53B81C900629D9F7242E5C9DADB418,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-C94DF9D6A5023FDF3786409517112D07, _:genid-4e694113159d4e3db4a1a913894a81d854590-4F150F888846F7501553958D931BAB63,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-DACE6569594507AD6B9F3744C94DA1F1, _:genid-4e694113159d4e3db4a1a913894a81d854590-B09ADD082A270D6C2BF641D316C46241,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-BC94E73C000B9BA4255B3D855ED8D769, _:genid-4e694113159d4e3db4a1a913894a81d854590-5270263106CACF5AB30F277B386D13B8,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-7F3E1E488E2014D8FC226D8B86FBF3B0, _:genid-4e694113159d4e3db4a1a913894a81d854590-A75149A4A9CC41F4928E3250705FF914,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-06895F8510C964C6353289173A7E1771, _:genid-4e694113159d4e3db4a1a913894a81d854590-63C81BE38FEC87B24E37E4308A0B5827,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-03FB27AFC5F11BDD528AF159C294B919, _:genid-4e694113159d4e3db4a1a913894a81d854590-ED1CA6A7FD564806D417E7560EB69C06,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-E449D4335D78B212EBEA2326DE403DC7, _:genid-4e694113159d4e3db4a1a913894a81d854590-21D9EFFCEA68B61D6CE3A737CE008ECF,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-AD03E1092DA9FA755AB8D63E767B1803, _:genid-4e694113159d4e3db4a1a913894a81d854590-33E0F94F01E326CE5C19AD732CD7CA07,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-2370360033AFB3FFDB66DD47BC6A87E3, _:genid-4e694113159d4e3db4a1a913894a81d854590-2CABF31DFECB3EDB70E602D006C48DFC,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-F5FAAA0AFCDCC4FC61D5855253BE2E29, _:genid-4e694113159d4e3db4a1a913894a81d854590-FF5CE16C27DDAFECF8E19838E5A2F9E9,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-9F26AE31D7AE2ECCD975D9626FD28108, _:genid-4e694113159d4e3db4a1a913894a81d854590-B14C82C5FDC9124AC7DC431AA7F790DB,
    _:genid-4e694113159d4e3db4a1a913894a81d854590-52178B039B9B222F59B87BADF8F1A6F0, _:genid-4e694113159d4e3db4a1a913894a81d854590-6E38F52AE2919F8E8DAF3F2AFAE1248E;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX bd: <http://www.bigdata.com/rdf#>
#defaultView:ScatterChart
PREFIX var_muntype: <http://www.wikidata.org/entity/Q15284>
PREFIX var_area: <http://www.wikidata.org/entity/Q6308>
SELECT ?from ?kilometers ?to ?rank_group
WHERE {
  {
    SELECT (SAMPLE(?mun) AS ?mun) (SAMPLE(?mun2) AS ?mun2) (SAMPLE(?distNum) AS ?kilometers)
           (COUNT(*)-1 AS ?rg) (SUBSTR(\"00\",1+STRLEN(STR(?rg))) AS ?rgpad)
           (IF(FLOOR((?rg-(100*FLOOR(?rg/100)))/10)=1,0,?rg-(10*FLOOR(?rg/10))) AS ?rgmod)
           (IF(?rgmod=1,\"st\",IF(?rgmod=2,\"nd\",IF(?rgmod=3,\"rd\",\"th\"))) AS ?rgord)
           (CONCAT(?rgpad,STR(?rg),?rgord,\"-most farthest places\") AS ?rank_group)
    WHERE {
      { SELECT ?mun (SAMPLE(?loc) AS ?loc)
        WHERE { ?mun wdt:P31/wdt:P279* var_muntype:;
                     wdt:P131 var_area:;
                     wdt:P625 ?loc. }
        GROUP BY ?mun
      }
      OPTIONAL {
        { SELECT (?mun AS ?mun2) (SAMPLE(?loc) AS ?loc2)
          WHERE { ?mun wdt:P31/wdt:P279* var_muntype:;
                       wdt:P131 var_area:;
                       wdt:P625 ?loc. }
          GROUP BY ?mun
        }
      }
      OPTIONAL {
        { SELECT (?mun AS ?mun3) (SAMPLE(?loc) AS ?loc3)
          WHERE { ?mun wdt:P31/wdt:P279* var_muntype:;
                       wdt:P131 var_area:;
                       wdt:P625 ?loc. }
          GROUP BY ?mun
        }
      }
      BIND(geof:distance(?loc, ?loc2) AS ?distNum).
      BIND(geof:distance(?loc, ?loc3) AS ?d).
      FILTER(?distNum >= ?d).
    } GROUP BY ?mun ?mun2 ?distNum
  }

  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],mul,en\".
    ?mun rdfs:label ?from.
    ?mun2 rdfs:label ?to.
  }
}
ORDER BY ?rank_group ?kilometers ?from""" .
