@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-0342d555bf09762693469bff06cfb2cd> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  rdfs:comment """ This page is an archive. Please do not modify it. Use the current page, even to continue an old discussion. Contents 1 Top Famous People in US 2 New editor - two references shown as one 3 Query help needed to get page name, industry and founded 4 How many children got Alkmene (Q190543) 5 Display Label 6 Display only the oldest date 7 List of persons 8 No longer working query 9 Query: Number of articles 10 ORDER BY Family name (II) 11 Include qualifier in query 12 How to find items corresponding to Wikipedia titles without timeout? 13 COUNT not double with two localisation 14 Select all items except those that have the property \"is an instance of\" AND which not objects of the property \"is an instance of\" at the same time 15 How to filter out all items that do not have a label, and then also filter out all which have no properties at all? 16 Covid impact by country in country's official language 17 How to filter out all items that do not have a label, and which have no properties at all? - Suggested queries still returns those with no label? 18 Siblings with close dates of birth 19 Find state of a US location 20 nobel price in literature 21 Articles beginning with each letter 22 Why do I get 1 as a ?unitShort… 23 Optimization of a query 24 Femmes réunionnaises 25 Query by P2093 string 26 How many official languages are there in the world ? 27 Clash between COUNT and SERVICE wikibase:label ? 28 How to deal with time limit constraints? 29 Using a triple as an IF condition 30 Most used properties with no inverse label item (P7087) 31 Tennis player information 32 Stars belonging to Hydra constellation 33 Insulin en-wiki 34 Access Wikidata property qualifiers 35 Items and properties for SparQL-query on categories 36 check if Wikidata entry of a distinct person exists 37 Get all surnames from Wikidata ? 38 Names with missing Caverphone statements 39 Maintenance query : items from X category on langwiki without Z template 40 Show items with a property which has ANY qualifier ? 41 Query about Q21528878 42 Rest of division = 0 43 Retrieve occupation of person 44 Most polluted rivers in the world 45 Coronavirus deaths per date 46 Different date columns 47 Bag balm, Melkfett, Uierzalf, バッグ・バーム are not linked 48 items containing a name without property named after that person 49 Female Scientists who are a member of two notable science academies? 50 El Pulqui Empresa 51 Personas inspiradas en una obra/persona 52 How do I access an item's aliases, descriptions 53 List of disambig cities, towns, villages etc in the USA. 54 Adding a qualifier 55 Percentage column 56 Wikidata list 57 ?item =wd:QXXX 58 Finding items with invalid numerical values for a given property 59 problem with query 60 Equivalent of IN in a query 61 SPANISH FLU 1918 62 Tallest buildings 63 Statements with specific qualifiers 64 How to group values in a hierarchy? 65 Items 1 km. far from you 66 Query to find all relations 67 Añadir un enlace de otra Wikipedia 68 Get XML RDF format from a query link 69 Draughtsmen and Engravers called A. Walker or W. Walker 70 Query fixing (string replacement) 71 Multiple images and enWikisource sitelinks 72 ORCID iD without a country of citizenship 73 Pianists born in Morocco who died in Paris 74 Person 75 How many triples for Q30 76 Improve a list article at w:pt 77 Find 7 musicians somehow related 78 list of Nazi camps Top Famous People in US I'm looking to query the top 1000 famous people in the US, and output the following: - Where they were born - Occupation - If Actor, shows they were on - Any other famous people they are connected toThe last two bullets are \"nice to haves\", so I'd be happy even if the first two items can be queried.As for how to define famous? If there's no easy way, then I'd just be looking for the people who have occupations of actor, musician, and athlete.Thanks in advance for any help with this query! – The preceding unsigned comment was added by QueryBeginner (talk • contribs) at 31 mars 2020 kl. 16.47‎ (UTC). @QueryBeginner: You have to define what constitutes the level of fame in order to make a top list. If we define the \"fame\" as the number of Wikipedias that have an article about the respective person the number of pages/articles in all Wikimedia projects about the respective person with sitelinks on Wikidata, and \"people in the US\" as objects having United States of America (Q30) as the value for the country of citizenship (P27) property, the following query finds the \"top 1,000 famous people in the US\" with their respective place of birth (P19) and occupation (P106). SELECT ?item ?itemLabel (SAMPLE(?p19label) AS ?birthplace) (GROUP_CONCAT(?p106label;SEPARATOR=', ') AS ?occupations) ?fame  {
  ?item wdt:P31 wd:Q5 .
  ?item wdt:P27 wd:Q30 .
  ?item wikibase:sitelinks ?fame . FILTER(?fame>50)
  ?item wdt:P106 ?p106 . ?p106 rdfs:label ?p106label . FILTER(LANG(?p106label)='en')
  ?item wdt:P19 ?p19 . ?p19 rdfs:label ?p19label . FILTER(LANG(?p19label)='en')
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
GROUP BY ?item ?itemLabel ?fame
ORDER BY DESC(?fame) ?itemLabel
LIMIT 1000
 Try it! --Larske (talk) 17:30, 31 March 2020 (UTC) The definition of fame in the query isn't number Wikipedia articles, but number of pages/articles in all Wikimedia projects with sitelinks on Wikidata. --Dipsacus fullonum (talk) 21:34, 31 March 2020 (UTC) @Dipsacus fullonum: That is correct. The query times out when I try to filter on Wikipedia links only. I have changed the description above. Below query finds the top 100 famous people in Andorra (Q228) where fame counts the Wikipedia links only. Do you know some way to optimize this query to prevent a timeout when used with top 1,000 for United States of America (Q30)? SELECT ?item ?itemLabel (SAMPLE(?p19label) AS ?birthplace) (GROUP_CONCAT(?p106label;SEPARATOR=', ') AS ?occupations) (?fame AS ?wikipedialinks) WITH {
SELECT ?item (COUNT(?wikipedialink) AS ?fame) {
  ?item wdt:P31 wd:Q5 .
  ?item wdt:P27 wd:Q228 . # wd:Q30 for USA
  ?wikipedialink schema:isPartOf [ wikibase:wikiGroup \"wikipedia\" ]; schema:about ?item .
  } 
  GROUP BY ?item
  HAVING (?fame>5)        # ?fame>50 for USA
} AS %i WHERE {
  include %i
  ?item wdt:P106 ?p106 . ?p106 rdfs:label ?p106label . FILTER(LANG(?p106label)='en')
  ?item wdt:P19 ?p19 . ?p19 rdfs:label ?p19label . FILTER(LANG(?p19label)='en')
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
GROUP BY ?item ?itemLabel ?fame
ORDER BY DESC(?wikipedialinks) ?itemLabel
LIMIT 100                 #  1000 for USA
 Try it! --Larske (talk) 03:09, 2 April 2020 (UTC) @Larske: You can use that an item with more than n Wikipedia articles also will have more than n sitelinks and start with a cheap filter to eliminate most of the candidates. The query below finds top 1000 for USA in approx. 40 seconds: SELECT ?item ?itemLabel (SAMPLE(?p19label) AS ?birthplace)
       (GROUP_CONCAT(?p106label;SEPARATOR=', ') AS ?occupations)
       (?fame AS ?wikipedialinks)
WITH
{
  SELECT ?item
  WHERE
  {
    ?item wdt:P31 wd:Q5 .
    ?item wdt:P27 wd:Q30 .
    ?item wikibase:sitelinks ?fame1 . FILTER(?fame1 > 55)
  }
} AS %i1

WITH
{
  SELECT ?item (COUNT(?wikipedialink) AS ?fame)
  WHERE
  {
    INCLUDE %i1
    ?wikipedialink schema:isPartOf [ wikibase:wikiGroup \"wikipedia\" ]; schema:about ?item .
  }
  GROUP BY ?item
  HAVING (?fame > 55)
} AS %i2

WHERE
{
  INCLUDE %i2
  ?item wdt:P106 ?p106 . ?p106 rdfs:label ?p106label . FILTER(LANG(?p106label)='en')
  ?item wdt:P19 ?p19 . ?p19 rdfs:label ?p19label . FILTER(LANG(?p19label)='en')
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
GROUP BY ?item ?itemLabel ?fame
ORDER BY DESC(?wikipedialinks) ?itemLabel
LIMIT 1000
 Try it! --Dipsacus fullonum (talk) 10:45, 2 April 2020 (UTC) Thanks! --Larske (talk) 10:58, 2 April 2020 (UTC) New editor - two references shown as one While editing Home Alone (Q105031), I tried to add two reference URL (P854)s in the statement \"Christmas film (Q28026639)\" (which is inside the statement \"genre (P136)\"), but it was saved as \"1 reference\". Is there a way to show this as 2 references? Many thanks, Thatoneweirdwikier beep boop 13:05, 3 April 2020 (UTC) @Thatoneweirdwikier: No, you cannot show one reference as being two but I edited the item to split the reference into two in this edit. --Dipsacus fullonum (talk) 13:41, 3 April 2020 (UTC) Dipascus fullonum, that's exactly what I was looking for. Thanks very much! Thatoneweirdwikier beep boop 13:44, 3 April 2020 (UTC) Query help needed to get page name, industry and founded Can someone pls help me with a query that gets name(page name), industry and founded from wiki pages for companies. Can be limited to US, if it improves performance.Ex: https://en.wikipedia.org/wiki/MicrosoftCompany Name/Page Name: MicrosoftIndustry: Software development (Can list all or one industry)Founded: April 4 1975 (Year is fine) Here is what you asked for, but I am not sure it is what you wanted: SELECT ?item ?name ?wikipage ?founded (GROUP_CONCAT(?industryLabel; SEPARATOR=', ') AS ?industries)
WHERE
{
  ?item wdt:P31/wdt:P279* wd:Q783794. # is company
  ?item wdt:P17 wd:Q30. # in US
  ?wikipage schema:about ?item. # Wiki pages for the company
  ?item wdt:P452 ?industry. # industry
  OPTIONAL { ?item wdt:P571 ?founded. } # inception
  SERVICE wikibase:label
  {
    bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\".
    ?industry rdfs:label ?industryLabel.
    ?item rdfs:label ?name.
  }
}
GROUP BY ?item ?name ?founded ?wikipage
 Try it! --Dipsacus fullonum (talk) 18:35, 3 April 2020 (UTC) How many children got Alkmene (Q190543) It seems easy. SELECT ?Alcmena ?AlcmenaLabel ?said_to_be_the_same_as ?said_to_be_the_same_asLabel WHERE {
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
  ?Alcmena wdt:P25 wd:Q190543.
  OPTIONAL { ?Alcmena wdt:P460 ?said_to_be_the_same_as. }
}
LIMIT 100
 Try it! However, two of the childrens are really the same because are differents mythological names for the same person, as the said to be the same as (P460) shows. How to avoid this bad result (to me is not an error) ? The problem is not only in SPARQL indirect access but in the value of child (P40) for Alkmene (Q190543), then, the result of fetched information in infoboxes are also wrong. Any idea ?Related chat in Wikidata:Project_chat#Avoid_duplicate_items_associated_by_P460Thanks, Amadalvarez (talk) 07:07, 4 April 2020 (UTC) Display Label Hello,Could you help me to understand why I can not display the value of director (P57) #films mis à disposition en libre accès en VOD par artfilm.ch durant la crise du Covid-19
SELECT DISTINCT ?film ?filmLabel (GROUP_CONCAT(DISTINCT(?réalLabel); separator=\", \") as ?réals) ?duree (GROUP_CONCAT(DISTINCT(?date); separator=\", \") as ?dates) ?decrit 
WHERE 
{
  ?film wdt:P1344 wd:Q89370484;
        wdt:P2047 ?duree;
        wdt:P577 ?date;
        wdt:P57 ?réal.
  ?film p:P973 ?describestmt.
  ?describestmt ps:P973 ?decrit.
  ?describestmt pq:P407 wd:Q150.
  FILTER STRSTARTS(STR(?decrit), \"https://www.artfilm.ch\").
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en,de,it,es\".}
}
GROUP BY ?film ?filmLabel ?duree ?decrit
 Try it! Thanks in advance ! --2le2im-bdc (talk) 12:34, 4 April 2020 (UTC) It is because labels from the label service in automatic mode cannot be used as function arguments. You need to use the manual mode of the label service instead. It is explained in the manual at mw:Wikidata Query Service/User Manual#Label service. --Dipsacus fullonum (talk) 13:18, 4 April 2020 (UTC) Great !Thanks a lot @Dipsacus fullonum:! It work! #films mis à disposition en libre accès en VOD par artfilm.ch durant la crise du Covid-19
SELECT DISTINCT ?film ?filmLabel (GROUP_CONCAT(DISTINCT(?réalLabel); separator=\", \") as ?réals) ?duree (MIN(?date) as ?oldest_date) ?decrit 
WHERE 
{
  ?film wdt:P1344 wd:Q89370484;
        wdt:P2047 ?duree;
        wdt:P577 ?date;
        wdt:P57 ?réal.
  ?film p:P973 ?describestmt.
  ?describestmt ps:P973 ?decrit.
  ?describestmt pq:P407 wd:Q150.
  FILTER STRSTARTS(STR(?decrit), \"https://www.artfilm.ch\").
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en,de,it,es\".
                         ?réal rdfs:label ?réalLabel.
                         ?film rdfs:label ?filmLabel.
                         }
}
GROUP BY ?film ?filmLabel ?duree ?decrit
 Try it! Display only the oldest date Hello,How to write this query with the scope to have only one date displayed? We want to display only the oldest date to be able to display a timeline. #films mis à disposition en libre accès en VOD par artfilm.ch durant la crise du Covid-19
SELECT DISTINCT ?film ?filmLabel (GROUP_CONCAT(DISTINCT(?réalLabel); separator=\", \") as ?réals) ?duree (GROUP_CONCAT(DISTINCT(?date); separator=\", \") as ?dates) ?decrit 
WHERE 
{
  ?film wdt:P1344 wd:Q89370484;
        wdt:P2047 ?duree;
        wdt:P577 ?date;
        wdt:P57 ?réal.
  ?film p:P973 ?describestmt.
  ?describestmt ps:P973 ?decrit.
  ?describestmt pq:P407 wd:Q150.
  FILTER STRSTARTS(STR(?decrit), \"https://www.artfilm.ch\").
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en,de,it,es\".}
}
GROUP BY ?film ?filmLabel ?duree ?decrit
 Try it! Thanks in advance! --2le2im-bdc (talk) 13:14, 4 April 2020 (UTC) @2le2im-bdc: Instead of (GROUP_CONCAT(DISTINCT(?date); separator=\", \") as ?dates) you can use (MIN(?date) as ?oldest_date). Be aware that the different dates may different precision which can influence the result. --Dipsacus fullonum (talk) 13:25, 4 April 2020 (UTC) Great! Thanks a lot @Dipsacus fullonum:! --2le2im-bdc (talk) 15:16, 4 April 2020 (UTC) List of persons I had previously requested a query. I would like to be more thorough and specific if possible. I would like to get the following: Image Gender Year of birth Country of birth Year of death Country of death Occupation If possible, only take into account people born between 1675 and 1995.Also, sometimes it doesn't get the name of the person and keeps the title of the item in Wikidata (instead of Paul it appears Q24243), can that be fixed?. Greetings. --Hispano76 (talk) 20:47, 4 April 2020 (UTC) You can edit the items to complete the label. --- Jura 21:21, 4 April 2020 (UTC) @Hispano76: You will see Q number for an item when there is no label in any the requested languages (in this case Spanish and English). You can add more language codes to the label service (in the line bd:serviceParam wikibase:language \"es,en\".) or edit the item to add more labels. Here is the same query as before with the requested data: #Mujeres mexicanas
SELECT ?item ?name ?image ?gender ?year_of_birth ?country_of_birth
       ?year_of_death ?country_of_death
       (GROUP_CONCAT(?occupation; SEPARATOR=\", \") AS ?occupations)
WHERE
{
  ?item wdt:P21 wd:Q6581072 .
  ?item wdt:P27 wd:Q96 .
  OPTIONAL {
    ?item wdt:P18 ?image.
  }
  OPTIONAL {
    ?item wdt:P21 ?gender_item.
  }
  ?item wdt:P569 ?date_of_birth.
  BIND (YEAR(?date_of_birth) AS ?year_of_birth)
  FILTER (?year_of_birth >= 1675 && ?year_of_birth < 1995)
  OPTIONAL {
    ?item wdt:P19/wdt:P17 ?country_of_birth_item.
  }
  OPTIONAL {
    ?item wdt:P570 ?date_of_death.
    BIND (YEAR(?date_of_death) AS ?year_of_death)
  }
  OPTIONAL {
    ?item wdt:P20/wdt:P17 ?country_of_death_item.
  }
  OPTIONAL {
    ?item wdt:P106 ?occupation_item.
  }
  SERVICE wikibase:label {
    bd:serviceParam wikibase:language \"es,en\".
    ?item rdfs:label ?name.
    ?gender_item rdfs:label ?gender.
    ?country_of_birth_item rdfs:label ?country_of_birth.
    ?country_of_death_item rdfs:label ?country_of_death.
    ?occupation_item rdfs:label ?occupation.
  }
}
GROUP BY ?item ?name ?image ?gender ?year_of_birth ?country_of_birth ?year_of_death ?country_of_death
 Try it! --Dipsacus fullonum (talk) 21:50, 4 April 2020 (UTC) No longer working query Hello this query functioned very well. I tried it tonight and seems the calculation are broken, why and any fix possible? PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>

select ?siège ?siègeLabel (sample(?whereLabel) as ?whereLabel2) ?start ?tp_end ?tv_end ?end ?days {
SELECT ?siège ?siègeLabel ?whereLabel ?start ?tp_end ?tv_end ?end ?days WHERE {
SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
?siège wdt:P31 wd:Q188055.
OPTIONAL { ?siège wdt:P580 ?start. }
OPTIONAL { 
           ?siège wdt:P582/psv:P582 ?p582node . 
           ?p582node wikibase:timeValue ?tv_end .       # get the time value
           ?p582node wikibase:timePrecision ?tp_end .   # get the time precision
           BIND(
             IF(?tp_end=9,?tv_end + \"P1Y\"^^xsd:duration - \"P1D\"^^xsd:duration,# set end date to 31 December if time precision is \"year\" (9)
             IF(?tp_end=10,?tv_end + \"P1M\"^^xsd:duration - \"P1D\"^^xsd:duration,# set end date to 28th if time precision is \"month\" (10)
             ?tv_end))
              AS ?end).
         }
OPTIONAL { ?siège wdt:P276 ?where. } 
OPTIONAL { ?siège p:P2047/psn:P2047/wikibase:quantityAmount ?lengthNorm.}
BIND(COALESCE(?lengthNorm/86400,(?end - ?start+1)) as ?days)
}
}
group by ?siège ?siègeLabel ?start ?tp_end ?tv_end ?end ?days
order by ?whereLabel2 desc(year(?end))
 Try it! What is the problem – What did you expect the query to do that it doesn't do? --Dipsacus fullonum (talk) 22:36, 4 April 2020 (UTC) BTW. you probably mean \"?siège p:P582/psv:P582 ?p582node .\" instead of \"?siège wdt:P582/psv:P582 ?p582node .\" as the first property chain will never give any results. --Dipsacus fullonum (talk) 22:54, 4 April 2020 (UTC) Thank you Dipsacus fullonum, worked well with the fix ?siège p:P582/psv:P582 ?p582node !Bouzinac (talk) 06:45, 5 April 2020 (UTC) Query: Number of articles Hi everyone! I wonder if it's possible obtaining a query which produces the following: \"How many articles of people who died in Berlin are there in fr.wikipedia?\". And \"how many in de.wikipedia\" (separatedly but in the same query). Thanks in advance. strakhov (talk) 16:59, 5 April 2020 (UTC) @Strakhov: SELECT (COUNT(?item) AS ?people_died_in_Berlin_on_Wikidata)
       (COUNT(?article_fr) AS ?French_articles)
       (COUNT(?article_de) AS ?German_articles)
WHERE
{
  ?item wdt:P31 wd:Q5. # Item is a human
  ?item wdt:P20 ?place_of_death.
  ?place_of_death wdt:P131* wd:Q64. # Place of death is in Berlin
  OPTIONAL {
    ?article_fr schema:about ?item.
    ?article_fr schema:isPartOf <https://fr.wikipedia.org/>.
  }
  OPTIONAL {
    ?article_de schema:about ?item.
    ?article_de schema:isPartOf <https://de.wikipedia.org/>.
  }
}
 Try it! --Dipsacus fullonum (talk) 17:11, 5 April 2020 (UTC) Thanks a lot, Dipsacus fullonum. It works great. Much appreciated! strakhov (talk) 17:13, 5 April 2020 (UTC) ORDER BY Family name (II) Hello,I reopen this ticket about ORDER BY family name.Could you help me to understand what wrong on this query where I want to display the movies order by family name of director? #films mis à disposition en libre accès en VOD par artfilm.ch durant la crise du Covid-19 triés par réalisateur
SELECT DISTINCT ?film ?filmLabel ?réalLabel ?duree (MIN(?date) as ?oldest_date) ?decrit 
WHERE 
{
  ?film wdt:P1344 wd:Q89370484;
        wdt:P2047 ?duree;
        wdt:P577 ?date;
        wdt:P57 ?réal.
  ?film p:P973 ?describestmt.
  ?describestmt ps:P973 ?decrit.
  ?describestmt pq:P407 wd:Q150.
  FILTER STRSTARTS(STR(?decrit), \"https://www.artfilm.ch\").
  OPTIONAL {?réal wdt:P734 ?famille.}
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en,de,it,es\".
                         ?réal rdfs:label ?réalLabel.
                         ?film rdfs:label ?filmLabel.
                         ?famille rdfs:label ?familleLabel.
                         }
}
GROUP BY ?film ?filmLabel ?réalLabel ?duree ?decrit 
ORDER BY ?familleLabel
 Try it! Thanks in advance for your help! --2le2im-bdc (talk) 18:49, 4 April 2020 (UTC) @2le2im-bdc: You can't really sort by something if you do not select for it. Add \"?familleLabel\" to the end of the \"SELECT\" and \"GROUP BY\" lines of your query and try again. Mahir256 (talk) 20:02, 4 April 2020 (UTC) I don't think that it is a general requirement in SPARQL that you select variables that are used for sorting. But using variables which are bound by the label service for sorting is an undocumented use of the label service, so nothing can be expected here, but Mahir256's advice seems to work. --Dipsacus fullonum (talk) 20:37, 4 April 2020 (UTC) \"GROUP BY\" is performed before \"ORDER BY\" so when the time comes for ordering an unused ?familleLabel doesn't exist in the grouped solution set, that is why it must be used for grouping and selected. --Dipsacus fullonum (talk) 21:12, 4 April 2020 (UTC) Thanks a lot @Mahir256, Dipsacus fullonum: for your help. --2le2im-bdc (talk) 20:43, 5 April 2020 (UTC) Here the result: #films mis à disposition en libre accès en VOD par artfilm.ch durant la crise du Covid-19 triés par réalisatrice ou réalisateur et date
SELECT DISTINCT ?film ?filmLabel ?réalLabel ?familleLabel ?duree (MIN(?date) as ?oldest_date) ?accès
WHERE 
{
  ?film wdt:P1344 wd:Q89370484;
        wdt:P2047 ?duree;
        wdt:P577 ?date;
        wdt:P57 ?réal.
  ?film p:P973 ?describestmt.
  ?describestmt ps:P973 ?accès.
  ?describestmt pq:P407 wd:Q150.
  FILTER STRSTARTS(STR(?accès), \"https://www.artfilm.ch\").
  OPTIONAL {?réal wdt:P734 ?famille.}
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en,de,it,es\".
                         ?réal rdfs:label ?réalLabel.
                         ?film rdfs:label ?filmLabel.
                         ?famille rdfs:label ?familleLabel.
                         }
}
GROUP BY ?film ?filmLabel ?réalLabel ?familleLabel ?duree ?accès
ORDER BY STR(?familleLabel) ?réalLabel ?oldest_date
 Try it! Salut @VIGNERON:. À nouveau si tu pourras nous expliquer tout cela dans un live volontiers. Pas sûr d'avoir bien saisie la difficulté de trier sur des Labels sans les mettre dans Select. Merci d'avance !--2le2im-bdc (talk) 20:44, 5 April 2020 (UTC) SELECT * {  VALUES ?sort { \"A\"@it \"Bz\"@fr \"Bé\"@fr } } ORDER BY ?sort
 Try it! SELECT * {  VALUES ?sort { \"A\"@it \"Bz\"@fr \"Bé\"@fr } } ORDER BY str(?sort)
 Try it! SELECT * {  VALUES ?sort { \"A\"@it \"Bz\"@fr \"Bé\"@fr } } ORDER BY REPLACE(?sort, \"é\", \"e\")
 Try it! SELECT * {  VALUES ?sort { \"A\"@it \"Bz\"@fr \"Bé\"@fr } } ORDER BY REPLACE(str(?sort), \"é\", \"e\")
 Try it! @2le2im-bdc: Tickets? Isn't that on phabricator: ? Anyways, I think there are two problems with the query. different languages of labels (through the fall-backs of \"[AUTO_LANGUAGE],en,de,it,es\".): @fr is before @it, use str() to fix absence of French collation on query server: \"z\" is before \"é\", replace above could fix that The above illustrates/fixes it to some extent. --- Jura 00:40, 7 April 2020 (UTC) @2le2im-bdc, Jura1: The order when sorting strings with language tags is not defined by the definition of the SPARQL language. If @fr is sorted before @it or not is determined by the implementation only. Strings without language tags are sorted after UNICODE codepoints values according to the SPARQL specifications. --Dipsacus fullonum (talk) 05:00, 7 April 2020 (UTC) Include qualifier in query Hello,I'm searching for municipalities in Finland with Swedish as an official language with this query. For some reason Helsinki does not turn up in the result, even though it has Swedish as an official language (P37). Helsinki's official language Swedish has the qualifier \"has role\" (P3831) = minority language (Q61566) - is this the reason it is not included in the result? How should I do the query so that it is included?Thank you! @Robertsilen: The qualifier have nothing to do with this. Helsingfors isn't in the result set because the statement Helsinki (Q1757) official language (P37) Finnish (Q1412) have preferred rank while official language (P37) Swedish (Q9027) have normal rank. When one statement for an item and property have a higher rank than another statement for same item and property only the first statement will be considered for truthy statement predicates with the prefix wdt: See about truthy statements in the datamodel description at mw:Wikibase/Indexing/RDF Dump Format#Truthy statements. --Dipsacus fullonum (talk) 09:28, 6 April 2020 (UTC) @Robertsilen: To include all statements independent of rank you can change ?kommun wdt:P37 wd:Q9027. to ?kommun p:P37/ps:P37 wd:Q9027. in the query. Note that that will also include any statements with deprecated rank if there is any, unless you also add code to remove them. However I think the problem here is bad indata and not the query. I suggest that the edit Special:Diff/703866956 by User:Krassotkin is undone. --Dipsacus fullonum (talk) 09:55, 6 April 2020 (UTC) I can't remember why I made this edit. Please be bold. --sasha (krassotkin) 10:07, 6 April 2020 (UTC) How to find items corresponding to Wikipedia titles without timeout? This query will find an item from the title of a Wikipedia article: SELECT ?article_sv ?item
WHERE 
{
  BIND (STRLANG(\"Helsingfors\", \"sv\") AS ?title_sv)
  ?article_sv schema:name ?title_sv.
  ?article_sv schema:isPartOf <https://sv.wikipedia.org/>.
  ?article_sv schema:about ?item.
}
 Try it! The query takes 40 to 50 seconds to run which seems far too much to find a single item. With this little rewrite with a string constant instead of ?title_sv: SELECT ?article_sv ?item
WHERE 
{
  ?article_sv schema:name \"Helsingfors\"@sv.
  ?article_sv schema:isPartOf <https://sv.wikipedia.org/>.
  ?article_sv schema:about ?item.
}
 Try it! it can run in less than a second. The first query should be able to perform just as well. Can anybody help write a query using ?title_sv to be as fast as the second query?Then that is done, the real goal is to use the same methods to rewrite the query below where ?title_sv comes from a WMAPI search in svwiki. The search at svwiki only has 26 results, but the query always times out: SELECT ?title ?title_sv ?article_sv ?item
WHERE 
{
  SERVICE wikibase:mwapi
  {
    bd:serviceParam wikibase:api \"Search\" .
    bd:serviceParam wikibase:endpoint \"sv.wikipedia.org\" .
    bd:serviceParam mwapi:srnamespace \"0\" .
    bd:serviceParam mwapi:srsearch 'deepcat:\"Pargas (kommun)\"' .
    ?title wikibase:apiOutput mwapi:title .
  }
  
  BIND (STRLANG(?title, \"sv\") AS ?title_sv)
  ?article_sv schema:name ?title_sv.
  ?article_sv schema:about ?item.
  ?article_sv schema:isPartOf <https://sv.wikipedia.org/>.
}
 Try it! How can the query be made to run in a reasonable time? --Dipsacus fullonum (talk) 11:45, 6 April 2020 (UTC) Might be useful to try a variant of this query (which sometimes times out, or other times performs quickly, don't know why) : https://www.wikidata.org/wiki/User:Bouzinac#String_search_elements_without_P31_P279 Bouzinac (talk) 11:47, 6 April 2020 (UTC) SELECT ?article_sv ?item
WHERE 
{
  BIND (STRLANG(\"Helsingfors\", \"sv\") AS ?title_sv)
  hint:Query hint:optimizer \"None\".
  ?article_sv schema:name ?title_sv.
  ?article_sv schema:isPartOf <https://sv.wikipedia.org/>.
  ?article_sv schema:about ?item.
}
 Try it! Maybe ? --- Jura 12:01, 6 April 2020 (UTC) @Bouzinac, Jura1: Thank you for the suggestions. Using hint:Query hint:optimizer \"None\". do the trick. --Dipsacus fullonum (talk) COUNT not double with two localisation Hello,I have a originaly query : #afficher le nombre d'éléments disposant de la propriété \"archivé par\" (P485) par institution française
#afficher le lieu où est située l'institution.
#classer les institution par ordre de nombre d'éléments décroissant.
SELECT ?institution ?institutionLabel ?lieuLabel (COUNT(?item) AS ?total) 
WHERE 
{
  ?item wdt:P485 ?institution . #les éléments doivent disposé de la propriété \"archivé par\" qui renvoie à une institution.
  ?institution wdt:P17 wd:Q142; #l'institution doit être localisée en France
               wdt:P131 ?lieu. #localisation administrative de l'institution
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr,en\". }
}
GROUP BY ?institution ?institutionLabel ?lieuLabel
ORDER BY DESC (?total) ?lieuLabel
 Try it! I want now to merge the locations. I wrote this query : #afficher le nombre d'éléments disposant de la propriété \"archivé par\" (P485) par institution française
#afficher le lieu où est située l'institution.
#classer les institution par ordre de nombre d'éléments décroissant.
SELECT ?institution ?institutionLabel (GROUP_CONCAT(DISTINCT(?lieuLabel); separator=\", \") as ?lieuxLabel) (COUNT(?item) AS ?total) 
WHERE 
{
  ?item wdt:P485 ?institution . #les éléments doivent disposé de la propriété \"archivé par\" qui renvoie à une institution.
  ?institution wdt:P17 wd:Q142; #l'institution doit être localisée en France
               wdt:P131 ?lieu. #localisation administrative de l'institution
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr,en\". 
                          ?institution rdfs:label ?institutionLabel.
                          ?lieu rdfs:label ?LieuLabel.}
}
GROUP BY ?institution ?institutionLabel ?lieuxLabel
ORDER BY DESC (?total)
 Try it! But I have two problems : locations are no any more displayed (why?) and count of items are double if it was two locations (ex: La contemporaine (Q856640)).Cloud you explain me how to write it correctly?Thanks in advance --2le2im-bdc (talk) 20:12, 6 April 2020 (UTC) @2le2im-bdc: SPARQL variable names are case sensitive. \"?LieuLabel\" should be \"?lieuLabel\". Mahir256 (talk) 21:19, 6 April 2020 (UTC) @2le2im-bdc: The count of items are double if there are two locations because there is one result in the result set for each location before the aggregation. You fix it by changing (COUNT(?item) AS ?total) to (COUNT(DISTINCT ?item) AS ?total). The first question is answered by Mahir256. Note that you can freely choose any variable name when using the label service in manual mode, but the chosen name must be used consistently. --Dipsacus fullonum (talk) 22:02, 6 April 2020 (UTC) @2le2im-bdc: Also note that \"GROUP BY ... ?lieuxLabel\" have no effect for the result. ?lieuxLabel with \"x\" is the resulting variable in the expression (GROUP_CONCAT(DISTINCT(?lieuLabel); separator=\", \") as ?lieuxLabel) and it is not defined before the grouping is already done. ?lieuxLabel with \"x\" and lowercase \"l\" isn't defined anywhere. ?LieuxLabel with \"x\" and uppercase \"L\" cannot be used for grouping either because it will be bound after the grouping is done. --Dipsacus fullonum (talk) 22:14, 6 April 2020 (UTC) Thanks a lot @Mahir256, Dipsacus fullonum:! I am learning slow but I learn! --2le2im-bdc (talk) 05:45, 7 April 2020 (UTC) Here the functional query: #afficher le nombre d'éléments disposant de la propriété \"archivé par\" (P485) par institution française
#afficher le lieu où est située l'institution.
#classer les institution par ordre de nombre d'éléments décroissant.
SELECT ?institution ?institutionLabel (GROUP_CONCAT(DISTINCT(?lieuLabel); separator=\", \") as ?lieuxLabel) (COUNT(DISTINCT ?item) AS ?total) 
WHERE 
{
  ?item wdt:P485 ?institution . #les éléments doivent disposé de la propriété \"archivé par\" qui renvoie à une institution.
  ?institution wdt:P17 wd:Q142; #l'institution doit être localisée en France
               wdt:P131 ?lieu. #localisation administrative de l'institution
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr,en\". 
                          ?institution rdfs:label ?institutionLabel.
                          ?lieu rdfs:label ?lieuLabel.}
}
GROUP BY ?institution ?institutionLabel
ORDER BY DESC (?total)
 Try it! --2le2im-bdc (talk) 05:45, 7 April 2020 (UTC) Select all items except those that have the property \"is an instance of\" AND which not objects of the property \"is an instance of\" at the same time How do I select all items using an exclusion rather than an inclusion criteria?I'd like to select all items except those that do have the property \"is an instance of\" AND which not objects of the property \"is an instance of\" at the same time. You can limit to 10 or 100 first. I just want to have an idea what items will be returned. There are several ways to select items using exclusion criteria. One way is to make an optional pattern and a filter selecting the results where an optional bound variable is unbound: SELECT ?item
WHERE
{
  ?item wikibase:sitelinks []. # Select items
  OPTIONAL { ?item wdt:P31 ?object. }
  OPTIONAL { ?subject wdt:P31 ?item. }
  FILTER (! BOUND(?object))
  FILTER (! BOUND(?subject))
}
LIMIT 10
 Try it! Another way is to make a filter with the NOT EXISTS function: SELECT ?item
WHERE
{
  ?item wikibase:sitelinks []. # Select items
  FILTER NOT EXISTS { ?item wdt:P31 ?object. }
  FILTER NOT EXISTS { ?subject wdt:P31 ?item. }
}
LIMIT 10
 Try it! --Dipsacus fullonum (talk) 06:47, 7 April 2020 (UTC) How to filter out all items that do not have a label, and then also filter out all which have no properties at all? With a query like this: SELECT ?item
   WHERE
   {
     ?item wikibase:sitelinks []. # Select items
     FILTER NOT EXISTS { ?item wdt:P31 ?object. }
     FILTER NOT EXISTS { ?item wdt:P279 ?subclass. } }
   LIMIT 10 How can I filter out items that do not have a label, and which have no properties at all? – The preceding unsigned comment was added by 116.15.233.70 (talk • contribs). For no statements, you can use ?item wikibase:statements 0 . and for no labels you can use filter not exists { ?item rdfs:label [] }, e.g. SELECT ?item WHERE {
  ?item wikibase:sitelinks [] ; # Select items
        wikibase:statements 0 .
  FILTER NOT EXISTS { ?item wdt:P31 ?object. }
  FILTER NOT EXISTS { ?item wdt:P279 ?subclass. }
  filter not exists { ?item rdfs:label [] }
}
LIMIT 10
 Try it! - Nikki (talk) 08:27, 7 April 2020 (UTC) With ?item wikibase:statements 0 . there is no need for the two first filters, as the with 0 statements there are of course none with P31 or P279. --Dipsacus fullonum (talk) 09:04, 7 April 2020 (UTC) \"Of course\", except for phab:T145712. At Wikidata:Database reports/to delete, we tried to add a few additional checks, just to be sure that it's 0. --- Jura 12:04, 7 April 2020 (UTC) @Jura1: Even if wikibase:sitelinks wikibase:statements is unreliable there is, of course, no need to test for statements with two specific properties out of more than seven thousands. Instead the query should be rewritten to test for any statement without using wikibase:sitelinks wikibase:statements: SELECT ?item
WHERE {
  ?item wikibase:sitelinks []. # Select items
  FILTER NOT EXISTS {
    ?item ?p [].
    ?p a owl:ObjectProperty.
  }
  FILTER NOT EXISTS {
    ?item rdfs:label [].
  }
}
LIMIT 10
 Try it! --Dipsacus fullonum (talk) 14:43, 7 April 2020 (UTC) Covid impact by country in country's official language So we are starting to get some evidence in page views that articles which are about local context are being viewed significantly, especially as folks see changes in their local government response and news. I tried to create a query that examines whether whether a Wikipedia article exists in the official languages for each country, about the local response. However, it keeps timing out (here is the query: https://w.wiki/MGx). Can anyone figure out a way to optimize this so that it works? Am I doing anything in the wrong order? Sadads (talk) 16:58, 7 April 2020 (UTC) @Sadads: Here is a version of your query that runs without timeout. The column \"article\" in the result will have a link to the Wikipedia article in an official language for the country if exists. The column is empty if there is no article in the language: SELECT ?item ?officialLabel ?itemLabel ?langcode ?article
WHERE
{
  ?item wdt:P361 wd:Q83741704. #item is one of the articles about Covid by territor
  ?item wdt:P17 ?country. #item has a country
  ?country wdt:P37 ?official. #country has an official language
  ?official wdt:P424 ?langcode. #official language has wiki language code
  ?wiki wdt:P31 wd:Q10876391; #there is a wikipedia
     wdt:P424 ?langcode; #that wikipedia has a langcode that is the same as an official language
     wdt:P856 ?sitesurl. #that wiki has a site url

  #check if official languages are represented in Wikipedia
  OPTIONAL
  {
    hint:Group hint:optimizer \"Runtime\".
    ?article schema:about ?item.
    ?article schema:isPartOf ?sitesurl. 
  }
  
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"en\" . }
}
 Try it! --Dipsacus fullonum (talk) 20:49, 7 April 2020 (UTC) @Dipsacus fullonum: I need to remove the lines with articles, because I want to bind them like meta:WikiForHumanRights/List/Universal_Declaration_of_Human_Rights. But with a small tweak of the Optional to a MINUS, I get what I want in your query: https://w.wiki/MJ5. Thanks for the tweaks (and the optimizer), I really appreciate getting there. Sadads (talk) 21:05, 7 April 2020 (UTC) How to filter out all items that do not have a label, and which have no properties at all? - Suggested queries still returns those with no label? The answers to \"How to filter out all items that do not have a label, and which have no properties at all?\" in one of the above sections included: SELECT ?item WHERE {
  ?item wikibase:sitelinks [] ; # Select items
        wikibase:statements 0 .
  FILTER NOT EXISTS { ?item wdt:P31 ?object. }
  FILTER NOT EXISTS { ?item wdt:P279 ?subclass. }
  filter not exists { ?item rdfs:label [] }
}
LIMIT 10
 Try it! Which is supposed to remove/exclude all items that do not have a label. But when I ran the query, the system still returned such items as https://www.wikidata.org/wiki/Q747514 which clearly do not have a label (it says \"No Label Defined\" when I click on the Wikidata URL. Why is this so, and how can I rectify this? 1) As discussed in the section above where the query was first given, that is NOT a good query as there is no good reason to test explicit for two out of nearly 8000 properties. Besides it seems that in some cases the value returned for wikibase:statements isn't correct. 2) Q747514 doesn't have label and the query gives items that don't have a label. I thought that it what you wanted. If you want items without statements that DO have labels, you can use this query: SELECT ?item
WHERE {
  ?item wikibase:sitelinks []. # Select items
  FILTER NOT EXISTS {
    ?item ?p [].
    ?p a owl:ObjectProperty.
  }
  FILTER EXISTS {
    ?item rdfs:label [].
  }
}
LIMIT 10
 Try it! --Dipsacus fullonum (talk) 05:36, 8 April 2020 (UTC) Siblings with close dates of birth I am looking for all siblings that have dates of birth less than a year apart. Twins with identical birth dates shall be excluded. 80.135.58.218 14:49, 8 April 2020 (UTC) That is not possible using Wikidata Query Service. There are too many persons to make a search for these criteria without timeouts. You will have to use a database dump or other means to find all. But you can have samples or have results for some selected minor groups of persons. Here is a query for a sample of 10 sibling pairs: SELECT ?child1 ?child1Label ?birth1 ?child2 ?child2Label ?birth2
WHERE
{
  # Find 2 siblings
  ?parent wdt:P31 wd:Q5.
  ?parent wdt:P21 wd:Q6581097. # Parent is male, could also have been wd:Q6581072 (female)
  ?parent wdt:P40 ?child1.
  ?parent wdt:P40 ?child2.
  FILTER (?child1 != ?child2)

  ?child1 p:P569 ?birth1_statement.
  ?birth1_statement psv:P569 ?birth1_value.
  ?birth1_value wikibase:timePrecision 11 . # Use values with precision day only.
  ?birth1_value wikibase:timeValue ?birth1. hint:Prior hint:rangeSafe true.

  ?child2 p:P569 ?birth2_statement.
  ?birth2_statement psv:P569 ?birth2_value.
  ?birth2_value wikibase:timePrecision 11 . # Use values with precision day only.
  ?birth2_value wikibase:timeValue ?birth2. hint:Prior hint:rangeSafe true.

  FILTER (?birth1 < ?birth2 &&              # Eliminate twins born same say and select each sibling pair only once
          ?birth2 - ?birth1 < 365)          # They must be born less than a year apart
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
LIMIT 10
 Try it! --Dipsacus fullonum (talk) 15:56, 8 April 2020 (UTC) Find state of a US location Hello,I am trying to make a query that shows the state in which companies are headquartered.Locations often don't have a 'state' property, rather a property 'located in administrative territorial entity'. If you follow this property far enough (it's transitive) you will reach a state (hopefully!). How can I continually look at the property (wdt:P131) such that I ultimately find the State. I would like to store the state in ?territorialEntitySo far I have this: #Addresses
SELECT ?company ?companyLabel ?hqLocation ?hqLocationLabel ?territorialEntity
WHERE 
{
  ?company wdt:P159 ?hqLocation . # company headquarted location
  ?hqLocation wdt:P131 ?territorialEntity . # located in territorial entity
  ?territorialEntity wdt:P31 wd:Q35657 . # territorial entity is instance of 'state'
  
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! Thanks Add a \"+\" after wdt:P131 to make a property chain with 1 or more links. That will find the state and is simple, but it will timeout, so you need to add more criteria to make a smaller result set than all items of any kind with a headquater in a US state. Adding \"?company wdt:P17 wd:Q30.\" (country is US) is a good start, but not enough to run without timeout. --Dipsacus fullonum (talk) Thank you @Dipsacus_fullonum:! I edited it like this... I have no idea why it takes so long to resolve the query! I would have thought that the inner select (that only returns two companies (IBM and Google)) would lead to a massive reduction in the time taken. Am I missing something? #Addresses

SELECT ?company ?companyLabel ?hqLocationLabel ?territorialEntityLabel
WHERE 
{    
  
  ?company wdt:P159 ?hqLocation . # company headquarted location
  ?hqLocation wdt:P131+ ?territorialEntity . # located in territorial entity
  ?territorialEntity wdt:P31 wd:Q35657 . # territorial entity is instance of 'state'
  
  {
    SELECT ?company
    WHERE
    {
      ?company wdt:P17 wd:Q30 .
      FILTER (?company IN (wd:Q95, wd:Q37156)) #Google/IBM
    }
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
 Try it! Alexjorm (talk) 17:27, 8 April 2020 (UTC)@Alexjorm: The inner select isn't executed first. To make sure that a subquery is executed first, you can extract it as a named subquery like this: SELECT ?company ?companyLabel ?hqLocationLabel ?territorialEntityLabel
WITH
{
  SELECT ?company
  WHERE
  {
    ?company wdt:P17 wd:Q30 .
    FILTER (?company IN (wd:Q95, wd:Q37156)) #Google/IBM
  }
} AS %sub

WHERE 
{    
  INCLUDE %sub
  ?company wdt:P159 ?hqLocation . # company headquarted location
  ?hqLocation wdt:P131+ ?territorialEntity . # located in territorial entity
  ?territorialEntity wdt:P31 wd:Q35657 . # territorial entity is instance of 'state'
  
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! That will run in 3 seconds. But you usually use the VALUES keyword to give inline results that are joined with other results in a query, like this SELECT ?company ?companyLabel ?hqLocationLabel ?territorialEntityLabel
WHERE 
{
  VALUES ?company { wd:Q95 wd:Q37156 }  #Google/IBM
  ?company wdt:P159 ?hqLocation . # company headquarted location
  ?hqLocation wdt:P131+ ?territorialEntity . # located in territorial entity
  ?territorialEntity wdt:P31 wd:Q35657 . # territorial entity is instance of 'state'
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! That query will run 1 second. --Dipsacus fullonum (talk) 17:49, 8 April 2020 (UTC) @Dipsacus_fullonum: Thank you so much! This helps a lot. Alexjorm (talk) 17:59, 8 April 2020 (UTC) nobel price in literature Hello I would like to know how to write a query resulting with writers who won the Nobel price of literature, also would like to know the book that brought the prize, and the year that it happened. I don't understand yet how to assign the properties inside of certain property values to a variable. Thank you very much:) – The preceding unsigned comment was added by 85.76.23.134 (talk • contribs) at 7 april 2020 kl. 12.46 (UTC). I don't think there is a single book that brings the prize. Here is query that lists all the laurates by year. For the two latest years there is also a award rationale (P6208). SELECT ?year ?laurate ?laurateLabel (?p6208 AS ?award_rationale) {
  ?laurate p:P166 ?p166stm .
  ?p166stm ps:P166 wd:Q37922; pq:P585 ?time .
  BIND(YEAR(?time) AS ?year)
  OPTIONAL { ?p166stm pq:P6208 ?p6208 . FILTER(LANG(?p6208)='en') }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
GROUP BY ?year ?laurate ?laurateLabel ?p6208 
ORDER BY ?year ?laurateLabel
 Try it! --Larske (talk) 13:41, 7 April 2020 (UTC) I know it partially answers to the original question, but in many biographies there's Property:P800 for notable works, maybe it could be interesting to append in this query a comma separated list of notable works for each laureate. Unfortunately I'm not able to do it by myself. --Luckyz (talk) 09:55, 9 April 2020 (UTC) Articles beginning with each letter Hello! I would like to find the percentage of articles beginning with every letter in a given edition of Wikipedia. Is it possible to do it with SPARQL? Thanks in advance, Paucabot (talk) 09:49, 9 April 2020 (UTC) @Paucabot: Well, it can be difficult to tell if sitelinks to a Wikipedia are articles or other kind of pages. Here is a query that count occurrence of different first characters for all pages with sitelinks on Wikidata in a Wikipedia: SELECT ?first_letter  (COUNT(?first_letter) as ?count) (?count/?total*100 AS ?pct)
WITH
{ 
  SELECT (COUNT(?article) AS ?total)
  WHERE
  {
    ?article schema:isPartOf <https://is.wikipedia.org/>.
  }
} AS %total
WHERE
{
  INCLUDE %total
  ?article schema:name ?title.
  ?article schema:isPartOf <https://is.wikipedia.org/>.
  BIND (SUBSTR(?title, 1, 1) AS ?first_letter)
}
GROUP BY ?first_letter ?total
 Try it! It could be much improved with a better selection of pages. \"F\" has the highest count because the prefix for the category namespace in Icelandic is \"Flokkur:\" --Dipsacus fullonum (talk) 10:23, 9 April 2020 (UTC) Thanks, @Dipsacus fullonum:. I was looking for this query in catalan. Is there any way to remove namespaces? Categories (categories, C) and plantilles (templates, P) distort the percentages ... Paucabot (talk) 10:30, 9 April 2020 (UTC) @Paucabot: Try this: SELECT ?first_letter  (COUNT(?first_letter) as ?count) (?count/?total*100 AS ?pct)
WITH
{
  SELECT ?first_letter
  WHERE
  {
    ?article schema:name ?title.
    ?article schema:isPartOf <https://ca.wikipedia.org/>.
    BIND (SUBSTR(?title, 1, 1) AS ?first_letter)
    FILTER (! STRSTARTS(?title, \"Categoria:\"))
    FILTER (! STRSTARTS(?title, \"Plantilla:\"))    
  }
} AS %get_letters
WITH
{ 
  SELECT (COUNT(?first_letter) AS ?total)
  WHERE
  {
    INCLUDE %get_letters
  }
} AS %total
WHERE
{
  INCLUDE %get_letters
  INCLUDE %total
}
GROUP BY ?first_letter ?total
 Try it! There will still be pages in the count which are not articles, e.g. modules and disambiguation pages. --Dipsacus fullonum (talk) 11:23, 9 April 2020 (UTC) Interesting query .. --- Jura 11:44, 9 April 2020 (UTC) Why do I get 1 as a ?unitShort… …for egg white (Q796758)--Loominade (talk) 15:02, 8 April 2020 (UTC) SELECT ?ord ?ingredient ?ingredientLabel ?quantity ?unitShort ?unitLabel WHERE {
      SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
      { 
        wd:Q1039131 p:P186 ?materialStatement.
        ?materialStatement ps:P186 ?ingredient.
        OPTIONAL {
          ?materialStatement pq:P1114 ?quantity.
          ?materialStatement pqv:P1114 ?value.
          ?value wikibase:quantityUnit ?unit.
          ?unit wdt:P5061 ?unitShort.
          FILTER(LANG(?unitShort) = \"en\")
        }
        OPTIONAL {
          ?materialStatement pq:P1545 ?ord.
        }
      } MINUS {
        ?materialStatement pq:P518 wd:Q81727.
      }
    } ORDER BY ASC(?ord)
 Try it! @Loominade: Becuase the unit is 1 (Q199) and it has 1 as unit symbol accoording to the statement Q199#P5061. --Dipsacus fullonum (talk) 15:12, 8 April 2020 (UTC) @Dipsacus fullonum: but it has no unit: https://www.wikidata.org/wiki/Q1039131#P186. Is this a software bug?--Loominade (talk) 09:16, 9 April 2020 (UTC) 1 (Q199) is \"no unit\". --- Jura 09:20, 9 April 2020 (UTC) @Loominade: Jura is right. This is documented in the data model description at mw:Wikibase/Indexing/RDF Dump Format#Quantity --Dipsacus fullonum (talk) 09:31, 9 April 2020 (UTC) @Dipsacus fullonum, Jura1: Ok, then how do I get the quantity unit of egg white (Q796758) in Pink Lady (Q1039131) aka. none? surly wikibase:quantityUnit is not the right way.--Loominade (talk) 09:46, 9 April 2020 (UTC) @Loominade: Yes, wikibase:quantityUnit is the only way to get a unit. I'm not sure what you what, but you can test if the unit is wd:Q199 and do something if it is, e.g. BIND (IF (?unit = wd:Q199, \"None\", ?unitShort) AS ?unitText) # Bind ?unitText to \"None\" or the value of ?UnitShort
 and then select ?unitText. --Dipsacus fullonum (talk) 08:14, 10 April 2020 (UTC) Optimization of a query I have a lot of query like this, used to search item about woman with more than 9 links and not available in it.wikipedia splitted by decade of born, but now is a lot of time that ListeriaBot don't update them probably for timeout. Someone know how optimize the query to avoid timeout? SELECT ?item ?itemLabel ?date (COUNT(distinct ?sitelink) as ?count)
WHERE
{
	?item wdt:P21 wd:Q6581072 .
        ?item wdt:P569 ?date .
        ?item wdt:P31 wd:Q5 .
        ?item wdt:P106 [] .
	?sitelink schema:about ?item .
	FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime)
        FILTER (?date < \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
	FILTER NOT EXISTS { ?wfr schema:about ?item . ?wfr schema:inLanguage \"it\" }
	FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .
	SERVICE wikibase:label { bd:serviceParam wikibase:language \"it,en\" }
}
GROUP BY ?item ?itemLabel ?date
HAVING (?count > 9)
ORDER BY ?date
 Try it! --ValterVB (talk) 10:01, 9 April 2020 (UTC) Removing the label calls (listeria bot will handle the labels), and replacing the count of the sitelinks with the hardcoded sitelink count in the RDF export, this query works : @ValterVB: SELECT distinct ?item ?date ?count
WHERE
{
	?item wdt:P21 wd:Q6581072 .
        ?item wdt:P569 ?date .hint:Prior hint:rangeSafe true.
        ?item wdt:P31 wd:Q5 .
        ?item wdt:P106 [] .
    ?item wikibase:sitelinks ?count filter (?count > 9)
	FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime && ?date < \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
	FILTER NOT EXISTS { [] schema:about ?item ; schema:isPartOf <https://it.wikipedia.org/> }
	FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .
}
ORDER BY ?date
 Try it! author TomT0m / talk page 10:44, 9 April 2020 (UTC) @ValterVB: I agree with TomT0m. Note that he also added \"hint:Prior hint:rangeSafe true.\" after \"?item wdt:P569 ?date .\" But the query doesn't find items which isn't in it.wikipedia as you say, but items which isn't in any Italian language Wikimedia project. For instance items with sitelinks to https://it.wikiquote.org/ or https://it.wikisource.org/ will not be in the results even if there is no article in https://it.wikipedia.org/. --Dipsacus fullonum (talk) 10:56, 9 April 2020 (UTC) True, updated that part. author TomT0m / talk page 11:08, 9 April 2020 (UTC) (also note that this is not really the numb Items used: female (Q6581072)   , human (Q5)   , Corbin Bleu (Q4617)   , Wikidata Sandbox 3 (Q15397819)   , Wikidata Sandbox 2 (Q13406268)   , Wikidata Sandbox (Q4115189)   Properties used: sex or gender (P21)   , date of birth (P569)   , occupation (P106)   , instance of (P31)   SELECT DISTINCT ?item ?itemLabel ?date ?sl
WHERE
{
  {
    ?item wdt:P21 wd:Q6581072 .
    ?item wikibase:sitelinks ?sl .
    FILTER ( ?sl > 9)
    ?item wdt:P569 ?date .
    FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime && ?date <= \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
    MINUS { ?item ^schema:about / schema:isPartOf <https://it.wikipedia.org/> }
  }
  ?item wdt:P106 [] .
  ?item wdt:P31 wd:Q5 .
  FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"it,en\" }
}
ORDER BY ?date Try it!Old query indeed. Above my updated version .. also with the newer \"wikibase:sitelinks\" and \"schema:isPartOf\". --- Jura 10:50, 9 April 2020 (UTC) Timesout here. author TomT0m / talk page 11:08, 9 April 2020 (UTC) Worked for me. I had the same for yours .. ;) --- Jura 11:09, 9 April 2020 (UTC) But using the « minus » form with my query above seems to get very good performances : SELECT distinct ?item ?date ?count
WHERE
{
	?item wdt:P21 wd:Q6581072 .
        ?item wdt:P569 ?date .hint:Prior hint:rangeSafe true.
        ?item wdt:P31 wd:Q5 .
        ?item wdt:P106 [] .
    ?item wikibase:sitelinks ?count. hint:Prior hint:rangeSafe true . filter (?count > 9)
	FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime && ?date < \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
    MINUS { ?item ^schema:about / schema:isPartOf <https://it.wikipedia.org/> }
	FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .

}
ORDER BY ?date
 Try it! author TomT0m / talk page 11:11, 9 April 2020 (UTC) Added \"DISTINCT\" to mine. Running either query twice seems to get results the second time ;) --- Jura 11:15, 9 April 2020 (UTC) It doesn't matter much with \"DISTINCT\" here because you are already ordering the results. But \"DISTINCT\" and/or \"ORDER BY\" will force the complete result set to available at the same time, so omitting these keywords if possible is good for the performance if there are problems with timeouts especially for queries with many results. --Dipsacus fullonum (talk) 11:55, 9 April 2020 (UTC) It may be because of a cache warmup or something, but in the case of the query just above it seems quite the opposite, a factor of about 2 (about 10 seconds versus 20 seconds without). What puzzles me is that replacing « filter exists ?item wdt:P106 [] » which is essentially just not generating the duplicates instead of removing them afterwards performs so poorly compared to the last solution. This should be just an existence check, that should ideally be better than generating the duplicates. author TomT0m / talk page 14:17, 9 April 2020 (UTC) If we actually optimize for Listeria, we could skip DISTINCT and ORDER BY, in addition to labels, as Listeria does that too. Oddly I get various response times so I'm not really sure if it's actually quicker. --- Jura 15:02, 9 April 2020 (UTC) \"DISTINCT\" is almost no extra work in this query because the results are already ordered, and because it reduces the size of the result set with more than a factor 2.6 (from 1940 rows to 744 rows) it may in this particular case be faster to use DISTINCT. It was another case if there was no ordering specified in the query, or if only relatively few results were removed. --Dipsacus fullonum (talk) 15:13, 9 April 2020 (UTC) @TomT0m: You wondered why a version of the query with FILTER EXISTS { ?item wdt:P106 []. } performs poorly. I looked at query explanations to find a reason. The query SELECT DISTINCT ?item ?date ?count
WHERE
{
	?item wdt:P21 wd:Q6581072 .
	?item wdt:P569 ?date . hint:Prior hint:rangeSafe true.
	?item wdt:P31 wd:Q5 .
	?item wdt:P106 [] .
	?item wikibase:sitelinks ?count . hint:Prior hint:rangeSafe true .
	FILTER (?count > 9)
	FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime && ?date < \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
	MINUS { ?item ^schema:about / schema:isPartOf <https://it.wikipedia.org/> }
	FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .
}
ORDER BY ?date
 Try it! is reordered by the optimizer to: SELECT DISTINCT ?item ?date ?count
WHERE
{
	?item wdt:P569 ?date . hint:Prior hint:rangeSafe true.
	FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime && ?date < \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
	FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .
	?item wikibase:sitelinks ?count . hint:Prior hint:rangeSafe true .
	FILTER (?count > 9)
	?item wdt:P21 wd:Q6581072 .
	?item wdt:P106 [] .
	?item wdt:P31 wd:Q5 .
	MINUS { ?item ^schema:about / schema:isPartOf <https://it.wikipedia.org/> }
}
ORDER BY ?date
 Try it! And this query SELECT ?item ?date ?count
WHERE
{
	?item wdt:P21 wd:Q6581072 .
	?item wdt:P569 ?date . hint:Prior hint:rangeSafe true.
	?item wdt:P31 wd:Q5 .
	?item wikibase:sitelinks ?count. hint:Prior hint:rangeSafe true .
	FILTER (?count > 9)
	FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime && ?date < \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
	MINUS { ?item ^schema:about / schema:isPartOf <https://it.wikipedia.org/> }
	FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .
	FILTER EXISTS { ?item wdt:P106 []. }
}
ORDER BY ?date
 Try it! is reordered to SELECT ?item ?date ?count
WHERE
{
	?item wdt:P569 ?date . hint:Prior hint:rangeSafe true.
	FILTER (?date >= \"1950-01-01T00:00:00Z\"^^xsd:dateTime && ?date < \"1960-01-01T00:00:00Z\"^^xsd:dateTime)
	FILTER( ?item NOT IN (wd:Q4617, wd:Q15397819, wd:Q13406268, wd:Q4115189) ) .
	FILTER EXISTS { ?item wdt:P106 []. }
	?item wikibase:sitelinks ?count. hint:Prior hint:rangeSafe true .
	FILTER (?count > 9)
	?item wdt:P21 wd:Q6581072 .
	?item wdt:P31 wd:Q5 .
	MINUS { ?item ^schema:about / schema:isPartOf <https://it.wikipedia.org/> }
}
ORDER BY ?date
 Try it! The difference is that \"FILTER (?count > 9)\" is executed before looking for wdt:P106 in the first query, but after in the second query. The ?count filter eliminates many results (393.050 went into the filter in the first query, 12.624 results came out of the filter) so that is important. \"FILTER EXISTS { ?item wdt:P106 []. }\" eliminates much fewer results (393.057 went into the filter in the second query, 336.829 results came out of the filter). Besides \"?item wdt:P106 [].\" was executed with 498.552 results as part of the filter evaluation even though it is an EXIST filter. --Dipsacus fullonum (talk) 18:24, 9 April 2020 (UTC) Thanks a lot to all, never disappoint us :) I have used the 4th query in all the 9 pages and it worked perfectly. --ValterVB (talk) 20:40, 9 April 2020 (UTC) Femmes réunionnaises Bonjour, je voudrais consulter la liste des femmes nées ou mortes ou vivant à La Réunion (974), dans un premier temps, puis la liste de celles qui n'ont pas d'articles dans Wikipédia. Si une bonne âme pouvait me donner ces renseignements, je lui en serais très reconnaissante. Cordialement, Alaf2 (talk) 13:07, 9 April 2020 (UTC) @Alaf2: All female persons who are born, lived or died on Réunion: SELECT DISTINCT ?person ?personLabel
WHERE
{
  ?person wdt:P31 wd:Q5.
  ?person wdt:P21 wd:Q6581072.
  {
    ?person wdt:P19/wdt:P131* wd:Q17070.
  }
  UNION
  {
    ?person wdt:P20/wdt:P131* wd:Q17070.
  }
  UNION
  {
    ?person wdt:P551/wdt:P131* wd:Q17070.
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr\". }
}
 Try it! Whose who doesn't have an article in French Wikipedia (they may have articles in Wikipedias in other languages): SELECT DISTINCT ?person ?personLabel
WHERE
{
  ?person wdt:P31 wd:Q5.
  ?person wdt:P21 wd:Q6581072.
  {
    ?person wdt:P19/wdt:P131* wd:Q17070.
  }
  UNION
  {
    ?person wdt:P20/wdt:P131* wd:Q17070.
  }
  UNION
  {
    ?person wdt:P551/wdt:P131* wd:Q17070.
  }
  FILTER NOT EXISTS
  {
     ?article schema:isPartOf <https://fr.wikipedia.org/>.
     ?article schema:about ?person.
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr\". }
}
 Try it! --Dipsacus fullonum (talk) 13:58, 9 April 2020 (UTC) @Alaf2: Here is shorter versions of the two queries with the same results as before: SELECT DISTINCT ?person ?personLabel
WHERE
{
  ?person wdt:P31 wd:Q5.
  ?person wdt:P21 wd:Q6581072.
  ?person (wdt:P19|wdt:P20|wdt:P551)/wdt:P131* wd:Q17070.
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr\". }
}
 Try it! SELECT DISTINCT ?person ?personLabel
WHERE
{
  ?person wdt:P31 wd:Q5.
  ?person wdt:P21 wd:Q6581072.
  ?person (wdt:P19|wdt:P20|wdt:P551)/wdt:P131* wd:Q17070.
  MINUS
  {
     ?article schema:isPartOf <https://fr.wikipedia.org/>.
     ?article schema:about ?person.
  }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],fr\". }
}
 Try it! --Dipsacus fullonum (talk) 14:06, 9 April 2020 (UTC) @Alaf2: @Dipsacus fullonum:-) Merci beaucoup pour votre aide !--Alaf2 (talk) 03:41, 10 April 2020 (UTC) Query by P2093 string Hi, I'm writing a lot of articles about female scientists recently, and I'm happy about how many scientific articles exist about every single of them. I'd like to replace hundreds of author name string (P2093) by the new item with author (P50) with Open Refine. How can I query my needed list, sth. like this: SELECT all scholarly article (Q13442814) WHERE author name string (P2093) equals \"Karin Loser\" ? Thanks for your help (Pls. ping me for an answer). --Elya (talk) 14:10, 28 March 2020 (UTC)  Items used: scholarly article (Q13442814)   Properties used: instance of (P31)   , author name string (P2093)   """@en;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:Request_a_query/Archive/2020/04>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d824827-wikidata_prefixes;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX bd: <http://www.bigdata.com/rdf#>
SELECT ?item ?itemLabel ?itemDescription
WHERE
{
    ?item wdt:P31 wd:Q13442814 . 
    ?item wdt:P2093 \"Karin Loser\" .
    SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}""" .
