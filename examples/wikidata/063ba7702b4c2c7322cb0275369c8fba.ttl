@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-063ba7702b4c2c7322cb0275369c8fba> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  rdfs:comment """ This page is an archive. Please do not modify it. Use the current page, even to continue an old discussion. Contents 1 How to list a range of Q-items? 2 People of a certain type with the closest connections to a particular person 3 Query for last name 4 Multiple ID values, but not counting deprecated values 5 Q 6 Automatically update Wikidata page 7 Need help fixing up an old query I request here a couple of years ago 8 Pulling back Q codes by IPEDs ID 9 Overcoming timeout 10 Writing to Wikidata 11 finding redirected wikidata items used by SDC 12 End date with precision limited to year (and not day+month) 13 Stats on the number of identifiers for a given collection 14 Fishers that have an article on the French Wikipedia 15 Problem with query 16 potential issues 17 Trouble with preferred values/normal rank values 18 Disappointing query :( 19 A list of every personality which have a personal page in the french wikipedia with their date of birth 20 European trips 21 Articles not in \"Deaths in year\" articles 22 A query to find lexemes 23 Find Wikidata items for a list of persons with known biographical data 24 A kind query request 25 All dates for a given item 26 list all female employees and those who have positions at the Bank of England 27 Sustainable Development Goal (Q53580881) - Sustainable Development Goal Target (Q56724848) - Sustainable Development Goal Indicator (Q56726345) 28 Member of the French National Assembly but only those who belong to the 13th legislature of the Fifth French Republic 29 Request a query for Battles in history and the generals who won it 30 Time out 31 Query to match WD tapestries with Commons images based on Palissy ID 32 Strange quantityUnit in P4214 property for 11 objects 33 Not include items with P582 34 To add images for items which dont have images 35 German federal ministers 36 Number of characters 37 People who are most probably dead 38 Listings of women with nationality 39 List of places How to list a range of Q-items? Is this possible. I'm trying to catch (timeout) a range of Q's before and after 4626 AM (Q16128701) to curate them with the right P31.--So9q (talk) 22:06, 23 November 2019 (UTC)I could generate this myself in a spreadsheet and use in a values block perhaps?--So9q (talk) 10:17, 24 November 2019 (UTC)It worked! Is there a way to generate a range of Q-items dynamically say a special word RANGE(1, 100) that would result in a list of wd:-prefixed Q-items? If not I think we should open a ticket for this, because it is really useful to be able to do to limit queries to a certain range of Q-items.--So9q (talk) 11:36, 24 November 2019 (UTC)I tried with 5000 in the range and the WDQS UI freeze all the time making it almost impossible to type in the SPARQL window. I think this is related to auto completion which should be possible to turn of (as it acts strangely on mobile devices also). This is bug I think.--So9q (talk) 11:46, 24 November 2019 (UTC) SPARQL doesn't afaik have a concept of range, beyond creative use of FILTER to establish them; but I get the impression that's not very efficient. I can imagine a bespoke WDQS service which provides better support for QId ranges (and other matters - append/edit dates & ranges). I doubt such a thing will be commissioned, but by all means open a ticket, since it's even less likely to be built if the suggestion is not made. Not sure about the UI bug; again, worth raising, if there's for instance a client process that could be knocked on the head for super-large queries. --Tagishsimon (talk) 20:44, 24 November 2019 (UTC) On some SPARQL systems (but, I think, not ours) there is full string indexing of all strings and URLs, so a strategy would be to find all URLs that were Q-ids, and CONTAINED the initial digits of the range you were looking for after their Q-number. FILTER could then be applied to this set to reduce it to the range that you were looking for. Full indexing of strings was not implemented on our system, because (i) it is a perfrmance overhead, and (ii) it was considered that such string searching could be achieved through the ElasticSearch API. Nevertheless, STRSTARTS still works better than one might expect (I think -- see Lucas's tips on range-searching in the optimisation page for more. But perhaps it only applies to numbers/dates). So that might be one strategy that could be investigated. Alternatively, one could investogate whether the string search API could be used to extract a block of Qids, that could then be filtered. Jheald (talk) 22:57, 24 November 2019 (UTC) Where is the optimisation page? What about filtering on the dump file? wget https://dumps.wikimedia.org/wikidatawiki/entities/latest-truthy.nt.gz && zcat latest-truthy.nt.gz | wikidata-filter Or a simpler sed that works on the (much bigger) json newline devided dump: wget https://dumps.wikimedia.org/wikidatawiki/entities/latest-all.json.gz && zcat latest-all.json.gz | sed -e '/nifty expression/' > output.json.gz --So9q (talk) 19:47, 27 November 2019 (UTC) @So9q: Wikidata:SPARQL query service/query optimization --Tagishsimon (talk) 21:23, 27 November 2019 (UTC) Thanks :)--So9q (talk) 21:54, 27 November 2019 (UTC) Went ahead and created a ticket for the UI freeze bug: https://phabricator.wikimedia.org/T239385--So9q (talk) 07:28, 28 November 2019 (UTC) @So9q: I couldn’t find an efficient way to generate a range of items – but item IDs aren’t supposed to be significant anyways. And since you were limiting the results to those with a specific description anyways, it’s possible to efficiently query for all of those items with this description, without any range restriction: SELECT ?item WHERE {
  ?item schema:description \"Hebrew calendar year\"@en;
        wdt:P155 ?follows.
  FILTER NOT EXISTS { ?item wdt:P31 ?instanceOf. }
}
 Try it! – does that help? (Alternatively, one thing you could do efficiently is filter by the last modification date of the item, which is available in schema:dateModified. But that’s the only bit of the history that’s available – you can’t get the item creation time like that.) --TweetsFactsAndQueries (talk) 16:38, 1 December 2019 (UTC) Big thanks! It had only one result so I guess I succeded in my quest. I'm a little surprised it did not time out, but that is a good thing.--So9q (talk) 18:23, 1 December 2019 (UTC) People of a certain type with the closest connections to a particular person I would like to request a SPARQL query that allows me to find the people of a certain type with the closest connections to a particular person (counting only parents, children, spouses, and siblings). Miraclepine (talk) 22:19, 1 December 2019 (UTC) @Miraclepine: Perhaps something like this, to start. It's a bidirectional relationship, so there's information to be had from (up to) two items for each relationship. Here's Robbie Burns, whose item doesn't seem to record the fact of one of his children. With more work this could be coalesced into a more simple list. SELECT distinct ?item ?itemLabel ?item2 ?item2Label ?relation_to_subjectLabel ?relation_to_objectLabel
WHERE 
{
  VALUES ?item {wd:Q81960}
 { ?item2 wdt:P26| wdt:P40 | wdt:P3373 | wdt:P22 | wdt:P25 ?item .
    ?item2 ?propertyRel ?item .  
   ?relation_to_subject wikibase:directClaim ?propertyRel.            
}
  union 
 { ?item wdt:P26 | wdt:P40 | wdt:P3373 | wdt:P22 | wdt:P25 ?item2 .
   ?item ?propertyRel ?item2 .  
   ?relation_to_object wikibase:directClaim ?propertyRel.            
 }
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"[AUTO_LANGUAGE],en\". }
}
 Try it! --Tagishsimon (talk) 22:50, 1 December 2019 (UTC) @Tagishsimon: I tried Queen Victoria who, unlike Burns, has a lot of relatives, descendants, and ancestors, but it only gives me everyone who is one relationship (sibling/parent/child/spouse) removed, and displays most of them twice. I'd like it to go beyond the first degree and to display only the relationship in the direction away from the search target. Miraclepine (talk) 22:59, 1 December 2019 (UTC) Query for last name Items used: Douglas Adams (Q42)   , family name (Q101352)   Properties used: instance of (P31)   """@en;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:Request_a_query/Archive/2019/12>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d847861-wikidata_prefixes;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
SELECT *
WITH
{
    SELECT ?item ?name ?l 
    {
        BIND( wd:Q42 as ?item) 
        ?item rdfs:label ?l . 
        FILTER( lang(?l) = \"en\" )
        # BIND(strafter(?l, \" \") as ?name)
        BIND(REPLACE(?l, \"^.+ (.+)$\", \"$1\") as ?name)      
    }
}  as %a
WHERE
{
  INCLUDE %a 
  OPTIONAL { ?lastname wdt:P31 wd:Q101352 ; rdfs:label ?name }
}""";
  <http://example.org/bigdata_select> """SELECT *
WITH
{
    SELECT ?item ?name ?l 
    {
        BIND( wd:Q42 as ?item) 
        ?item rdfs:label ?l . 
        FILTER( lang(?l) = \"en\" )
        # BIND(strafter(?l, \" \") as ?name)
        BIND(REPLACE(?l, \"^.+ (.+)$\", \"$1\") as ?name)      
    }
}  as %a
WHERE
{
  INCLUDE %a 
  OPTIONAL { ?lastname wdt:P31 wd:Q101352 ; rdfs:label ?name }
}""" .
