@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix schema: <https://schema.org/> .

<https://www.wikidata.org/#query-b6407e745297c0c01c347c50ffd75cff> a sh:SPARQLExecutable,
    sh:SPARQLSelectExecutable;
  dcterms:isPartOf <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/th>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eu>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en-gb>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/vec>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/hy>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/id>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/be-tarask>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/tr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ro>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/he>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/zh>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pt-br>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/si>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/eo>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/da>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ar>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ko>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/pl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ms>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/sv>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/lt>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/nl>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ca>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/uk>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/it>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ja>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/es>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/cs>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/ru>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/de>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/fr>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples/en>,
    <https://www.wikidata.org//wiki/Wikidata:SPARQL_query_service/queries/examples>;
  dcterms:license <https://creativecommons.org/licenses/by-sa/4.0/>;
  sh:prefixes _:genid-4e694113159d4e3db4a1a913894a81d846598-wikidata_prefixes, _:genid-4e694113159d4e3db4a1a913894a81d846598-FBCBC06D491B031A01996B8218088651,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-061110281DA36660AF4E37021A72F9B2, _:genid-4e694113159d4e3db4a1a913894a81d846598-9BC734F3D9712ABA74E48CF563AD479B,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-5C03B5EFB59C2DCD4B1C2D279E77475E, _:genid-4e694113159d4e3db4a1a913894a81d846598-3555ABD8D1E6717E6EF8248714C9EEDA,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-A2D86A660F33F5BAC92E9021DD37340E, _:genid-4e694113159d4e3db4a1a913894a81d846598-8EFC63C3B010649BC034C66CDB55D602,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-45F5243DE0685390FD14E68BCC94B8A3, _:genid-4e694113159d4e3db4a1a913894a81d846598-5F7C47B1B6D465B9388B79155F0544BA,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-F8B8F6F3410BF3C526560BB3AA5A1815, _:genid-4e694113159d4e3db4a1a913894a81d846598-E01F28831313FF4121CF3B084F17F626,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-7F89E712BF646EE48EDECF9DD8C7F274, _:genid-4e694113159d4e3db4a1a913894a81d846598-A4DC52FA347F9F8853105C68027D8D30,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-1B9DC646B30558ACD760ACC1BA4C01BD, _:genid-4e694113159d4e3db4a1a913894a81d846598-DB7BD6B3D827EFF3C6D8062CF6782294,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-2CFD420C51CB0CF55E6D2B4829EC5654, _:genid-4e694113159d4e3db4a1a913894a81d846598-2D81DB1F7560ED6F9D4B256532AC165C,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-E0C2152E9C21BB791D7F050B301D1A53, _:genid-4e694113159d4e3db4a1a913894a81d846598-0420CFF9A08EE7C0BC5DBC93CFAED11A,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-5DAD4A77C9880F666E99E6E8ABDEE209, _:genid-4e694113159d4e3db4a1a913894a81d846598-5D04A17789D05A3D387DF6B94D9F6C75,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-3FC898C1CE1209A434ECDCD83FAB0742, _:genid-4e694113159d4e3db4a1a913894a81d846598-EA72D2E04CB06117EAC31D181482DC28,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-0AEF38F57C999AEAA746F724F72E31AF, _:genid-4e694113159d4e3db4a1a913894a81d846598-C4DAEDDD369C8B7333F9536688203C1E,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-F41453B68F6365FBA72DEE0D7C531DD4, _:genid-4e694113159d4e3db4a1a913894a81d846598-74238E02E9E800D0B5FCCCB3C3FF0256,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-0E961E4E18C3E89076B310AB8A670FBE, _:genid-4e694113159d4e3db4a1a913894a81d846598-41363E3FB00D5839C2484E520E370D53,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-53B04900DD3309198B4609CBCBFD7223, _:genid-4e694113159d4e3db4a1a913894a81d846598-6A994D3F0145CE8C668421D45E30FA07,
    _:genid-4e694113159d4e3db4a1a913894a81d846598-E6D3E29AA78C7EF01D3069072A02CCC0, _:genid-4e694113159d4e3db4a1a913894a81d846598-E2E6266C1BA98C6CFD4DD183DA90C574;
  schema:target <https://query.wikidata.org/sparql/>;
  sh:select """PREFIX wikibase: <http://wikiba.se/ontology#>
PREFIX wdt: <http://www.wikidata.org/prop/direct/>
PREFIX wd: <http://www.wikidata.org/entity/>
PREFIX ps: <http://www.wikidata.org/prop/statement/>
PREFIX pq: <http://www.wikidata.org/prop/qualifier/>
PREFIX p: <http://www.wikidata.org/prop/>
PREFIX bd: <http://www.bigdata.com/rdf#>
# This query has two different features:
# First, it is able to search for municipalities which are part of two different states, looking to P527
# Second, it doesn't show former municipalities, filtering the old ones from the P582 statement.
SELECT DISTINCT ?udalerri ?udalerriLabel WHERE { 
  ?udalerri p:P31 ?status.
  ?udalerri wdt:P131*/^wdt:P527 wd:Q47588 .
  {?status ps:P31 wd:Q484170.} UNION {?status ps:P31 wd:Q2074737}
  MINUS {?status pq:P582 ?old .}
  SERVICE wikibase:label { bd:serviceParam wikibase:language \"eu,es,fr,en\". }
}""" .
